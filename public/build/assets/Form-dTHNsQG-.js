import{_ as G,h as d,z as W,j as V,c as a,b as t,d as v,l as k,v as C,D as X,F as S,k as F,t as f,q as E,p as Y,a as j,r as D,o as n,i as Z,C as $,E as ee}from"./app-Sq4bpJln.js";import{a as A,b as oe,c as te}from"./api-V9GPpd21.js";import{S as le}from"./sweetalert2.esm.all-C0u8rGqG.js";import re from"./Media-CZFad0RX.js";import"./index-BO61v5uL.js";/* empty css                        */const se={name:"CaseForm",components:{Media:re},props:{initialData:{type:Object,default:()=>({name:"",slug:"",description:"",html:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(s,{emit:e}){const m=d([]),o=d([]),p=d([]),h=d(!1),g=d(!1),r=d([]),b=d([]),_=d(!1),M=d(!1),x=d(!1),i=d(null),w=d(null),y=d([]),I=l=>l?typeof l=="string"?l:typeof l=="object"?Array.isArray(l)?l.join(`
`):l.ru||l.en||l.short||l.full||JSON.stringify(l):String(l):"",c=d({name:s.initialData.name||"",slug:s.initialData.slug||"",description:I(s.initialData.description),html:I(s.initialData.html),chapter_id:s.initialData.chapter_id||null,image_id:s.initialData.image_id||null,icon_id:s.initialData.icon_id||null,order:s.initialData.order??0,is_active:s.initialData.is_active!==!1}),B=async()=>{try{const l=await A("/chapters");if(l.ok){const u=await l.json();m.value=u.data||[]}}catch(l){console.error("Error fetching chapters:",l)}},P=async()=>{h.value=!0;try{const l=await A("/services?active=1");if(l.ok){const u=await l.json();o.value=u.data||[]}}catch(l){console.error("Error fetching services:",l)}finally{h.value=!1}},U=async()=>{g.value=!0;try{const l=await A("/products?active=1");if(l.ok){const u=await l.json();p.value=u.data||[]}}catch(l){console.error("Error fetching products:",l)}finally{g.value=!1}},z=()=>{_.value=!0},T=()=>{M.value=!0},q=()=>{x.value=!0},L=l=>{i.value=l,c.value.image_id=l.id,_.value=!1},N=l=>{w.value=l,c.value.icon_id=l.id,M.value=!1},H=l=>{y.value.find(u=>u.id===l.id)||y.value.push(l)},O=()=>{i.value=null,c.value.image_id=null},R=()=>{w.value=null,c.value.icon_id=null},J=l=>{y.value.splice(l,1)};W(()=>s.initialData,l=>{c.value={name:l.name||"",slug:l.slug||"",description:I(l.description),html:I(l.html),chapter_id:l.chapter_id||null,image_id:l.image_id||null,icon_id:l.icon_id||null,order:l.order??0,is_active:l.is_active!==!1},l.image&&(i.value=l.image),l.icon&&(w.value=l.icon),l.images&&Array.isArray(l.images)&&(y.value=l.images),l.services&&Array.isArray(l.services)&&(r.value=l.services.map(u=>u.id||u)),l.products&&Array.isArray(l.products)&&(b.value=l.products.map(u=>u.id||u))},{deep:!0});const K=()=>{const l={name:c.value.name,slug:c.value.slug||null,description:c.value.description?{ru:c.value.description}:{ru:""},html:c.value.html?{ru:c.value.html}:null,chapter_id:c.value.chapter_id||null,image_id:c.value.image_id||null,icon_id:c.value.icon_id||null,order:c.value.order,is_active:c.value.is_active,services:r.value,products:b.value,images:y.value.map(u=>({id:u.id}))};e("submit",l)},Q=()=>{e("cancel")};return V(()=>{B(),P(),U(),s.initialData.image&&(i.value=s.initialData.image),s.initialData.icon&&(w.value=s.initialData.icon),s.initialData.images&&Array.isArray(s.initialData.images)&&(y.value=s.initialData.images),s.initialData.services&&Array.isArray(s.initialData.services)&&(r.value=s.initialData.services.map(l=>l.id||l)),s.initialData.products&&Array.isArray(s.initialData.products)&&(b.value=s.initialData.products.map(l=>l.id||l))}),{chapters:m,services:o,products:p,loadingServices:h,loadingProducts:g,selectedServices:r,selectedProducts:b,localForm:c,showImageMediaModal:_,showIconMediaModal:M,showGalleryMediaModal:x,selectedImage:i,selectedIcon:w,galleryImages:y,openImageModal:z,openIconModal:T,openGalleryModal:q,handleImageSelected:L,handleIconSelected:N,handleGallerySelected:H,removeImage:O,removeIcon:R,removeGalleryImage:J,handleSubmit:K,handleCancel:Q}}},ae=["value"],ne={class:"flex items-center gap-3"},ie={key:0,class:"flex-1"},de=["src","alt"],ce={class:"flex items-center gap-3"},ue={key:0,class:"flex-1"},me=["src","alt"],be={key:0,class:"grid grid-cols-4 gap-3 mb-3"},ge=["src","alt"],ve=["onClick"],fe={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},xe={key:0,class:"text-sm text-muted-foreground"},ye={key:1,class:"text-sm text-muted-foreground"},he={key:2,class:"space-y-2"},ke=["value"],pe={class:"text-sm"},_e={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},we={key:0,class:"text-sm text-muted-foreground"},Ie={key:1,class:"text-sm text-muted-foreground"},Me={key:2,class:"space-y-2"},Ce=["value"],Se={class:"text-sm"},Fe={class:"flex items-center gap-2"},je={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},Ae={class:"flex gap-2 pt-4 border-t border-border"},Ee=["disabled"],Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Ve={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},De={class:"flex items-center justify-between p-4 border-b border-border"},Be={class:"flex-1 overflow-auto h-full"},Pe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Ue={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ze={class:"flex items-center justify-between p-4 border-b border-border"},Te={class:"flex-1 overflow-auto h-full"},qe={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Le={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},Ne={class:"flex items-center justify-between p-4 border-b border-border"},He={class:"flex-1 overflow-auto h-full"},Oe={class:"p-4 border-t border-border flex items-center justify-between"},Re={class:"text-sm text-muted-foreground"};function Je(s,e,m,o,p,h){const g=D("Media");return n(),a(S,null,[t("form",{onSubmit:e[15]||(e[15]=Y((...r)=>o.handleSubmit&&o.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.localForm.name=r),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название кейса"},null,512),[[C,o.localForm.name]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.localForm.slug=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[C,o.localForm.slug]]),e[22]||(e[22]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел *",-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.localForm.chapter_id=r),required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[23]||(e[23]=t("option",{value:null},"Не выбран",-1)),(n(!0),a(S,null,F(o.chapters,r=>(n(),a("option",{key:r.id,value:r.id},f(r.name),9,ae))),128))],512),[[X,o.localForm.chapter_id]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-1 block"},"Описание *",-1)),k(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.localForm.description=r),rows:"5",required:"",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none",placeholder:"Введите описание кейса"},null,512),[[C,o.localForm.description]]),e[26]||(e[26]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Краткое описание для карточки кейса",-1))]),t("div",null,[e[27]||(e[27]=t("label",{class:"text-sm font-medium mb-1 block"},"HTML контент",-1)),k(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.localForm.html=r),rows:"10",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none font-mono text-sm",placeholder:"Введите HTML контент для страницы кейса"},null,512),[[C,o.localForm.html]]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Полный HTML контент, который будет отображаться на странице кейса",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"text-sm font-medium mb-1 block"},"Основное изображение",-1)),t("div",ne,[o.selectedImage?(n(),a("div",ie,[t("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-32 h-32 object-cover rounded border border-border"},null,8,de)])):v("",!0),t("button",{type:"button",onClick:e[5]||(e[5]=(...r)=>o.openImageModal&&o.openImageModal(...r)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(n(),a("button",{key:1,type:"button",onClick:e[6]||(e[6]=(...r)=>o.removeImage&&o.removeImage(...r)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[30]||(e[30]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",ce,[o.selectedIcon?(n(),a("div",ue,[t("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,me)])):v("",!0),t("button",{type:"button",onClick:e[7]||(e[7]=(...r)=>o.openIconModal&&o.openIconModal(...r)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(n(),a("button",{key:1,type:"button",onClick:e[8]||(e[8]=(...r)=>o.removeIcon&&o.removeIcon(...r)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[31]||(e[31]=t("label",{class:"text-sm font-medium mb-1 block"},"Галерея изображений",-1)),o.galleryImages.length>0?(n(),a("div",be,[(n(!0),a(S,null,F(o.galleryImages,(r,b)=>(n(),a("div",{key:r.id||b,class:"relative group"},[t("img",{src:r.url,alt:r.original_name,class:"w-full h-24 object-cover rounded border border-border"},null,8,ge),t("button",{type:"button",onClick:_=>o.removeGalleryImage(b),class:"absolute top-1 right-1 w-6 h-6 bg-destructive text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs"}," × ",8,ve)]))),128))])):v("",!0),t("button",{type:"button",onClick:e[9]||(e[9]=(...r)=>o.openGalleryModal&&o.openGalleryModal(...r)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(o.galleryImages.length>0?"Добавить еще":"Добавить изображения в галерею"),1)]),t("div",null,[e[32]||(e[32]=t("label",{class:"text-sm font-medium mb-1 block"},"Услуги",-1)),t("div",fe,[o.loadingServices?(n(),a("div",xe," Загрузка услуг... ")):o.services.length===0?(n(),a("div",ye," Услуги не найдены ")):(n(),a("div",he,[(n(!0),a(S,null,F(o.services,r=>(n(),a("label",{key:r.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[k(t("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":e[10]||(e[10]=b=>o.selectedServices=b),class:"w-4 h-4 rounded border-border"},null,8,ke),[[E,o.selectedServices]]),t("span",pe,f(r.name),1)]))),128))]))])]),t("div",null,[e[33]||(e[33]=t("label",{class:"text-sm font-medium mb-1 block"},"Продукты",-1)),t("div",_e,[o.loadingProducts?(n(),a("div",we," Загрузка продуктов... ")):o.products.length===0?(n(),a("div",Ie," Продукты не найдены ")):(n(),a("div",Me,[(n(!0),a(S,null,F(o.products,r=>(n(),a("label",{key:r.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[k(t("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":e[11]||(e[11]=b=>o.selectedProducts=b),class:"w-4 h-4 rounded border-border"},null,8,Ce),[[E,o.selectedProducts]]),t("span",Se,f(r.name),1)]))),128))]))])]),t("div",null,[e[34]||(e[34]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),k(t("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.localForm.order=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[C,o.localForm.order,void 0,{number:!0}]])]),t("div",Fe,[k(t("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>o.localForm.is_active=r),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[E,o.localForm.is_active]]),e[35]||(e[35]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),m.error?(n(),a("div",je,f(m.error),1)):v("",!0),t("div",Ae,[t("button",{type:"button",onClick:e[14]||(e[14]=(...r)=>o.handleCancel&&o.handleCancel(...r)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:m.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},f(m.saving?"Сохранение...":"Сохранить"),9,Ee)])],32),o.showImageMediaModal?(n(),a("div",Ge,[t("div",Ve,[t("div",De,[e[36]||(e[36]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[16]||(e[16]=r=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",Be,[j(g,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):v("",!0),o.showIconMediaModal?(n(),a("div",Pe,[t("div",Ue,[t("div",ze,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:e[17]||(e[17]=r=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",Te,[j(g,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):v("",!0),o.showGalleryMediaModal?(n(),a("div",qe,[t("div",Le,[t("div",Ne,[e[38]||(e[38]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображения для галереи",-1)),t("button",{onClick:e[18]||(e[18]=r=>o.showGalleryMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",He,[j(g,{"selection-mode":!0,"count-file":999,onFileSelected:o.handleGallerySelected},null,8,["onFileSelected"])]),t("div",Oe,[t("div",Re," Выбрано изображений: "+f(o.galleryImages.length),1),t("button",{onClick:e[19]||(e[19]=r=>o.showGalleryMediaModal=!1),class:"px-4 py-2 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors text-sm"}," Готово ")])])])):v("",!0)],64)}const Ke=G(se,[["render",Je]]),Qe={name:"CaseFormPage",components:{CaseForm:Ke},setup(){const s=$(),e=ee(),m=d(!1),o=d(!1),p=d(null),h=d(null),g=d({id:null,name:"",slug:"",description:"",html:"",chapter_id:null,image_id:null,icon_id:null,image:null,icon:null,images:[],services:[],products:[],order:0,is_active:!0}),r=Z(()=>!!s.params.id),b=async()=>{if(!r.value){m.value=!1;return}m.value=!0,p.value=null;try{const x=await A(`/cases/${s.params.id}`);if(!x.ok)throw new Error("Ошибка загрузки кейса");const i=await x.json();i.data&&(g.value={id:i.data.id,name:i.data.name||"",slug:i.data.slug||"",description:i.data.description||"",html:i.data.html||"",chapter_id:i.data.chapter_id||null,image_id:i.data.image_id||null,icon_id:i.data.icon_id||null,image:i.data.image||null,icon:i.data.icon||null,images:i.data.images||[],services:i.data.servicesData||[],products:i.data.productsData||[],order:i.data.order??0,is_active:i.data.is_active!==!1})}catch(x){p.value=x.message||"Ошибка загрузки кейса",console.error("Error fetching case:",x)}finally{m.value=!1}},_=async x=>{o.value=!0,h.value=null;try{const i=r.value?`/cases/${s.params.id}`:"/cases",y=await(r.value?oe:te)(i,x);if(!y.ok){const I=await y.json().catch(()=>({}));throw new Error(I.message||`Ошибка ${r.value?"обновления":"создания"} кейса`)}await le.fire({title:r.value?"Кейс обновлен":"Кейс создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.cases"})}catch(i){h.value=i.message||"Ошибка сохранения кейса"}finally{o.value=!1}},M=()=>{e.push({name:"admin.cases"})};return V(()=>{b()}),{loading:m,saving:o,error:p,formError:h,form:g,isEdit:r,saveCase:_,goBack:M}}},We={class:"case-form-page space-y-6"},Xe={class:"flex items-center justify-between"},Ye={class:"text-3xl font-semibold text-foreground"},Ze={key:0,class:"flex items-center justify-center py-12"},$e={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},eo={class:"text-destructive"},oo={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function to(s,e,m,o,p,h){const g=D("CaseForm");return n(),a("div",We,[t("div",Xe,[t("div",null,[t("h1",Ye,f(o.isEdit?"Редактировать кейс":"Создать кейс"),1),e[1]||(e[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление кейсом (портфолио проекта)",-1))]),t("button",{onClick:e[0]||(e[0]=(...r)=>o.goBack&&o.goBack(...r)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(n(),a("div",Ze,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):v("",!0),o.error?(n(),a("div",$e,[t("p",eo,f(o.error),1)])):v("",!0),o.loading?v("",!0):(n(),a("div",oo,[j(g,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveCase,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const co=G(Qe,[["render",to]]);export{co as default};
