import{_ as P,h as c,y as z,j as V,c as s,b as t,d as v,l as y,v as w,D as H,F as M,k as j,t as _,G as E,p as N,a as S,r as B,o as i,i as G,C as R,E as q}from"./app-D6S8wRp1.js";import{a as F,b as O,c as J}from"./api-V9GPpd21.js";import{S as K}from"./sweetalert2.esm.all-C0u8rGqG.js";import Q from"./Media--LcL0uPR.js";import"./index-DSqmReGx.js";/* empty css                        */const W={name:"ProductForm",components:{Media:Q},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,html_content:"",order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const u=c([]),o=c([]),g=c(!1),b=c([]),m=c(!1),l=c(!1),f=c(null),h=c(null),d=c({name:n.initialData.name||"",slug:n.initialData.slug||"",chapter_id:n.initialData.chapter_id||null,image_id:n.initialData.image_id||null,icon_id:n.initialData.icon_id||null,html_content:n.initialData.html_content||"",order:n.initialData.order??0,is_active:n.initialData.is_active!==!1}),x=async()=>{try{const r=await F("/chapters");if(r.ok){const k=await r.json();u.value=k.data||[]}}catch(r){console.error("Error fetching chapters:",r)}},a=async()=>{g.value=!0;try{const r=await F("/services?active=1");if(r.ok){const k=await r.json();o.value=k.data||[]}}catch(r){console.error("Error fetching services:",r)}finally{g.value=!1}},C=()=>{m.value=!0},p=()=>{l.value=!0},I=r=>{f.value=r,d.value.image_id=r.id,m.value=!1},D=r=>{h.value=r,d.value.icon_id=r.id,l.value=!1},U=()=>{f.value=null,d.value.image_id=null},A=()=>{h.value=null,d.value.icon_id=null};z(()=>n.initialData,r=>{d.value={name:r.name||"",slug:r.slug||"",chapter_id:r.chapter_id||null,image_id:r.image_id||null,icon_id:r.icon_id||null,html_content:r.html_content||"",order:r.order??0,is_active:r.is_active!==!1},r.image&&(f.value=r.image),r.icon&&(h.value=r.icon),r.services&&Array.isArray(r.services)&&(b.value=r.services.map(k=>k.id||k))},{deep:!0});const L=()=>{e("submit",{name:d.value.name,slug:d.value.slug||null,chapter_id:d.value.chapter_id||null,image_id:d.value.image_id||null,icon_id:d.value.icon_id||null,html_content:d.value.html_content||null,order:d.value.order,is_active:d.value.is_active,services:b.value})},T=()=>{e("cancel")};return V(()=>{x(),a(),n.initialData.image&&(f.value=n.initialData.image),n.initialData.icon&&(h.value=n.initialData.icon),n.initialData.services&&Array.isArray(n.initialData.services)&&(b.value=n.initialData.services.map(r=>r.id||r))}),{chapters:u,services:o,loadingServices:g,selectedServices:b,localForm:d,showImageMediaModal:m,showIconMediaModal:l,selectedImage:f,selectedIcon:h,openImageModal:C,openIconModal:p,handleImageSelected:I,handleIconSelected:D,removeImage:U,removeIcon:A,handleSubmit:L,handleCancel:T}}},X=["value"],Y={class:"flex items-center gap-3"},Z={key:0,class:"flex-1"},$=["src","alt"],ee={class:"flex items-center gap-3"},oe={key:0,class:"flex-1"},te=["src","alt"],le={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},re={key:0,class:"text-sm text-muted-foreground"},ne={key:1,class:"text-sm text-muted-foreground"},ae={key:2,class:"space-y-2"},se=["value"],ie={class:"text-sm"},de={class:"flex items-center gap-2"},ce={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},ue={class:"flex gap-2 pt-4"},me=["disabled"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ve={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ge={class:"flex items-center justify-between p-4 border-b border-border"},fe={class:"flex-1 overflow-auto h-full"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},_e={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},he={class:"flex items-center justify-between p-4 border-b border-border"},ye={class:"flex-1 overflow-auto h-full"};function ke(n,e,u,o,g,b){const m=B("Media");return i(),s(M,null,[t("form",{onSubmit:e[12]||(e[12]=N((...l)=>o.handleSubmit&&o.handleSubmit(...l),["prevent"])),class:"space-y-4"},[t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.localForm.name=l),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название продукта"},null,512),[[w,o.localForm.name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.localForm.slug=l),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[w,o.localForm.slug]]),e[17]||(e[17]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.localForm.chapter_id=l),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[18]||(e[18]=t("option",{value:null},"Не выбран",-1)),(i(!0),s(M,null,j(o.chapters,l=>(i(),s("option",{key:l.id,value:l.id},_(l.name),9,X))),128))],512),[[H,o.localForm.chapter_id]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),t("div",Y,[o.selectedImage?(i(),s("div",Z,[t("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,$)])):v("",!0),t("button",{type:"button",onClick:e[3]||(e[3]=(...l)=>o.openImageModal&&o.openImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(i(),s("button",{key:1,type:"button",onClick:e[4]||(e[4]=(...l)=>o.removeImage&&o.removeImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",ee,[o.selectedIcon?(i(),s("div",oe,[t("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,te)])):v("",!0),t("button",{type:"button",onClick:e[5]||(e[5]=(...l)=>o.openIconModal&&o.openIconModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(i(),s("button",{key:1,type:"button",onClick:e[6]||(e[6]=(...l)=>o.removeIcon&&o.removeIcon(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"HTML контент",-1)),y(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.localForm.html_content=l),rows:"10",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none font-mono text-sm",placeholder:"Введите HTML контент для продукта"},null,512),[[w,o.localForm.html_content]]),e[23]||(e[23]=t("p",{class:"text-xs text-muted-foreground mt-1"},"HTML контент, который будет отображаться на странице продукта",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),y(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>o.localForm.order=l),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[w,o.localForm.order,void 0,{number:!0}]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-1 block"},"Услуги",-1)),t("div",le,[o.loadingServices?(i(),s("div",re," Загрузка услуг... ")):o.services.length===0?(i(),s("div",ne," Услуги не найдены ")):(i(),s("div",ae,[(i(!0),s(M,null,j(o.services,l=>(i(),s("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[y(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[9]||(e[9]=f=>o.selectedServices=f),class:"w-4 h-4 rounded border-border"},null,8,se),[[E,o.selectedServices]]),t("span",ie,_(l.name),1)]))),128))]))])]),t("div",de,[y(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>o.localForm.is_active=l),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[E,o.localForm.is_active]]),e[26]||(e[26]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),u.error?(i(),s("div",ce,_(u.error),1)):v("",!0),t("div",ue,[t("button",{type:"button",onClick:e[11]||(e[11]=(...l)=>o.handleCancel&&o.handleCancel(...l)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:u.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},_(u.saving?"Сохранение...":"Сохранить"),9,me)])],32),o.showImageMediaModal?(i(),s("div",be,[t("div",ve,[t("div",ge,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[13]||(e[13]=l=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",fe,[S(m,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):v("",!0),o.showIconMediaModal?(i(),s("div",xe,[t("div",_e,[t("div",he,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:e[14]||(e[14]=l=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",ye,[S(m,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):v("",!0)],64)}const pe=P(W,[["render",ke]]),we={name:"ProductFormPage",components:{ProductForm:pe},setup(){const n=R(),e=q(),u=c(!1),o=c(!1),g=c(null),b=c(null),m=c({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,html_content:"",image:null,icon:null,order:0,is_active:!0}),l=G(()=>!!n.params.id),f=async()=>{if(!l.value){u.value=!1;return}u.value=!0,g.value=null;try{const x=await F(`/products/${n.params.id}`);if(!x.ok)throw new Error("Ошибка загрузки продукта");const a=await x.json();a.data&&(m.value={id:a.data.id,name:a.data.name||"",slug:a.data.slug||"",chapter_id:a.data.chapter_id||null,image_id:a.data.image_id||null,icon_id:a.data.icon_id||null,html_content:a.data.html_content||"",image:a.data.image||null,icon:a.data.icon||null,order:a.data.order??0,is_active:a.data.is_active!==!1,services:a.data.services||[]})}catch(x){g.value=x.message||"Ошибка загрузки продукта",console.error("Error fetching product:",x)}finally{u.value=!1}},h=async x=>{o.value=!0,b.value=null;try{const a=l.value?`/products/${n.params.id}`:"/products",p=await(l.value?O:J)(a,x);if(!p.ok){const I=await p.json().catch(()=>({}));throw new Error(I.message||`Ошибка ${l.value?"обновления":"создания"} продукта`)}await K.fire({title:l.value?"Продукт обновлен":"Продукт создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.products"})}catch(a){b.value=a.message||"Ошибка сохранения продукта"}finally{o.value=!1}},d=()=>{e.push({name:"admin.decisions.products"})};return V(()=>{f()}),{loading:u,saving:o,error:g,formError:b,form:m,isEdit:l,saveProduct:h,goBack:d}}},Ie={class:"product-form-page space-y-6"},Me={class:"flex items-center justify-between"},Se={class:"text-3xl font-semibold text-foreground"},Fe={key:0,class:"flex items-center justify-center py-12"},Ce={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},je={class:"text-destructive"},Ee={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Pe(n,e,u,o,g,b){const m=B("ProductForm");return i(),s("div",Ie,[t("div",Me,[t("div",null,[t("h1",Se,_(o.isEdit?"Редактировать продукт":"Создать продукт"),1),e[1]||(e[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление продуктом для блока решений",-1))]),t("button",{onClick:e[0]||(e[0]=(...l)=>o.goBack&&o.goBack(...l)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(i(),s("div",Fe,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):v("",!0),o.error?(i(),s("div",Ce,[t("p",je,_(o.error),1)])):v("",!0),o.loading?v("",!0):(i(),s("div",Ee,[S(m,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveProduct,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const Te=P(we,[["render",Pe]]);export{Te as default};
