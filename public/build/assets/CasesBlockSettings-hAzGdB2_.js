import{_ as B,c as r,b as t,d as b,t as g,l as _,v as V,q as j,F as k,k as h,h as u,j as F,J as x,o as l,D as I}from"./app-Sq4bpJln.js";import{S as C}from"./sweetalert2.esm.all-C0u8rGqG.js";const M={name:"CasesBlockSettings",setup(){const v=u(!0),e=u(!1),c=u(null),s=u([]),a=u({title:"",is_active:!0,case_ids:[]}),y=async()=>{v.value=!0,c.value=null;try{const o=await x.get("/api/v1/cases-block-settings");o.data&&o.data.data&&(a.value={title:o.data.data.title||"",is_active:o.data.data.is_active!==!1,case_ids:o.data.data.case_ids||[]})}catch(o){c.value=o.response?.data?.message||"Ошибка загрузки настроек",console.error("Error fetching settings:",o)}finally{v.value=!1}},n=async()=>{try{const o=await x.get("/api/v1/cases?active=1");o.data&&o.data.data&&(s.value=o.data.data)}catch(o){console.error("Error fetching cases:",o)}},d=o=>{const m=a.value.case_ids.filter((f,p)=>p!==o&&f!==null);return s.value.filter(f=>!m.includes(f.id))},i=()=>{a.value.case_ids.length<2&&a.value.case_ids.push(null)},w=o=>{a.value.case_ids&&a.value.case_ids.length>o&&a.value.case_ids.splice(o,1)},S=async()=>{e.value=!0,c.value=null;try{const o=a.value.case_ids.filter(p=>p!==null),m={title:a.value.title,is_active:a.value.is_active,case_ids:o},f=await x.put("/api/v1/cases-block-settings",m);await C.fire({title:"Настройки сохранены",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(o){c.value=o.response?.data?.message||"Ошибка сохранения настроек",await C.fire({title:"Ошибка",text:c.value,icon:"error",confirmButtonText:"ОК"})}finally{e.value=!1}};return F(async()=>{await Promise.all([y(),n()])}),{loading:v,saving:e,error:c,form:a,availableCases:s,getAvailableCasesForIndex:d,addCase:i,removeCase:w,saveSettings:S}}},U={class:"cases-block-settings-page space-y-6"},D={key:0,class:"flex items-center justify-center py-12"},E={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},T={class:"text-destructive"},A={key:2,class:"space-y-6"},N={class:"bg-card rounded-lg border border-border p-6 space-y-6"},q={class:"space-y-4"},J={class:"flex items-center gap-2"},L={class:"bg-card rounded-lg border border-border p-6 space-y-6"},P={key:0,class:"text-center py-8 text-muted-foreground"},z={key:1,class:"space-y-4"},G={class:"flex items-center justify-between"},H={class:"font-semibold text-foreground"},K=["onClick"],O=["onUpdate:modelValue"],Q=["value"],R={class:"flex justify-end gap-3 pt-4 border-t border-border"},W=["disabled"];function X(v,e,c,s,a,y){return l(),r("div",U,[e[12]||(e[12]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},'Настройки блока "Кейсы и объекты"'),t("p",{class:"text-muted-foreground mt-1"},'Управление блоком "Кейсы и объекты" на главной странице')],-1)),s.loading?(l(),r("div",D,[...e[4]||(e[4]=[t("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):b("",!0),s.error?(l(),r("div",E,[t("p",T,g(s.error),1)])):b("",!0),s.loading?b("",!0):(l(),r("div",A,[t("div",N,[e[7]||(e[7]=t("h2",{class:"text-xl font-semibold text-foreground"},"Общие настройки",-1)),t("div",q,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Заголовок блока ",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.form.title=n),type:"text",placeholder:"Кейсы и объекты",class:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[V,s.form.title]])]),t("div",J,[_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.is_active=n),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[j,s.form.is_active]]),e[6]||(e[6]=t("label",{for:"is_active",class:"text-sm font-medium text-foreground"}," Блок активен на главной странице ",-1))])])]),t("div",L,[e[11]||(e[11]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-xl font-semibold text-foreground"},"Выбор кейсов (максимум 2)")],-1)),s.availableCases.length===0?(l(),r("div",P,[...e[8]||(e[8]=[t("p",null,'Нет доступных кейсов. Создайте кейсы в разделе "Кейсы".',-1)])])):(l(),r("div",z,[(l(!0),r(k,null,h(s.form.case_ids,(n,d)=>(l(),r("div",{key:d,class:"border border-border rounded-lg p-4 space-y-4"},[t("div",G,[t("h3",H,"Кейс "+g(d+1),1),t("button",{onClick:i=>s.removeCase(d),class:"px-3 py-1 text-sm text-destructive hover:bg-destructive/10 rounded transition-colors"}," Удалить ",8,K)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Выберите кейс ",-1)),_(t("select",{"onUpdate:modelValue":i=>s.form.case_ids[d]=i,class:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[e[9]||(e[9]=t("option",{value:null},"Выберите кейс",-1)),(l(!0),r(k,null,h(s.getAvailableCasesForIndex(d),i=>(l(),r("option",{key:i.id,value:i.id},g(i.name),9,Q))),128))],8,O),[[I,s.form.case_ids[d]]])])]))),128)),s.form.case_ids.length<2?(l(),r("button",{key:0,onClick:e[2]||(e[2]=(...n)=>s.addCase&&s.addCase(...n)),class:"w-full px-4 py-2 bg-accent/10 text-accent border border-accent/40 rounded-lg hover:bg-accent/20 transition-colors text-sm font-medium"}," + Добавить кейс ")):b("",!0)]))]),t("div",R,[t("button",{onClick:e[3]||(e[3]=(...n)=>s.saveSettings&&s.saveSettings(...n)),disabled:s.saving,class:"px-6 py-2 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"},g(s.saving?"Сохранение...":"Сохранить настройки"),9,W)])]))])}const $=B(M,[["render",X],["__scopeId","data-v-b1e504b4"]]);export{$ as default};
