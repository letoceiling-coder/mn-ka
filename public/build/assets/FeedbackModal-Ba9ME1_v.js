import{_ as M,h as c,y as k,i as V,c as d,d as f,b as r,p as w,l as p,f as _,v as x,A as h,t as g,a as S,r as F,o as i}from"./app-vhXqaPpI.js";import{S as j}from"./sweetalert2.esm.all-C0u8rGqG.js";import{C as T}from"./ConsentCheckbox-C90yKJFb.js";const B={name:"FeedbackModal",components:{ConsentCheckbox:T},props:{isOpen:{type:Boolean,default:!1}},emits:["close","success"],setup(y,{emit:o}){const b=c(!1),e=c(null),v=c(!1),m=c({}),u=c(!1),s=c(!1),n=c({name:"",phone:"",email:"",message:""}),C=l=>{const a=l.replace(/\D/g,"");if(a.startsWith("8")){const t=a.slice(1).match(/^(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})$/);if(t)return"+7 ("+(t[1]?t[1]:"")+(t[2]?") "+t[2]:"")+(t[3]?"-"+t[3]:"")+(t[4]?"-"+t[4]:"")}else if(a.startsWith("7")){const t=a.slice(1).match(/^(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})$/);if(t)return"+7 ("+(t[1]?t[1]:"")+(t[2]?") "+t[2]:"")+(t[3]?"-"+t[3]:"")+(t[4]?"-"+t[4]:"")}return l};k(()=>n.value.phone,l=>{const a=C(l);a!==l&&(n.value.phone=a)}),k(()=>n.value.message,l=>{l.length>5e3&&(n.value.message=l.slice(0,5e3))}),k(()=>y.isOpen,l=>{l||setTimeout(()=>{n.value={name:"",phone:"",email:"",message:""},m.value={},e.value=null,v.value=!1,u.value=!1,s.value=!1},300)});const E=V(()=>n.value.name.trim()!==""&&n.value.message.trim()!==""&&u.value);return{form:n,errors:m,error:e,success:v,loading:b,canSubmit:E,consentGiven:u,consentError:s,closeModal:()=>{o("close")},submitForm:async()=>{if(!b.value){if(m.value={},e.value=null,s.value=!1,!u.value){s.value=!0;return}if(n.value.name.trim()===""||n.value.message.trim()===""){n.value.name.trim()===""&&(m.value.name="Поле обязательно для заполнения"),n.value.message.trim()===""&&(m.value.message="Поле обязательно для заполнения");return}b.value=!0;try{const l=await fetch("/api/public/feedback",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:n.value.name.trim(),phone:n.value.phone.trim()||null,email:n.value.email.trim()||null,message:n.value.message.trim()})}),a=await l.json();if(!l.ok)throw a.errors&&(m.value=a.errors),new Error(a.message||"Ошибка при отправке формы");v.value=!0,n.value={name:"",phone:"",email:"",message:""},u.value=!1,s.value=!1,await j.fire({icon:"success",title:"Спасибо!",text:"Ваше сообщение успешно отправлено. Мы свяжемся с вами в ближайшее время.",timer:3e3,showConfirmButton:!1}),setTimeout(()=>{o("success"),o("close")},500)}catch(l){e.value=l.message||"Ошибка при отправке формы",console.error("Error submitting feedback:",l)}finally{b.value=!1}}}}}},N={class:"bg-background rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto"},O={class:"flex items-center justify-between p-6 border-b border-border"},U={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},q={key:0,class:"mt-1 text-sm text-red-500"},z={key:0,class:"mt-1 text-sm text-red-500"},A={key:0,class:"mt-1 text-sm text-red-500"},D={key:0,class:"mt-1 text-sm text-red-500"},G={class:"mt-1 text-xs text-muted-foreground"},L={class:"pt-2"},W={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},J={class:"text-sm text-red-600"},K={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},P={class:"flex justify-end gap-4 pt-4"},R=["disabled"],X=["disabled"],H={key:0},I={key:1};function Q(y,o,b,e,v,m){const u=F("ConsentCheckbox");return b.isOpen?(i(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:o[9]||(o[9]=w((...s)=>e.closeModal&&e.closeModal(...s),["self"]))},[r("div",N,[r("div",O,[o[11]||(o[11]=r("h2",{class:"text-2xl font-semibold text-foreground"},"Обратная связь",-1)),r("button",{onClick:o[0]||(o[0]=(...s)=>e.closeModal&&e.closeModal(...s)),class:"text-muted-foreground hover:text-foreground transition-colors",type:"button"},[...o[10]||(o[10]=[r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),r("form",{onSubmit:o[8]||(o[8]=w((...s)=>e.submitForm&&e.submitForm(...s),["prevent"])),class:"p-6 space-y-6"},[r("div",U,[r("div",null,[o[12]||(o[12]=r("label",{for:"modal-name",class:"block text-sm font-medium text-foreground mb-2"},[_(" Имя "),r("span",{class:"text-red-500"},"*")],-1)),p(r("input",{id:"modal-name","onUpdate:modelValue":o[1]||(o[1]=s=>e.form.name=s),type:"text",required:"",placeholder:"Ваше имя",class:h(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.name}])},null,2),[[x,e.form.name]]),e.errors.name?(i(),d("p",q,g(e.errors.name),1)):f("",!0)]),r("div",null,[o[13]||(o[13]=r("label",{for:"modal-phone",class:"block text-sm font-medium text-foreground mb-2"}," Телефон ",-1)),p(r("input",{id:"modal-phone","onUpdate:modelValue":o[2]||(o[2]=s=>e.form.phone=s),type:"tel",placeholder:"+7 (___) ___-__-__",class:h(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.phone}])},null,2),[[x,e.form.phone]]),e.errors.phone?(i(),d("p",z,g(e.errors.phone),1)):f("",!0)])]),r("div",null,[o[14]||(o[14]=r("label",{for:"modal-email",class:"block text-sm font-medium text-foreground mb-2"}," Email ",-1)),p(r("input",{id:"modal-email","onUpdate:modelValue":o[3]||(o[3]=s=>e.form.email=s),type:"email",placeholder:"your@email.com",class:h(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.email}])},null,2),[[x,e.form.email]]),e.errors.email?(i(),d("p",A,g(e.errors.email),1)):f("",!0)]),r("div",null,[o[15]||(o[15]=r("label",{for:"modal-message",class:"block text-sm font-medium text-foreground mb-2"},[_(" Сообщение "),r("span",{class:"text-red-500"},"*")],-1)),p(r("textarea",{id:"modal-message","onUpdate:modelValue":o[4]||(o[4]=s=>e.form.message=s),required:"",rows:"6",placeholder:"Введите ваше сообщение...",class:h(["w-full px-4 py-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent resize-none transition-colors",{"border-red-500":e.errors.message}])},null,2),[[x,e.form.message]]),e.errors.message?(i(),d("p",D,g(e.errors.message),1)):f("",!0),r("p",G,g(e.form.message.length)+"/5000 символов ",1)]),r("div",L,[S(u,{modelValue:e.consentGiven,"onUpdate:modelValue":o[5]||(o[5]=s=>e.consentGiven=s),error:e.consentError,"onUpdate:error":o[6]||(o[6]=s=>e.consentError=s)},null,8,["modelValue","error"])]),e.error?(i(),d("div",W,[r("p",J,g(e.error),1)])):f("",!0),e.success?(i(),d("div",K,[...o[16]||(o[16]=[r("p",{class:"text-sm text-green-600"}," Спасибо за ваше обращение! Мы свяжемся с вами в ближайшее время. ",-1)])])):f("",!0),r("div",P,[r("button",{type:"button",onClick:o[7]||(o[7]=(...s)=>e.closeModal&&e.closeModal(...s)),class:"px-6 py-3 border border-border rounded-lg hover:bg-muted transition-colors font-medium",disabled:e.loading}," Отмена ",8,R),r("button",{type:"submit",disabled:e.loading||!e.canSubmit,class:"px-6 py-3 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium"},[e.loading?(i(),d("span",H,"Отправка...")):(i(),d("span",I,"Отправить"))],8,X)])],32)])])):f("",!0)}const re=M(B,[["render",Q]]);export{re as F};
