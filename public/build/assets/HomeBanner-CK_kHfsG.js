import{_ as S,c as a,b as t,d as g,t as k,l as s,v as i,D as U,f as j,q as B,p as h,a as C,h as f,j as D,r as N,o as u}from"./app-CRdfpcqh.js";import{a as F,b as P,c as R}from"./api-V9GPpd21.js";import{S as y}from"./sweetalert2.esm.all-C0u8rGqG.js";import L from"./Media-Cfn_wXcd.js";import"./index-Cfbe3OCu.js";/* empty css                        */const q={name:"HomeBanner",components:{Media:L},setup(){const x=f(!1),e=f(!1),m=f(null),o=f(!1),c=f(null),d=f({id:null,title:"Баннер на главной",slug:"home-banner",background_image:null,heading_1:"",heading_2:"",description:"",button_text:"",button_type:"url",button_value:"",height_desktop:380,height_mobile:300,is_active:!0}),p=async()=>{x.value=!0,m.value=null;try{const n=await F("/banners");if(n.ok){const l=(await n.json()).data?.find(v=>v.slug==="home-banner");l&&(d.value={id:l.id,title:l.title,slug:l.slug,background_image:l.background_image||null,heading_1:l.heading_1||"",heading_2:l.heading_2||"",description:l.description||"",button_text:l.button_text||"",button_type:l.button_type||"url",button_value:l.button_value||"",height_desktop:l.height_desktop||380,height_mobile:l.height_mobile||300,is_active:l.is_active!==void 0?l.is_active:!0})}}catch(n){m.value=n.message||"Ошибка загрузки баннера"}finally{x.value=!1}},r=()=>{o.value=!0},_=()=>{o.value=!1,c.value&&c.value.click()},w=async n=>{const b=n.target.files?.[0];if(!b)return;const l=new FileReader;l.onload=v=>{d.value.background_image=v.target.result},l.readAsDataURL(b)},M=n=>{if(console.log("handleImageSelected called with file:",n),n&&n.type==="photo"){const b=n.url.replace(/^\//,"");console.log("Setting background_image to:",b),d.value.background_image=b,o.value=!1}else console.warn("File is not a photo:",n)},I=async()=>{e.value=!0,m.value=null;try{const n=d.value.id?`/banners/${d.value.id}`:"/banners",l=await(d.value.id?P:R)(n,{title:d.value.title,slug:d.value.slug,background_image:d.value.background_image,heading_1:d.value.heading_1,heading_2:d.value.heading_2,description:d.value.description,button_text:d.value.button_text,button_type:d.value.button_type,button_value:d.value.button_value,height_desktop:d.value.height_desktop,height_mobile:d.value.height_mobile,is_active:d.value.is_active});if(!l.ok){const V=await l.json();throw new Error(V.message||"Ошибка сохранения")}const v=await l.json();d.value.id=v.data.id,await y.fire("Успешно!","Баннер успешно сохранен.","success"),await p()}catch(n){m.value=n.message||"Ошибка сохранения баннера",await y.fire("Ошибка!",n.message||"Не удалось сохранить баннер.","error")}finally{e.value=!1}};return D(()=>{p()}),{loading:x,saving:e,error:m,form:d,showMediaModal:o,imageInput:c,selectImage:r,uploadNewImage:_,handleImageSelect:w,handleImageSelected:M,saveBanner:I}}},E={class:"home-banner-page space-y-6"},H={key:0,class:"flex items-center justify-center py-12"},T={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},W={class:"text-destructive"},z={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"space-y-3"},G={key:0,class:"relative"},J=["src"],K={class:"mt-2 flex gap-2"},O={key:1},Q={class:"border-t border-border pt-6"},X={class:"mb-4"},Y={class:"mb-4"},Z={key:0},$={key:1},ee={class:"border-t border-border pt-6"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"flex items-center gap-2"},re={class:"flex gap-3 pt-4 border-t border-border"},le=["disabled"],de={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col my-auto"},ne={class:"p-4 border-b border-border flex items-center justify-between flex-shrink-0"},se={class:"flex-1 overflow-auto h-full"};function ae(x,e,m,o,c,d){const p=N("Media");return u(),a("div",E,[e[42]||(e[42]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Баннер на главной"),t("p",{class:"text-muted-foreground mt-1"},"Настройка главного баннера сайта")])],-1)),o.loading?(u(),a("div",H,[...e[18]||(e[18]=[t("p",{class:"text-muted-foreground"},"Загрузка баннера...",-1)])])):g("",!0),o.error?(u(),a("div",T,[t("p",W,k(o.error),1)])):g("",!0),o.loading?g("",!0):(u(),a("div",z,[t("form",{onSubmit:e[15]||(e[15]=h((...r)=>o.saveBanner&&o.saveBanner(...r),["prevent"])),class:"p-6 space-y-6"},[t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-2 block"},"Название баннера",-1)),s(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.title=r),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Баннер на главной"},null,512),[[i,o.form.title]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-2 block"},"Фоновое изображение",-1)),t("div",A,[o.form.background_image?(u(),a("div",G,[t("img",{src:o.form.background_image.startsWith("data:")||o.form.background_image.startsWith("/")?o.form.background_image:`/${o.form.background_image}`,alt:"Preview",class:"w-full h-48 object-cover rounded border border-border"},null,8,J),t("div",K,[t("button",{type:"button",onClick:e[1]||(e[1]=(...r)=>o.selectImage&&o.selectImage(...r)),class:"px-4 py-2 bg-accent/10 text-accent border border-accent/40 rounded hover:bg-accent/20"}," Изменить изображение "),t("button",{type:"button",onClick:e[2]||(e[2]=r=>o.form.background_image=null),class:"px-4 py-2 bg-destructive/10 text-destructive border border-destructive/40 rounded hover:bg-destructive/20"}," Удалить ")])])):(u(),a("div",O,[t("button",{type:"button",onClick:e[3]||(e[3]=(...r)=>o.selectImage&&o.selectImage(...r)),class:"w-full h-32 border-2 border-dashed border-border rounded flex items-center justify-center hover:bg-muted/10 transition-colors"},[...e[20]||(e[20]=[t("span",{class:"text-muted-foreground"},"Выберите изображение",-1)])])]))]),t("input",{ref:"imageInput",type:"file",accept:"image/*",class:"hidden",onChange:e[4]||(e[4]=(...r)=>o.handleImageSelect&&o.handleImageSelect(...r))},null,544),e[22]||(e[22]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Рекомендуемый размер: 1920x700px",-1))]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium mb-2 block"},"Заголовок (первая строка)",-1)),s(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.heading_1=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Подберём и оформим"},null,512),[[i,o.form.heading_1]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-2 block"},"Заголовок (вторая строка)",-1)),s(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.heading_2=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"участок под ваш проект"},null,512),[[i,o.form.heading_2]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),s(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.description=r),rows:"3",class:"w-full px-3 py-2 border border-border rounded bg-background text-foreground",placeholder:`— от ИЖС до складов
и ритейла`},null,512),[[i,o.form.description]]),e[26]||(e[26]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Используйте перенос строки для многострочного текста",-1))]),t("div",Q,[e[33]||(e[33]=t("h3",{class:"text-lg font-semibold mb-4"},"Настройки кнопки",-1)),t("div",X,[e[27]||(e[27]=t("label",{class:"text-sm font-medium mb-2 block"},"Текст кнопки",-1)),s(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.button_text=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Подробнее"},null,512),[[i,o.form.button_text]])]),t("div",Y,[e[29]||(e[29]=t("label",{class:"text-sm font-medium mb-2 block"},"Тип кнопки",-1)),s(t("select",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.button_type=r),class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground"},[...e[28]||(e[28]=[t("option",{value:"url"},"URL (ссылка)",-1),t("option",{value:"method"},"Метод (popup)",-1)])],512),[[U,o.form.button_type]])]),o.form.button_type==="url"?(u(),a("div",Z,[e[30]||(e[30]=t("label",{class:"text-sm font-medium mb-2 block"},"URL",-1)),s(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.button_value=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"/page или https://example.com"},null,512),[[i,o.form.button_value]])])):g("",!0),o.form.button_type==="method"?(u(),a("div",$,[e[31]||(e[31]=t("label",{class:"text-sm font-medium mb-2 block"},"ID метода",-1)),s(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.button_value=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Методы будут добавлены позже",disabled:""},null,512),[[i,o.form.button_value]]),e[32]||(e[32]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Выбор методов будет доступен после создания функционала методов",-1))])):g("",!0)]),t("div",ee,[e[38]||(e[38]=t("h3",{class:"text-lg font-semibold mb-4"},"Настройки высоты",-1)),t("div",te,[t("div",null,[e[34]||(e[34]=t("label",{class:"text-sm font-medium mb-2 block"}," Высота для десктопа (px) ",-1)),s(t("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.height_desktop=r),type:"number",min:"100",max:"2000",step:"10",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"380"},null,512),[[i,o.form.height_desktop,void 0,{number:!0}]]),e[35]||(e[35]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Высота баннера на больших экранах (от 1024px) ",-1))]),t("div",null,[e[36]||(e[36]=t("label",{class:"text-sm font-medium mb-2 block"}," Высота для мобильных (px) ",-1)),s(t("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>o.form.height_mobile=r),type:"number",min:"100",max:"2000",step:"10",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"300"},null,512),[[i,o.form.height_mobile,void 0,{number:!0}]]),e[37]||(e[37]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Высота баннера на мобильных устройствах (до 640px) ",-1))])]),e[39]||(e[39]=t("div",{class:"mt-4 p-4 bg-muted/50 rounded-lg"},[t("p",{class:"text-sm text-muted-foreground"},[t("strong",null,"Совет:"),j(" Высота будет плавно изменяться между мобильной и десктопной версией в зависимости от ширины экрана. Например, если установить 380px для десктопа и 300px для мобильных, то на экране шириной 320px высота будет 300px, а на экране 1200px+ - 380px. ")])],-1))]),t("div",oe,[s(t("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>o.form.is_active=r),type:"checkbox",id:"is_active",class:"w-4 h-4"},null,512),[[B,o.form.is_active]]),e[40]||(e[40]=t("label",{for:"is_active",class:"text-sm font-medium"},"Активен",-1))]),t("div",re,[t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},k(o.saving?"Сохранение...":"Сохранить"),9,le)])],32)])),o.showMediaModal?(u(),a("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm overflow-y-auto p-4",onClick:e[17]||(e[17]=h(r=>o.showMediaModal=!1,["self"]))},[t("div",de,[t("div",ne,[e[41]||(e[41]=t("h3",{class:"text-lg font-semibold"},"Выберите изображение",-1)),t("button",{onClick:e[16]||(e[16]=r=>o.showMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",se,[C(p,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):g("",!0)])}const ve=S(q,[["render",ae]]);export{ve as default};
