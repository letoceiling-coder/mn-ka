import{_,h as b,z as S,j as y,c as i,b as r,d as g,l as f,v as x,D as E,F as B,k as V,q as j,t as v,p as D,o as d,a as q,C as M,i as U,r as N,E as P}from"./app-BED68XM5.js";import{a as k,b as R,c as z}from"./api-V9GPpd21.js";import{S as G}from"./sweetalert2.esm.all-C0u8rGqG.js";const I={name:"CaseForm",props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(s,{emit:e}){const n=b([]),o=b({name:s.initialData.name||"",slug:s.initialData.slug||"",chapter_id:s.initialData.chapter_id||null,order:s.initialData.order??0,is_active:s.initialData.is_active!==!1}),c=async()=>{try{const a=await k("/chapters");if(a.ok){const p=await a.json();n.value=p.data||[]}}catch(a){console.error("Error fetching chapters:",a)}};S(()=>s.initialData,a=>{o.value={name:a.name||"",slug:a.slug||"",chapter_id:a.chapter_id||null,order:a.order??0,is_active:a.is_active!==!1}},{deep:!0});const u=()=>{e("submit",{name:o.value.name,slug:o.value.slug||null,chapter_id:o.value.chapter_id||null,order:o.value.order,is_active:o.value.is_active})},t=()=>{e("cancel")};return y(()=>{c()}),{chapters:n,localForm:o,handleSubmit:u,handleCancel:t}}},L=["value"],O={class:"flex items-center gap-2"},T={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},A={class:"flex gap-2 pt-4"},H=["disabled"];function J(s,e,n,o,c,u){return d(),i("form",{onSubmit:e[6]||(e[6]=D((...t)=>o.handleSubmit&&o.handleSubmit(...t),["prevent"])),class:"space-y-4"},[r("div",null,[e[7]||(e[7]=r("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),f(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.localForm.name=t),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название случая"},null,512),[[x,o.localForm.name]])]),r("div",null,[e[8]||(e[8]=r("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.localForm.slug=t),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[x,o.localForm.slug]]),e[9]||(e[9]=r("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),r("div",null,[e[11]||(e[11]=r("label",{class:"text-sm font-medium mb-1 block"},"Раздел *",-1)),f(r("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.localForm.chapter_id=t),required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[10]||(e[10]=r("option",{value:null},"Не выбран",-1)),(d(!0),i(B,null,V(o.chapters,t=>(d(),i("option",{key:t.id,value:t.id},v(t.name),9,L))),128))],512),[[E,o.localForm.chapter_id]])]),r("div",null,[e[12]||(e[12]=r("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),f(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.localForm.order=t),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[x,o.localForm.order,void 0,{number:!0}]])]),r("div",O,[f(r("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.localForm.is_active=t),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[j,o.localForm.is_active]]),e[13]||(e[13]=r("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),n.error?(d(),i("div",T,v(n.error),1)):g("",!0),r("div",A,[r("button",{type:"button",onClick:e[5]||(e[5]=(...t)=>o.handleCancel&&o.handleCancel(...t)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),r("button",{type:"submit",disabled:n.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},v(n.saving?"Сохранение...":"Сохранить"),9,H)])],32)}const K=_(I,[["render",J]]),Q={name:"CaseFormPage",components:{CaseForm:K},setup(){const s=M(),e=P(),n=b(!1),o=b(!1),c=b(null),u=b(null),t=b({id:null,name:"",slug:"",chapter_id:s.query.chapter_id?parseInt(s.query.chapter_id):null,order:0,is_active:!0}),a=U(()=>!!s.params.id),p=async()=>{if(!a.value){n.value=!1;return}n.value=!0,c.value=null;try{const m=await k(`/cases/${s.params.id}`);if(!m.ok)throw new Error("Ошибка загрузки случая");const l=await m.json();l.data&&(t.value={id:l.data.id,name:l.data.name||"",slug:l.data.slug||"",chapter_id:l.data.chapter_id||null,order:l.data.order??0,is_active:l.data.is_active!==!1})}catch(m){c.value=m.message||"Ошибка загрузки случая",console.error("Error fetching case:",m)}finally{n.value=!1}},C=async m=>{o.value=!0,u.value=null;try{const l=a.value?`/cases/${s.params.id}`:"/cases",h=await(a.value?R:z)(l,m);if(!h.ok){const w=await h.json().catch(()=>({}));throw new Error(w.message||`Ошибка ${a.value?"обновления":"создания"} случая`)}await G.fire({title:a.value?"Случай обновлен":"Случай создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.cases"})}catch(l){u.value=l.message||"Ошибка сохранения случая"}finally{o.value=!1}},F=()=>{e.push({name:"admin.decisions.cases"})};return y(()=>{p()}),{loading:n,saving:o,error:c,formError:u,form:t,isEdit:a,saveCase:C,goBack:F}}},W={class:"case-form-page space-y-6"},X={class:"flex items-center justify-between"},Y={class:"text-3xl font-semibold text-foreground"},Z={key:0,class:"flex items-center justify-center py-12"},$={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ee={class:"text-destructive"},oe={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function re(s,e,n,o,c,u){const t=N("CaseForm");return d(),i("div",W,[r("div",X,[r("div",null,[r("h1",Y,v(o.isEdit?"Редактировать случай":"Создать случай"),1),e[1]||(e[1]=r("p",{class:"text-muted-foreground mt-1"},"Управление случаем для блока решений",-1))]),r("button",{onClick:e[0]||(e[0]=(...a)=>o.goBack&&o.goBack(...a)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(d(),i("div",Z,[...e[2]||(e[2]=[r("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):g("",!0),o.error?(d(),i("div",$,[r("p",ee,v(o.error),1)])):g("",!0),o.loading?g("",!0):(d(),i("div",oe,[q(t,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveCase,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const le=_(Q,[["render",re]]);export{le as default};
