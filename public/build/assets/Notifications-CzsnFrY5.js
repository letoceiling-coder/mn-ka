import{_ as U,c as i,b as e,d as f,l as N,v as J,D as S,s as P,t as l,F as C,k as M,p as G,x as k,a as H,w as K,h as m,j as Q,r as W,E as X,o as a,f as Y}from"./app-Bosgd5Z3.js";import{S as j}from"./sweetalert2.esm.all-C0u8rGqG.js";const Z={name:"Notifications",setup(){const T=X(),o=m(!1),_=m(null),t=m([]),w=m(null),p=m({search:"",read:null,type:""}),b=m(1),n=m(20),x=m(null),v=m(null),h=async(s=1)=>{o.value=!0,_.value=null;try{const r=new URLSearchParams;r.append("page",s),r.append("per_page",n.value),p.value.search&&r.append("search",p.value.search),p.value.read!==null&&r.append("read",p.value.read?"1":"0"),p.value.type&&r.append("type",p.value.type);const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};c&&(g.Authorization=`Bearer ${c}`);const d=await fetch(`/api/notifications/all?${r.toString()}`,{method:"GET",headers:g});if(!d.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π");const u=await d.json();t.value=u.data||[],w.value={current_page:u.current_page||1,last_page:u.last_page||1,per_page:u.per_page||n.value,total:u.total||0,from:u.from||0,to:u.to||0},b.value=u.current_page||1}catch(r){_.value=r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"}finally{o.value=!1}},B=()=>{x.value&&clearTimeout(x.value),x.value=setTimeout(()=>{b.value=1,h(1)},500)},z=()=>{b.value=1,h(1)},A=s=>{h(s)},y=async s=>{try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`),(await fetch(`/api/notifications/${s}/read`,{method:"POST",headers:c})).ok&&await h(b.value)}catch(r){console.error("Error marking notification as read:",r)}},E=async s=>{if((await j.fire({title:"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",text:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};if(c&&(g.Authorization=`Bearer ${c}`),!(await fetch(`/api/notifications/${s}`,{method:"DELETE",headers:g})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");await j.fire({title:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await h(b.value)}catch(c){j.fire({title:"–û—à–∏–±–∫–∞",text:c.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}},D=s=>s?new Date(s).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",V=s=>({info:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",success:"–£—Å–ø–µ—Ö",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",error:"–û—à–∏–±–∫–∞"})[s]||s,F=s=>({info:"bg-blue-500/10 text-blue-500",success:"bg-green-500/10 text-green-500",warning:"bg-yellow-500/10 text-yellow-500",error:"bg-red-500/10 text-red-500"})[s]||"bg-muted text-muted-foreground",L=async s=>{try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`);const g=await fetch(`/api/notifications/${s.id}`,{method:"GET",headers:c});if(!g.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");const u=(await g.json()).data;if(u.data&&u.data.quiz_id){u.read||await y(u.id),T.push(`/admin/notifications/quiz/${u.data.quiz_id}?notification_id=${u.id}`);return}v.value=u,u.read||await y(u.id)}catch(r){console.error("Error loading notification:",r),v.value=s}},q=()=>{v.value=null},R=async s=>{await y(s),v.value&&(v.value.read=!0,v.value.read_at=new Date().toISOString())},I=s=>s==null?"–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞":typeof s=="object"?s.text?s.text:s.value?s.value:s.name?s.name:s.title?s.title:Array.isArray(s)?s.map(r=>typeof r=="object"?r.name||r.title||JSON.stringify(r):r).join(", "):JSON.stringify(s,null,2):String(s),O=(s,r)=>{const c=[];if(r<=5)for(let d=1;d<=r;d++)c.push(d);else if(s<=3)for(let d=1;d<=5;d++)c.push(d);else if(s>=r-2)for(let d=r-4;d<=r;d++)c.push(d);else for(let d=s-2;d<=s+2;d++)c.push(d);return c};return Q(()=>{h(1)}),{loading:o,error:_,notifications:t,pagination:w,filters:p,handleSearch:B,handleFilterChange:z,handlePageChange:A,markAsRead:y,deleteNotification:E,formatDate:D,getTypeLabel:V,getTypeClass:F,getPageNumbers:O,selectedNotification:v,viewNotification:L,closeNotificationModal:q,markAsReadFromModal:R,formatAnswer:I}}},$={class:"notifications-page space-y-6"},tt={class:"bg-card rounded-lg border border-border p-4"},et={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ot={class:"md:col-span-2"},nt={class:"relative"},st={key:0,class:"flex items-center justify-center py-12"},rt={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},it={class:"text-destructive"},at={key:2,class:"space-y-3"},lt={class:"flex items-start justify-between gap-4"},dt={class:"flex-1 min-w-0"},ct={class:"flex items-center gap-2 mb-2"},ut={class:"font-semibold text-foreground"},ft={key:0,class:"h-2 w-2 bg-accent rounded-full flex-shrink-0",title:"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"},gt={class:"text-sm text-muted-foreground mb-2"},mt={class:"flex items-center gap-4 text-xs text-muted-foreground"},pt={key:0},bt={class:"flex items-center gap-2 flex-shrink-0"},xt=["onClick"],vt=["onClick"],ht=["onClick"],_t={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},yt={key:4,class:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-border gap-4"},kt={class:"text-sm text-muted-foreground"},wt={class:"flex gap-2 items-center"},Nt=["disabled"],Ct={class:"flex gap-1"},jt=["onClick"],Tt=["disabled"],St={class:"bg-card rounded-lg border border-border shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Mt={class:"flex items-center justify-between p-6 border-b border-border"},Bt={class:"text-2xl font-semibold text-foreground"},zt={class:"flex items-center gap-2 mt-2"},At={class:"text-xs text-muted-foreground"},Et={class:"flex-1 overflow-y-auto p-6"},Dt={class:"space-y-6"},Vt={class:"text-foreground whitespace-pre-wrap"},Ft={key:0,class:"space-y-4"},Lt={key:0,class:"border-t border-border pt-4"},qt={class:"space-y-3"},Rt={class:"ml-2 text-foreground"},It={key:0,class:"mt-4"},Ot={class:"bg-muted/50 rounded-lg p-4 space-y-2"},Ut={class:"ml-2 text-foreground"},Jt={class:"ml-2 text-foreground"},Pt={class:"ml-2 text-foreground"},Gt={key:1,class:"mt-4"},Ht={class:"ml-2 text-foreground"},Kt={key:2,class:"mt-4"},Qt={class:"text-sm text-muted-foreground mb-3"},Wt={class:"mt-6"},Xt={key:1,class:"border-t border-border pt-4"},Yt={class:"bg-muted/50 rounded-lg p-4 text-xs overflow-auto"},Zt={class:"flex items-center justify-between p-6 border-t border-border bg-muted/30"},$t={class:"text-sm text-muted-foreground"},te={key:0},ee={key:1},oe={class:"flex gap-2"};function ne(T,o,_,t,w,p){const b=W("router-link");return a(),i(C,null,[e("div",$,[o[17]||(o[17]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),e("p",{class:"text-muted-foreground mt-1"},"–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")])],-1)),e("div",tt,[e("div",et,[e("div",ot,[e("div",nt,[o[12]||(o[12]=e("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),N(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>t.filters.search=n),onInput:o[1]||(o[1]=(...n)=>t.handleSearch&&t.handleSearch(...n)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[J,t.filters.search]])])]),e("div",null,[N(e("select",{"onUpdate:modelValue":o[2]||(o[2]=n=>t.filters.read=n),onChange:o[3]||(o[3]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[13]||(o[13]=[e("option",{value:null},"–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",-1),e("option",{value:!1},"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1),e("option",{value:!0},"–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1)])],544),[[S,t.filters.read]])]),e("div",null,[N(e("select",{"onUpdate:modelValue":o[4]||(o[4]=n=>t.filters.type=n),onChange:o[5]||(o[5]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[14]||(o[14]=[P('<option value="">–í—Å–µ —Ç–∏–ø—ã</option><option value="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option><option value="success">–£—Å–ø–µ—Ö</option><option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option><option value="error">–û—à–∏–±–∫–∞</option>',5)])],544),[[S,t.filters.type]])])])]),t.loading?(a(),i("div",st,[...o[15]||(o[15]=[e("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...",-1)])])):f("",!0),t.error?(a(),i("div",rt,[e("p",it,l(t.error),1)])):f("",!0),!t.loading&&t.notifications.length>0?(a(),i("div",at,[(a(!0),i(C,null,M(t.notifications,n=>(a(),i("div",{key:n.id,class:k(["bg-card rounded-lg border p-4 transition-colors",n.read?"border-border":"border-accent bg-accent/5"])},[e("div",lt,[e("div",dt,[e("div",ct,[e("h3",ut,l(n.title),1),n.read?f("",!0):(a(),i("span",ft)),e("span",{class:k(["px-2 py-1 text-xs rounded",t.getTypeClass(n.type)])},l(t.getTypeLabel(n.type)),3)]),e("p",gt,l(n.message),1),e("div",mt,[e("span",null,l(t.formatDate(n.created_at)),1),n.read_at?(a(),i("span",pt," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(t.formatDate(n.read_at)),1)):f("",!0)])]),e("div",bt,[e("button",{onClick:x=>t.viewNotification(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,xt),n.read?f("",!0):(a(),i("button",{key:0,onClick:x=>t.markAsRead(n.id),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded transition-colors",title:"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"}," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ ",8,vt)),e("button",{onClick:x=>t.deleteNotification(n.id),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors",title:"–£–¥–∞–ª–∏—Ç—å"}," –£–¥–∞–ª–∏—Ç—å ",8,ht)])])],2))),128))])):f("",!0),!t.loading&&t.notifications.length===0?(a(),i("div",_t,[...o[16]||(o[16]=[e("p",{class:"text-muted-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):f("",!0),t.pagination&&t.pagination.last_page>1?(a(),i("div",yt,[e("div",kt,[e("span",null," –ü–æ–∫–∞–∑–∞–Ω–æ "+l(t.pagination.from)+"-"+l(t.pagination.to)+" –∏–∑ "+l(t.pagination.total),1)]),e("div",wt,[e("button",{onClick:o[6]||(o[6]=n=>t.handlePageChange(t.pagination.current_page-1)),disabled:t.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,Nt),e("div",Ct,[(a(!0),i(C,null,M(t.getPageNumbers(t.pagination.current_page,t.pagination.last_page),n=>(a(),i("button",{key:n,onClick:x=>t.handlePageChange(n),class:k(["px-3 py-2 rounded-md border text-sm transition-colors min-w-[40px]",n===t.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},l(n),11,jt))),128))]),e("button",{onClick:o[7]||(o[7]=n=>t.handlePageChange(t.pagination.current_page+1)),disabled:t.pagination.current_page===t.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,Tt)])])):f("",!0)]),t.selectedNotification?(a(),i("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:o[11]||(o[11]=G((...n)=>t.closeNotificationModal&&t.closeNotificationModal(...n),["self"]))},[e("div",St,[e("div",Mt,[e("div",null,[e("h2",Bt,l(t.selectedNotification.title),1),e("div",zt,[e("span",{class:k(["px-2 py-1 text-xs rounded",t.getTypeClass(t.selectedNotification.type)])},l(t.getTypeLabel(t.selectedNotification.type)),3),e("span",At,l(t.formatDate(t.selectedNotification.created_at)),1)])]),e("button",{onClick:o[8]||(o[8]=(...n)=>t.closeNotificationModal&&t.closeNotificationModal(...n)),class:"p-2 hover:bg-muted/10 rounded-lg transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å"},[...o[18]||(o[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Et,[e("div",Dt,[e("div",null,[o[19]||(o[19]=e("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ",-1)),e("p",Vt,l(t.selectedNotification.message),1)]),t.selectedNotification.data?(a(),i("div",Ft,[t.selectedNotification.data.quiz_id?(a(),i("div",Lt,[o[27]||(o[27]=e("h3",{class:"text-sm font-medium text-muted-foreground mb-4"},"–î–µ—Ç–∞–ª–∏ –∫–≤–∏–∑–∞",-1)),e("div",qt,[e("div",null,[o[20]||(o[20]=e("span",{class:"text-sm font-medium text-muted-foreground"},"–ö–≤–∏–∑:",-1)),e("span",Rt,l(t.selectedNotification.data.quiz_title),1)]),t.selectedNotification.data.contact?(a(),i("div",It,[o[24]||(o[24]=e("h4",{class:"text-sm font-semibold text-foreground mb-2"},"–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e("div",Ot,[e("div",null,[o[21]||(o[21]=e("span",{class:"text-sm text-muted-foreground"},"–ò–º—è:",-1)),e("span",Ut,l(t.selectedNotification.data.contact.name),1)]),e("div",null,[o[22]||(o[22]=e("span",{class:"text-sm text-muted-foreground"},"Email:",-1)),e("span",Jt,l(t.selectedNotification.data.contact.email),1)]),e("div",null,[o[23]||(o[23]=e("span",{class:"text-sm text-muted-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω:",-1)),e("span",Pt,l(t.selectedNotification.data.contact.phone),1)])])])):f("",!0),t.selectedNotification.data.completed_at?(a(),i("div",Gt,[o[25]||(o[25]=e("span",{class:"text-sm text-muted-foreground"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",Ht,l(t.formatDate(t.selectedNotification.data.completed_at)),1)])):f("",!0),t.selectedNotification.data.answers&&t.selectedNotification.data.answers.length>0?(a(),i("div",Kt,[e("p",Qt," –û—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã: "+l(t.selectedNotification.data.answers.length),1)])):f("",!0),e("div",Wt,[H(b,{to:`/admin/notifications/quiz/${t.selectedNotification.data.quiz_id}?notification_id=${t.selectedNotification.id}`,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"},{default:K(()=>[...o[26]||(o[26]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),Y(" –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–≤–∏–∑–∞ ",-1)])]),_:1},8,["to"])])])])):(a(),i("div",Xt,[o[28]||(o[28]=e("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",-1)),e("pre",Yt,l(JSON.stringify(t.selectedNotification.data,null,2)),1)]))])):f("",!0)])]),e("div",Zt,[e("div",$t,[t.selectedNotification.read_at?(a(),i("span",te," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(t.formatDate(t.selectedNotification.read_at)),1)):(a(),i("span",ee," –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ "))]),e("div",oe,[t.selectedNotification.read?f("",!0):(a(),i("button",{key:0,onClick:o[9]||(o[9]=n=>t.markAsReadFromModal(t.selectedNotification.id)),class:"px-4 py-2 text-sm bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors"}," –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ ")),e("button",{onClick:o[10]||(o[10]=(...n)=>t.closeNotificationModal&&t.closeNotificationModal(...n)),class:"px-4 py-2 text-sm border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," –ó–∞–∫—Ä—ã—Ç—å ")])])])])):f("",!0)],64)}const ie=U(Z,[["render",ne]]);export{ie as default};
