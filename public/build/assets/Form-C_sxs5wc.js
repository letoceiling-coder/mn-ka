import{_ as x,h as u,z as w,c as m,b as r,d as v,l as p,v as h,q as F,t as f,p as S,o as b,a as B,i as E,j,r as D,C as V,E as M}from"./app-CH9Dcd89.js";import{a as N,b as P,c as U}from"./api-V9GPpd21.js";import{S as q}from"./sweetalert2.esm.all-C0u8rGqG.js";const R={name:"ChapterForm",props:{initialData:{type:Object,default:()=>({name:"",order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const o=u({name:n.initialData.name||"",order:n.initialData.order??0,is_active:n.initialData.is_active!==!1});return w(()=>n.initialData,s=>{o.value={name:s.name||"",order:s.order??0,is_active:s.is_active!==!1}},{deep:!0}),{localForm:o,handleSubmit:()=>{e("submit",{name:o.value.name,order:o.value.order,is_active:o.value.is_active})},handleCancel:()=>{e("cancel")}}}},z={class:"flex items-center gap-2"},G={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},O={class:"flex gap-2 pt-4"},T=["disabled"];function A(n,e,o,t,c,s){return b(),m("form",{onSubmit:e[4]||(e[4]=S((...a)=>t.handleSubmit&&t.handleSubmit(...a),["prevent"])),class:"space-y-4"},[r("div",null,[e[5]||(e[5]=r("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),p(r("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.localForm.name=a),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название раздела"},null,512),[[h,t.localForm.name]])]),r("div",null,[e[6]||(e[6]=r("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),p(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.localForm.order=a),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[h,t.localForm.order,void 0,{number:!0}]])]),r("div",z,[p(r("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.localForm.is_active=a),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[F,t.localForm.is_active]]),e[7]||(e[7]=r("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),o.error?(b(),m("div",G,f(o.error),1)):v("",!0),r("div",O,[r("button",{type:"button",onClick:e[3]||(e[3]=(...a)=>t.handleCancel&&t.handleCancel(...a)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),r("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},f(o.saving?"Сохранение...":"Сохранить"),9,T)])],32)}const H=x(R,[["render",A]]),I={name:"ChapterFormPage",components:{ChapterForm:H},setup(){const n=V(),e=M(),o=u(!1),t=u(!1),c=u(null),s=u(null),a=u({id:null,name:"",order:0,is_active:!0}),l=E(()=>!!n.params.id),_=async()=>{if(!l.value){o.value=!1;return}o.value=!0,c.value=null;try{const d=await N(`/chapters/${n.params.id}`);if(!d.ok)throw new Error("Ошибка загрузки раздела");const i=await d.json();i.data&&(a.value={id:i.data.id,name:i.data.name||"",order:i.data.order??0,is_active:i.data.is_active!==!1})}catch(d){c.value=d.message||"Ошибка загрузки раздела",console.error("Error fetching chapter:",d)}finally{o.value=!1}},y=async d=>{t.value=!0,s.value=null;try{const i=l.value?`/chapters/${n.params.id}`:"/chapters",g=await(l.value?P:U)(i,d);if(!g.ok){const C=await g.json().catch(()=>({}));throw new Error(C.message||`Ошибка ${l.value?"обновления":"создания"} раздела`)}await q.fire({title:l.value?"Раздел обновлен":"Раздел создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.chapters"})}catch(i){s.value=i.message||"Ошибка сохранения раздела"}finally{t.value=!1}},k=()=>{e.push({name:"admin.decisions.chapters"})};return j(()=>{_()}),{loading:o,saving:t,error:c,formError:s,form:a,isEdit:l,saveChapter:y,goBack:k}}},J={class:"chapter-form-page space-y-6"},K={class:"flex items-center justify-between"},L={class:"text-3xl font-semibold text-foreground"},Q={key:0,class:"flex items-center justify-center py-12"},W={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},X={class:"text-destructive"},Y={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Z(n,e,o,t,c,s){const a=D("ChapterForm");return b(),m("div",J,[r("div",K,[r("div",null,[r("h1",L,f(t.isEdit?"Редактировать раздел":"Создать раздел"),1),e[1]||(e[1]=r("p",{class:"text-muted-foreground mt-1"},"Управление разделом для блока решений",-1))]),r("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),t.loading?(b(),m("div",Q,[...e[2]||(e[2]=[r("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):v("",!0),t.error?(b(),m("div",W,[r("p",X,f(t.error),1)])):v("",!0),t.loading?v("",!0):(b(),m("div",Y,[B(a,{"initial-data":t.form,saving:t.saving,error:t.formError,onSubmit:t.saveChapter,onCancel:t.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const oe=x(I,[["render",Z]]);export{oe as default};
