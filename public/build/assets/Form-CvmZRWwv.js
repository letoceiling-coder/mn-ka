import{_ as g,c as w,b as t,t as x,p as y,l as m,v as c,q as h,a as k,w as _,h as u,C as S,j as V,r as B,E,o as T,f as C}from"./app-h0xKJ2BV.js";import{a as j,b as D,c as M}from"./api-V9GPpd21.js";import{S as b}from"./sweetalert2.esm.all-C0u8rGqG.js";const U={name:"OptionTreeForm",setup(){const i=S(),e=E(),n=u(!!i.params.id),o=u(!1),d=u(!1),l=u({name:"",parent:0,sort:0,is_active:!0}),p=async()=>{if(n.value){d.value=!0;try{const s=await j(`/option-trees/${i.params.id}`);if(!s.ok)throw new Error("Ошибка загрузки дерева опций");const a=await s.json();l.value={name:a.data.name||"",parent:a.data.parent||0,sort:a.data.sort||0,is_active:a.data.is_active??!0}}catch(s){await b.fire({title:"Ошибка",text:s.message||"Ошибка загрузки дерева опций",icon:"error",confirmButtonText:"ОК"}),e.push({name:"admin.decisions.option-trees"})}finally{d.value=!1}}},r=async()=>{o.value=!0;try{const s=n.value?`/option-trees/${i.params.id}`:"/option-trees",f=await(n.value?D:M)(s,l.value);if(!f.ok){const v=await f.json();throw new Error(v.message||"Ошибка сохранения дерева опций")}await b.fire({title:"Успешно!",text:n.value?"Дерево опций обновлено":"Дерево опций создано",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.option-trees"})}catch(s){await b.fire({title:"Ошибка",text:s.message||"Ошибка сохранения дерева опций",icon:"error",confirmButtonText:"ОК"})}finally{o.value=!1}};return V(()=>{p()}),{isEdit:n,saving:o,loading:d,form:l,handleSubmit:r}}},N={class:"option-tree-form-page space-y-6"},q={class:"text-3xl font-semibold text-foreground"},F={class:"bg-card rounded-lg border border-border p-6"},O={class:"flex items-center gap-3 cursor-pointer"},P={class:"flex items-center justify-end gap-4 pt-4 border-t border-border"},R=["disabled"];function G(i,e,n,o,d,l){const p=B("router-link");return T(),w("div",N,[t("div",null,[t("h1",q,x(o.isEdit?"Редактировать дерево опций":"Создать дерево опций"),1),e[5]||(e[5]=t("p",{class:"text-muted-foreground mt-1"},"Управление древовидной опцией",-1))]),t("div",F,[t("form",{onSubmit:e[4]||(e[4]=y((...r)=>o.handleSubmit&&o.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Название * ",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.name=r),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background text-sm",placeholder:"Введите название дерева опций"},null,512),[[c,o.form.name]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Родитель (ID, 0 для корневого) ",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.parent=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background text-sm",placeholder:"0"},null,512),[[c,o.form.parent,void 0,{number:!0}]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Сортировка ",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.sort=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background text-sm",placeholder:"0"},null,512),[[c,o.form.sort,void 0,{number:!0}]])]),t("div",null,[t("label",O,[m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.is_active=r),type:"checkbox",class:"w-4 h-4 rounded border-border"},null,512),[[h,o.form.is_active]]),e[9]||(e[9]=t("span",{class:"text-sm font-medium text-foreground"},"Активно",-1))])]),t("div",P,[k(p,{to:{name:"admin.decisions.option-trees"},class:"px-4 py-2 border border-border rounded hover:bg-muted/10 transition-colors"},{default:_(()=>[...e[10]||(e[10]=[C(" Отмена ",-1)])]),_:1}),t("button",{type:"submit",disabled:o.saving,class:"px-6 py-2 bg-accent text-accent-foreground rounded hover:bg-accent/90 disabled:opacity-50 disabled:cursor-not-allowed"},x(o.saving?"Сохранение...":"Сохранить"),9,R)])],32)])])}const H=g(U,[["render",G]]);export{H as default};
