import{_ as F,h as k,i as p,c as o,d as u,a as b,b as s,x as S,p as A,F as N,k as T,r as _,o as r,j as H,e as z,s as D,t as C,w as j,z as Z,C as K,f as M}from"./app-BbVWLAW1.js";import{S as G}from"./SEOHead-D2sdL_Wb.js";import{L as B}from"./LazyImage-sgqxLA0_.js";import{F as J}from"./index-D7BMszVs.js";import{C as q}from"./CaseCard-DuTnNhPb.js";import{F as Q}from"./FeedbackForm-BTnFkqLM.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const W={name:"CaseImageCarousel",components:{FsLightbox:J,LazyImage:B},props:{images:{type:Array,default:()=>[]},caseName:{type:String,default:"Кейс"}},setup(i){const t=k(!1),l=k(1),e=k(0),c=p(()=>i.images.map(v=>v.webp||v.url||"")),h=p(()=>i.images[e.value]||i.images[0]||{});return{lightboxToggler:t,currentSlide:l,currentIndex:e,lightboxSources:c,currentImage:h,openLightbox:v=>{c.value.length>0&&(l.value=v+1,t.value=!t.value)},nextSlide:()=>{e.value<i.images.length-1&&e.value++},previousSlide:()=>{e.value>0&&e.value--},goToSlide:v=>{e.value=v}}}},X={key:0,class:"relative w-full"},Y={class:"relative w-full case-carousel"},$=["disabled"],ee=["disabled"],te={key:0,class:"flex justify-center gap-2 mt-4"},ae=["onClick"];function se(i,t,l,e,c,h){const x=_("FsLightbox"),m=_("LazyImage");return l.images.length>0?(r(),o("div",X,[b(x,{toggler:e.lightboxToggler,sources:e.lightboxSources,slide:e.currentSlide,type:"image"},null,8,["toggler","sources","slide"]),s("div",Y,[s("div",{class:"relative w-full aspect-[100/51] bg-gray-100 rounded-xl overflow-hidden cursor-pointer group",onClick:t[2]||(t[2]=g=>e.openLightbox(e.currentIndex))},[b(m,{src:e.currentImage.webp||e.currentImage.url,alt:`${l.caseName} - изображение ${e.currentIndex+1}`,"image-class":"w-full h-full object-cover","container-class":"relative w-full h-full",eager:!0},null,8,["src","alt"]),l.images.length>1?(r(),o("button",{key:0,onClick:t[0]||(t[0]=A((...g)=>e.previousSlide&&e.previousSlide(...g),["stop"])),class:S(["absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===0}]),disabled:e.currentIndex===0},[...t[3]||(t[3]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M10 12L6 8L10 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,$)):u("",!0),l.images.length>1?(r(),o("button",{key:1,onClick:t[1]||(t[1]=A((...g)=>e.nextSlide&&e.nextSlide(...g),["stop"])),class:S(["absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===l.images.length-1}]),disabled:e.currentIndex===l.images.length-1},[...t[4]||(t[4]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M6 4L10 8L6 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,ee)):u("",!0)]),l.images.length>1?(r(),o("div",te,[(r(!0),o(N,null,T(l.images,(g,y)=>(r(),o("button",{key:y,onClick:v=>e.goToSlide(y),class:S(["w-2 h-2 rounded-full transition-all",y===e.currentIndex?"bg-[#688E67] w-8":"bg-gray-300 hover:bg-gray-400"])},null,10,ae))),128))])):u("",!0)])])):u("",!0)}const re=F(W,[["render",se],["__scopeId","data-v-68d43b13"]]),oe={name:"SimilarCases",components:{CaseCard:q},props:{chapterId:{type:Number,default:null},excludeCaseId:{type:Number,default:null},limit:{type:Number,default:2}},setup(i){const t=k([]),l=k(!1),e=async()=>{l.value=!0;try{const c=new URLSearchParams;i.chapterId&&c.append("chapter_id",i.chapterId),i.excludeCaseId&&c.append("offerNot",i.excludeCaseId);const h=await fetch(`/api/public/cases?${c.toString()}`);if(h.ok){const m=(await h.json()).data||[];t.value=m.filter(g=>g.id!==i.excludeCaseId).slice(0,i.limit)}}catch(c){console.error("Error fetching similar cases:",c)}finally{l.value=!1}};return H(()=>{e()}),{similarCases:t,loading:l}}},le={key:0,class:"w-full px-3 sm:px-4 md:px-5"},ne={class:"w-full max-w-[1200px] mx-auto mt-6 md:mt-8"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8"};function ce(i,t,l,e,c,h){const x=_("CaseCard");return e.similarCases.length>0?(r(),o("div",le,[s("div",ne,[t[0]||(t[0]=s("h2",{class:"text-2xl md:text-3xl font-bold text-black mb-6 md:mb-8"}," Похожие кейсы ",-1)),s("div",ie,[(r(!0),o(N,null,T(e.similarCases,m=>(r(),z(x,{key:m.id,"case-item":m},null,8,["case-item"]))),128))])])])):u("",!0)}const de=F(oe,[["render",ce]]),ue={name:"CasePage",components:{SEOHead:G,LazyImage:B,CaseImageCarousel:re,SimilarCases:de,FeedbackForm:Q},setup(){const i=K(),t=k(!1),l=k(null),e=k(null),c=p(()=>{if(!e.value||!e.value.images)return console.log("No images in caseItem:",e.value),[];const a=e.value.images.slice(0,2).filter(n=>{const d=n&&(n.url||n.webp);return d||console.warn("Image without URL:",n),d});return console.log("Hero images computed:",{total:e.value.images.length,valid:a.length,images:a}),a}),h=p(()=>{if(!e.value)return null;if(e.value.description){if(typeof e.value.description=="string")return e.value.description;if(typeof e.value.description=="object"){if(e.value.description.full)return e.value.description.full;if(e.value.description.short)return e.value.description.short;if(e.value.description.ru)return e.value.description.ru;if(Array.isArray(e.value.description)&&e.value.description.length>0)return e.value.description[0];const a=JSON.stringify(e.value.description);if(a&&a!=="{}")return a.replace(/[{}"]/g,"")}}return null}),x=p(()=>{if(!e.value||!e.value.html)return null;if(typeof e.value.html=="string")return e.value.html;if(typeof e.value.html=="object"){if(e.value.html.content)return e.value.html.content;if(e.value.html.lead)return e.value.html.lead;if(e.value.html.ru)return e.value.html.ru;if(Array.isArray(e.value.html)&&e.value.html.length>0)return e.value.html[0]}return null}),m=a=>{if(!a)return"";try{const n=new Date(a),d=n.getDate(),V=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][n.getMonth()],P=String(n.getHours()).padStart(2,"0"),R=String(n.getMinutes()).padStart(2,"0");return`${d} ${V} ${P}:${R}`}catch{return a}},g=a=>{console.error("Error loading image:",a.target.src),a.target.style.display="none"},y=async()=>{const a=window.location.href,n=e.value?.name||"Кейс";if(navigator.share)try{await navigator.share({title:n,text:h.value||"",url:a})}catch(d){d.name!=="AbortError"&&console.error("Error sharing:",d)}else try{await navigator.clipboard.writeText(a),alert("Ссылка скопирована в буфер обмена")}catch(d){console.error("Failed to copy:",d)}},v=async()=>{t.value=!0,l.value=null;try{const n=`/api/public/cases/${i.params.slug}`,d=await fetch(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!d.ok)throw d.status===404?new Error("Кейс не найден"):new Error("Ошибка загрузки кейса");const f=await d.json();if(f.data)e.value=Array.isArray(f.data)?f.data[0]:f.data,console.log("Case loaded:",{name:e.value.name,description:e.value.description,html:e.value.html,hasImages:!!e.value.images,imagesCount:e.value.images?.length,images:e.value.images,hasImage:!!e.value.image,image:e.value.image,chapter:e.value.chapter});else throw new Error("Кейс не найден")}catch(a){console.error("Error fetching case:",a),l.value=a.message||"Ошибка загрузки кейса"}finally{t.value=!1}};Z(()=>i.params.slug,(a,n)=>{a!==n&&(e.value=null,v())}),H(()=>{v()});const w=p(()=>e.value?e.value.seo_title?e.value.seo_title:`${e.value.name} - Lagom | Пример реализованного проекта`:"Кейс - Lagom"),I=p(()=>{if(!e.value)return"Пример успешно реализованного проекта по подбору и оформлению земельного участка.";if(e.value.seo_description)return e.value.seo_description;const a=h.value;return a&&a.length>50?a:`Кейс: ${e.value.name} - успешно реализованный проект по подбору и оформлению земельного участка. Подробная информация о проекте, результатах и особенностях реализации.`}),L=p(()=>e.value?e.value.seo_keywords?e.value.seo_keywords:`${e.value.name}, кейс, проект, пример работ, земельные участки, объект, Lagom`:"кейс, проект, земельные участки"),U=p(()=>{if(!e.value)return"";if(c.value&&c.value.length>0){const a=c.value[0];return a.url||a.webp||""}return e.value.image?.url?e.value.image.url:""}),E=p(()=>e.value?window.location.origin+"/cases/"+(e.value.slug||""):""),O=p(()=>{if(!e.value)return null;const a={"@context":"https://schema.org","@type":"Article",headline:e.value.name,description:I.value,url:E.value,author:{"@type":"Organization",name:"Lagom"}};if((e.value.published||e.value.created_at)&&(a.datePublished=e.value.created_at,a.dateModified=e.value.updated_at||e.value.created_at),e.value.images&&e.value.images.length>0){const d=e.value.images.filter(f=>f.url||f.webp).map(f=>window.location.origin+(f.url||f.webp));d.length>0&&(a.image=d)}else e.value.image?.url&&(a.image=window.location.origin+e.value.image.url);const n={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Главная",item:window.location.origin},{"@type":"ListItem",position:2,name:"Кейсы и объекты",item:window.location.origin+"/cases"},{"@type":"ListItem",position:3,name:e.value.name,item:E.value}]};return[a,n]});return{loading:t,error:l,caseItem:e,heroImages:c,caseDescription:h,caseHtml:x,formatDate:m,handleImageError:g,handleShare:y,caseTitle:w,caseMetaDescription:I,caseKeywords:L,caseImage:U,canonicalUrl:E,caseSchema:O}}},me={class:"case-page min-h-screen bg-white"},ge={class:"w-full px-3 sm:px-4 md:px-5"},ve={class:"w-full max-w-[1200px] mx-auto"},he={key:0,class:"py-12 space-y-8"},fe={key:1,class:"py-12"},pe={class:"p-4 bg-red-50 border border-red-200 rounded-lg"},xe={class:"text-red-600"},we={key:2},ye={class:"hidden md:flex items-center gap-2 text-sm text-gray-600 mt-4"},be={class:"text-black"},_e={class:"mt-6 md:mt-8"},ke={class:"text-2xl md:text-3xl lg:text-4xl font-bold text-black mb-3 md:mb-4"},Ie={key:0,class:"mt-3 text-base md:text-lg text-gray-600"},Ce=["src","alt"],Se={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},Le=["innerHTML"],Ee={key:3,class:"mt-6 md:mt-8 relative"},je={class:"mt-6 md:mt-8 pt-6 border-t border-gray-200"},Me={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Fe={key:0,class:"flex flex-col gap-1"},Ne={class:"text-base text-black font-medium"},Te={key:1,class:"mt-12"},Ae={key:2,class:"w-full px-3 sm:px-4 md:px-5 mt-12 pb-12"},De={class:"w-full max-w-[1200px] mx-auto"};function He(i,t,l,e,c,h){const x=_("SEOHead"),m=_("router-link"),g=_("CaseImageCarousel"),y=_("SimilarCases"),v=_("FeedbackForm");return r(),o("div",me,[e.caseItem?(r(),z(x,{key:0,title:e.caseTitle,description:e.caseMetaDescription,keywords:e.caseKeywords,"og-image":e.caseImage,canonical:e.canonicalUrl,schema:e.caseSchema},null,8,["title","description","keywords","og-image","canonical","schema"])):u("",!0),s("div",ge,[s("div",ve,[e.loading&&!e.caseItem?(r(),o("div",he,[...t[2]||(t[2]=[D('<div class="h-8 bg-gray-200 rounded w-1/3 animate-pulse" data-v-8305da10></div><div class="h-64 bg-gray-200 rounded animate-pulse" data-v-8305da10></div><div class="space-y-4" data-v-8305da10><div class="h-4 bg-gray-200 rounded animate-pulse" data-v-8305da10></div><div class="h-4 bg-gray-200 rounded w-5/6 animate-pulse" data-v-8305da10></div></div>',3)])])):u("",!0),e.error&&!e.loading?(r(),o("div",fe,[s("div",pe,[s("p",xe,C(e.error),1),b(m,{to:"/cases",class:"mt-4 inline-block text-sm text-[#688E67] hover:underline"},{default:j(()=>[...t[3]||(t[3]=[M(" Вернуться к списку кейсов ",-1)])]),_:1})])])):u("",!0),e.caseItem&&!e.loading?(r(),o("div",we,[s("nav",ye,[b(m,{to:"/",class:"hover:text-black transition-colors"},{default:j(()=>[...t[4]||(t[4]=[M(" Главная ",-1)])]),_:1}),t[6]||(t[6]=s("span",null,"/",-1)),b(m,{to:"/cases",class:"hover:text-black transition-colors"},{default:j(()=>[...t[5]||(t[5]=[M(" Кейсы и объекты ",-1)])]),_:1}),t[7]||(t[7]=s("span",null,"/",-1)),s("span",be,C(e.caseItem.name),1)]),s("div",_e,[s("h1",ke,C(e.caseItem.name),1)]),e.caseDescription?(r(),o("div",Ie,C(e.caseDescription),1)):u("",!0),e.heroImages&&e.heroImages.length>0?(r(),o("div",{key:1,class:S(["grid gap-4 md:gap-6 mt-6 md:mt-8",e.heroImages.length>=2?"grid-cols-1 md:grid-cols-2":"grid-cols-1"])},[(r(!0),o(N,null,T(e.heroImages,(w,I)=>(r(),o("div",{key:w.id||I,class:S(["relative w-full bg-gray-100 rounded-lg overflow-hidden",e.heroImages.length>=2?"aspect-[50/33]":"aspect-[100/51]"])},[w.url||w.webp?(r(),o("img",{key:0,src:w.webp||w.url,alt:`${e.caseItem.name} - изображение ${I+1}`,class:"w-full h-full object-cover",loading:"lazy",decoding:"async",onError:t[0]||(t[0]=(...L)=>e.handleImageError&&e.handleImageError(...L))},null,40,Ce)):(r(),o("div",Se,[...t[8]||(t[8]=[s("span",{class:"text-gray-400 text-sm"},"Изображение не загружено",-1)])]))],2))),128))],2)):u("",!0),e.caseHtml?(r(),o("div",{key:2,class:"mt-6 md:mt-8 prose prose-sm md:prose-base max-w-none prose-headings:text-black prose-p:text-gray-700 prose-a:text-[#688E67]",innerHTML:e.caseHtml},null,8,Le)):u("",!0),e.caseItem.images&&e.caseItem.images.length>0?(r(),o("div",Ee,[b(g,{images:e.caseItem.images,"case-name":e.caseItem.name},null,8,["images","case-name"])])):u("",!0),s("div",je,[s("div",Me,[e.caseItem.published||e.caseItem.created_at?(r(),o("div",Fe,[t[9]||(t[9]=s("span",{class:"text-sm text-gray-600"},"Опубликован",-1)),s("span",Ne,C(e.caseItem.published||e.formatDate(e.caseItem.created_at)),1)])):u("",!0),s("button",{onClick:t[1]||(t[1]=(...w)=>e.handleShare&&e.handleShare(...w)),class:"inline-flex items-center gap-2 px-4 py-2 text-[#688E67] hover:bg-[#688E67]/10 rounded-lg transition-colors font-medium self-start md:self-auto cursor-pointer"},[...t[10]||(t[10]=[D('<span data-v-8305da10>Поделиться</span><svg width="29" height="32" viewBox="0 0 29 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-6" data-v-8305da10><path d="M23.498 10C25.9833 10 27.998 7.98528 27.998 5.5C27.998 3.01472 25.9833 1 23.498 1C21.0128 1 18.998 3.01472 18.998 5.5C18.998 7.98528 21.0128 10 23.498 10Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-8305da10></path><path d="M5.5 20.5001C7.98528 20.5001 10 18.4854 10 16.0001C10 13.5148 7.98528 11.5001 5.5 11.5001C3.01472 11.5001 1 13.5148 1 16.0001C1 18.4854 3.01472 20.5001 5.5 20.5001Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-8305da10></path><path d="M23.498 31C25.9833 31 27.998 28.9853 27.998 26.5C27.998 24.0147 25.9833 22 23.498 22C21.0128 22 18.998 24.0147 18.998 26.5C18.998 28.9853 21.0128 31 23.498 31Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-8305da10></path><path d="M9.24805 18.25L19.748 24.25M19.748 7.75L9.24805 13.75" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-8305da10></path></svg>',2)])])])])])):u("",!0)])]),e.caseItem&&!e.loading?(r(),o("div",Te,[b(y,{"chapter-id":e.caseItem.chapter_id,"exclude-case-id":e.caseItem.id,limit:2},null,8,["chapter-id","exclude-case-id"])])):u("",!0),e.caseItem&&!e.loading?(r(),o("div",Ae,[s("div",De,[b(v,{title:"Оставьте заявку",description:"Мы бесплатно подберём участок и покажем, как его оформить под ваш проект"})])])):u("",!0)])}const Ze=F(ue,[["render",He],["__scopeId","data-v-8305da10"]]);export{Ze as default};
