import{_ as E,d as x,e as k,c as o,g as c,a as b,b as s,m as I,s as F,F as L,l as j,r as y,o as r,f as N,h as z,x as M,t as _,w as C,y as H,B as V,j as S}from"./app-BTbmnJkn.js";import{L as T}from"./LazyImage-DNBwF-Je.js";import{F as P}from"./index-Bewf5V4K.js";import{C as R}from"./CaseCard-cUkkGjsx.js";import{F as U}from"./FeedbackForm-DtV-c4Fb.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const Z={name:"CaseImageCarousel",components:{FsLightbox:P,LazyImage:T},props:{images:{type:Array,default:()=>[]},caseName:{type:String,default:"Кейс"}},setup(d){const t=x(!1),l=x(1),e=x(0),m=k(()=>d.images.map(n=>n.webp||n.url||"")),f=k(()=>d.images[e.value]||d.images[0]||{});return{lightboxToggler:t,currentSlide:l,currentIndex:e,lightboxSources:m,currentImage:f,openLightbox:n=>{m.value.length>0&&(l.value=n+1,t.value=!t.value)},nextSlide:()=>{e.value<d.images.length-1&&e.value++},previousSlide:()=>{e.value>0&&e.value--},goToSlide:n=>{e.value=n}}}},G={key:0,class:"relative w-full"},J={class:"relative w-full case-carousel"},O=["disabled"],q=["disabled"],K={key:0,class:"flex justify-center gap-2 mt-4"},Q=["onClick"];function W(d,t,l,e,m,f){const h=y("FsLightbox"),v=y("LazyImage");return l.images.length>0?(r(),o("div",G,[b(h,{toggler:e.lightboxToggler,sources:e.lightboxSources,slide:e.currentSlide,type:"image"},null,8,["toggler","sources","slide"]),s("div",J,[s("div",{class:"relative w-full aspect-[100/51] bg-gray-100 rounded-xl overflow-hidden cursor-pointer group",onClick:t[2]||(t[2]=g=>e.openLightbox(e.currentIndex))},[b(v,{src:e.currentImage.webp||e.currentImage.url,alt:`${l.caseName} - изображение ${e.currentIndex+1}`,"image-class":"w-full h-full object-cover","container-class":"relative w-full h-full",eager:!0},null,8,["src","alt"]),l.images.length>1?(r(),o("button",{key:0,onClick:t[0]||(t[0]=F((...g)=>e.previousSlide&&e.previousSlide(...g),["stop"])),class:I(["absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===0}]),disabled:e.currentIndex===0},[...t[3]||(t[3]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M10 12L6 8L10 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,O)):c("",!0),l.images.length>1?(r(),o("button",{key:1,onClick:t[1]||(t[1]=F((...g)=>e.nextSlide&&e.nextSlide(...g),["stop"])),class:I(["absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===l.images.length-1}]),disabled:e.currentIndex===l.images.length-1},[...t[4]||(t[4]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M6 4L10 8L6 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,q)):c("",!0)]),l.images.length>1?(r(),o("div",K,[(r(!0),o(L,null,j(l.images,(g,p)=>(r(),o("button",{key:p,onClick:n=>e.goToSlide(p),class:I(["w-2 h-2 rounded-full transition-all",p===e.currentIndex?"bg-[#688E67] w-8":"bg-gray-300 hover:bg-gray-400"])},null,10,Q))),128))])):c("",!0)])])):c("",!0)}const X=E(Z,[["render",W],["__scopeId","data-v-68d43b13"]]),Y={name:"SimilarCases",components:{CaseCard:R},props:{chapterId:{type:Number,default:null},excludeCaseId:{type:Number,default:null},limit:{type:Number,default:2}},setup(d){const t=x([]),l=x(!1),e=async()=>{l.value=!0;try{const m=new URLSearchParams;d.chapterId&&m.append("chapter_id",d.chapterId),d.excludeCaseId&&m.append("offerNot",d.excludeCaseId);const f=await fetch(`/api/public/cases?${m.toString()}`);if(f.ok){const v=(await f.json()).data||[];t.value=v.filter(g=>g.id!==d.excludeCaseId).slice(0,d.limit)}}catch(m){console.error("Error fetching similar cases:",m)}finally{l.value=!1}};return N(()=>{e()}),{similarCases:t,loading:l}}},$={key:0,class:"w-full px-3 sm:px-4 md:px-5"},ee={class:"w-full max-w-[1200px] mx-auto mt-6 md:mt-8"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8"};function ae(d,t,l,e,m,f){const h=y("CaseCard");return e.similarCases.length>0?(r(),o("div",$,[s("div",ee,[t[0]||(t[0]=s("h2",{class:"text-2xl md:text-3xl font-bold text-black mb-6 md:mb-8"}," Похожие кейсы ",-1)),s("div",te,[(r(!0),o(L,null,j(e.similarCases,v=>(r(),z(h,{key:v.id,"case-item":v},null,8,["case-item"]))),128))])])])):c("",!0)}const se=E(Y,[["render",ae]]),re={name:"CasePage",components:{LazyImage:T,CaseImageCarousel:X,SimilarCases:se,FeedbackForm:U},setup(){const d=V(),t=x(!1),l=x(null),e=x(null),m=k(()=>{if(!e.value||!e.value.images)return console.log("No images in caseItem:",e.value),[];const a=e.value.images.slice(0,2).filter(i=>{const u=i&&(i.url||i.webp);return u||console.warn("Image without URL:",i),u});return console.log("Hero images computed:",{total:e.value.images.length,valid:a.length,images:a}),a}),f=k(()=>{if(!e.value)return null;if(e.value.description){if(typeof e.value.description=="string")return e.value.description;if(typeof e.value.description=="object"){if(e.value.description.full)return e.value.description.full;if(e.value.description.short)return e.value.description.short;if(e.value.description.ru)return e.value.description.ru;if(Array.isArray(e.value.description)&&e.value.description.length>0)return e.value.description[0];const a=JSON.stringify(e.value.description);if(a&&a!=="{}")return a.replace(/[{}"]/g,"")}}return null}),h=k(()=>{if(!e.value||!e.value.html)return null;if(typeof e.value.html=="string")return e.value.html;if(typeof e.value.html=="object"){if(e.value.html.content)return e.value.html.content;if(e.value.html.lead)return e.value.html.lead;if(e.value.html.ru)return e.value.html.ru;if(Array.isArray(e.value.html)&&e.value.html.length>0)return e.value.html[0]}return null}),v=a=>{if(!a)return"";try{const i=new Date(a),u=i.getDate(),A=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][i.getMonth()],B=String(i.getHours()).padStart(2,"0"),D=String(i.getMinutes()).padStart(2,"0");return`${u} ${A} ${B}:${D}`}catch{return a}},g=a=>{console.error("Error loading image:",a.target.src),a.target.style.display="none"},p=async()=>{const a=window.location.href,i=e.value?.name||"Кейс";if(navigator.share)try{await navigator.share({title:i,text:f.value||"",url:a})}catch(u){u.name!=="AbortError"&&console.error("Error sharing:",u)}else try{await navigator.clipboard.writeText(a),alert("Ссылка скопирована в буфер обмена")}catch(u){console.error("Failed to copy:",u)}},n=async()=>{t.value=!0,l.value=null;try{const i=`/api/public/cases/${d.params.slug}`,u=await fetch(i,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!u.ok)throw u.status===404?new Error("Кейс не найден"):new Error("Ошибка загрузки кейса");const w=await u.json();if(w.data)e.value=Array.isArray(w.data)?w.data[0]:w.data,console.log("Case loaded:",{name:e.value.name,description:e.value.description,html:e.value.html,hasImages:!!e.value.images,imagesCount:e.value.images?.length,images:e.value.images,hasImage:!!e.value.image,image:e.value.image,chapter:e.value.chapter});else throw new Error("Кейс не найден")}catch(a){console.error("Error fetching case:",a),l.value=a.message||"Ошибка загрузки кейса"}finally{t.value=!1}};return H(()=>d.params.slug,(a,i)=>{a!==i&&(e.value=null,n())}),N(()=>{n()}),{loading:t,error:l,caseItem:e,heroImages:m,caseDescription:f,caseHtml:h,formatDate:v,handleImageError:g,handleShare:p}}},oe={class:"case-page min-h-screen bg-white"},le={class:"w-full px-3 sm:px-4 md:px-5"},ne={class:"w-full max-w-[1200px] mx-auto"},ie={key:0,class:"py-12 space-y-8"},de={key:1,class:"py-12"},ce={class:"p-4 bg-red-50 border border-red-200 rounded-lg"},me={class:"text-red-600"},ue={key:2},ge={class:"hidden md:flex items-center gap-2 text-sm text-gray-600 mt-4"},he={class:"text-black"},ve={class:"mt-6 md:mt-8"},fe={class:"text-2xl md:text-3xl lg:text-4xl font-bold text-black mb-3 md:mb-4"},pe={key:0,class:"mt-3 text-base md:text-lg text-gray-600"},be=["src","alt"],xe={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},ye=["innerHTML"],we={key:3,class:"mt-6 md:mt-8 relative"},_e={class:"mt-6 md:mt-8 pt-6 border-t border-gray-200"},ke={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Ie={key:0,class:"flex flex-col gap-1"},Ce={class:"text-base text-black font-medium"},Se={key:0,class:"mt-12"},Ee={key:1,class:"w-full px-3 sm:px-4 md:px-5 mt-12 pb-12"},Le={class:"w-full max-w-[1200px] mx-auto"};function je(d,t,l,e,m,f){const h=y("router-link"),v=y("CaseImageCarousel"),g=y("SimilarCases"),p=y("FeedbackForm");return r(),o("div",oe,[s("div",le,[s("div",ne,[e.loading&&!e.caseItem?(r(),o("div",ie,[...t[2]||(t[2]=[M('<div class="h-8 bg-gray-200 rounded w-1/3 animate-pulse" data-v-b486ba33></div><div class="h-64 bg-gray-200 rounded animate-pulse" data-v-b486ba33></div><div class="space-y-4" data-v-b486ba33><div class="h-4 bg-gray-200 rounded animate-pulse" data-v-b486ba33></div><div class="h-4 bg-gray-200 rounded w-5/6 animate-pulse" data-v-b486ba33></div></div>',3)])])):c("",!0),e.error&&!e.loading?(r(),o("div",de,[s("div",ce,[s("p",me,_(e.error),1),b(h,{to:"/cases",class:"mt-4 inline-block text-sm text-[#688E67] hover:underline"},{default:C(()=>[...t[3]||(t[3]=[S(" Вернуться к списку кейсов ",-1)])]),_:1})])])):c("",!0),e.caseItem&&!e.loading?(r(),o("div",ue,[s("nav",ge,[b(h,{to:"/",class:"hover:text-black transition-colors"},{default:C(()=>[...t[4]||(t[4]=[S(" Главная ",-1)])]),_:1}),t[6]||(t[6]=s("span",null,"/",-1)),b(h,{to:"/cases",class:"hover:text-black transition-colors"},{default:C(()=>[...t[5]||(t[5]=[S(" Кейсы и объекты ",-1)])]),_:1}),t[7]||(t[7]=s("span",null,"/",-1)),s("span",he,_(e.caseItem.name),1)]),s("div",ve,[s("h1",fe,_(e.caseItem.name),1)]),e.caseDescription?(r(),o("div",pe,_(e.caseDescription),1)):c("",!0),e.heroImages&&e.heroImages.length>0?(r(),o("div",{key:1,class:I(["grid gap-4 md:gap-6 mt-6 md:mt-8",e.heroImages.length>=2?"grid-cols-1 md:grid-cols-2":"grid-cols-1"])},[(r(!0),o(L,null,j(e.heroImages,(n,a)=>(r(),o("div",{key:n.id||a,class:I(["relative w-full bg-gray-100 rounded-lg overflow-hidden",e.heroImages.length>=2?"aspect-[50/33]":"aspect-[100/51]"])},[n.url||n.webp?(r(),o("img",{key:0,src:n.webp||n.url,alt:`${e.caseItem.name} - изображение ${a+1}`,class:"w-full h-full object-cover",loading:"lazy",decoding:"async",onError:t[0]||(t[0]=(...i)=>e.handleImageError&&e.handleImageError(...i))},null,40,be)):(r(),o("div",xe,[...t[8]||(t[8]=[s("span",{class:"text-gray-400 text-sm"},"Изображение не загружено",-1)])]))],2))),128))],2)):c("",!0),e.caseHtml?(r(),o("div",{key:2,class:"mt-6 md:mt-8 prose prose-sm md:prose-base max-w-none prose-headings:text-black prose-p:text-gray-700 prose-a:text-[#688E67]",innerHTML:e.caseHtml},null,8,ye)):c("",!0),e.caseItem.images&&e.caseItem.images.length>0?(r(),o("div",we,[b(v,{images:e.caseItem.images,"case-name":e.caseItem.name},null,8,["images","case-name"])])):c("",!0),s("div",_e,[s("div",ke,[e.caseItem.published||e.caseItem.created_at?(r(),o("div",Ie,[t[9]||(t[9]=s("span",{class:"text-sm text-gray-600"},"Опубликован",-1)),s("span",Ce,_(e.caseItem.published||e.formatDate(e.caseItem.created_at)),1)])):c("",!0),s("button",{onClick:t[1]||(t[1]=(...n)=>e.handleShare&&e.handleShare(...n)),class:"inline-flex items-center gap-2 px-4 py-2 text-[#688E67] hover:bg-[#688E67]/10 rounded-lg transition-colors font-medium self-start md:self-auto cursor-pointer"},[...t[10]||(t[10]=[M('<span data-v-b486ba33>Поделиться</span><svg width="29" height="32" viewBox="0 0 29 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-6" data-v-b486ba33><path d="M23.498 10C25.9833 10 27.998 7.98528 27.998 5.5C27.998 3.01472 25.9833 1 23.498 1C21.0128 1 18.998 3.01472 18.998 5.5C18.998 7.98528 21.0128 10 23.498 10Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b486ba33></path><path d="M5.5 20.5001C7.98528 20.5001 10 18.4854 10 16.0001C10 13.5148 7.98528 11.5001 5.5 11.5001C3.01472 11.5001 1 13.5148 1 16.0001C1 18.4854 3.01472 20.5001 5.5 20.5001Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b486ba33></path><path d="M23.498 31C25.9833 31 27.998 28.9853 27.998 26.5C27.998 24.0147 25.9833 22 23.498 22C21.0128 22 18.998 24.0147 18.998 26.5C18.998 28.9853 21.0128 31 23.498 31Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b486ba33></path><path d="M9.24805 18.25L19.748 24.25M19.748 7.75L9.24805 13.75" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b486ba33></path></svg>',2)])])])])])):c("",!0)])]),e.caseItem&&!e.loading?(r(),o("div",Se,[b(g,{"chapter-id":e.caseItem.chapter_id,"exclude-case-id":e.caseItem.id,limit:2},null,8,["chapter-id","exclude-case-id"])])):c("",!0),e.caseItem&&!e.loading?(r(),o("div",Ee,[s("div",Le,[b(p,{title:"Оставьте заявку",description:"Мы бесплатно подберём участок и покажем, как его оформить под ваш проект"})])])):c("",!0)])}const De=E(re,[["render",je],["__scopeId","data-v-b486ba33"]]);export{De as default};
