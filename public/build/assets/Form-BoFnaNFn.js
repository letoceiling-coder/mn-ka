import{_ as U,h as m,z as B,j as q,c as i,b as t,d as g,l as _,v as I,D as T,F as S,k as V,f as p,a as y,t as h,w as D,q as G,p as L,r as M,o as s,i as O,C as A,E as H}from"./app-Sq4bpJln.js";import{a as j,b as J,c as K}from"./api-V9GPpd21.js";import{S as Q}from"./sweetalert2.esm.all-C0u8rGqG.js";import W from"./Media-CZFad0RX.js";import"./index-BO61v5uL.js";/* empty css                        */const X={name:"ServiceForm",components:{Media:W},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(a,{emit:e}){const u=m([]),o=m([]),f=m(!1),x=m(!1),v=m(!1),d=m(null),r=m(null),n=m({name:a.initialData.name||"",slug:a.initialData.slug||"",chapter_id:a.initialData.chapter_id||null,image_id:a.initialData.image_id||null,icon_id:a.initialData.icon_id||null,order:a.initialData.order??0,is_active:a.initialData.is_active!==!1}),w=async()=>{try{const l=await j("/chapters");if(l.ok){const C=await l.json();u.value=C.data||[]}}catch(l){console.error("Error fetching chapters:",l)}},b=async()=>{if(!n.value.chapter_id){o.value=[];return}f.value=!0;try{const l=await j(`/cases?chapter_id=${n.value.chapter_id}`);if(l.ok){const C=await l.json();o.value=C.data||[]}}catch(l){console.error("Error fetching cases:",l),o.value=[]}finally{f.value=!1}},c=()=>{x.value=!0},E=()=>{v.value=!0},k=l=>{d.value=l,n.value.image_id=l.id,x.value=!1},F=l=>{r.value=l,n.value.icon_id=l.id,v.value=!1},N=()=>{d.value=null,n.value.image_id=null},z=()=>{r.value=null,n.value.icon_id=null};B(()=>a.initialData,l=>{n.value={name:l.name||"",slug:l.slug||"",chapter_id:l.chapter_id||null,image_id:l.image_id||null,icon_id:l.icon_id||null,order:l.order??0,is_active:l.is_active!==!1},l.image&&(d.value=l.image),l.icon&&(r.value=l.icon),l.chapter_id&&b()},{deep:!0}),B(()=>n.value.chapter_id,()=>{b()});const P=()=>{e("submit",{name:n.value.name,slug:n.value.slug||null,chapter_id:n.value.chapter_id||null,image_id:n.value.image_id||null,icon_id:n.value.icon_id||null,order:n.value.order,is_active:n.value.is_active})},R=()=>{e("cancel")};return q(()=>{w(),a.initialData.image&&(d.value=a.initialData.image),a.initialData.icon&&(r.value=a.initialData.icon),a.initialData.chapter_id&&b()}),{chapters:u,casesForChapter:o,loadingCases:f,localForm:n,showImageMediaModal:x,showIconMediaModal:v,selectedImage:d,selectedIcon:r,openImageModal:c,openIconModal:E,handleImageSelected:k,handleIconSelected:F,removeImage:N,removeIcon:z,fetchCasesForChapter:b,handleSubmit:P,handleCancel:R}}},Y=["value"],Z={key:0},$={class:"border border-border rounded-lg p-3 max-h-48 overflow-y-auto bg-muted/5"},ee={class:"space-y-1"},oe={class:"text-xs text-muted-foreground mt-1"},te={key:1,class:"text-sm text-muted-foreground"},re={class:"flex items-center gap-3"},le={key:0,class:"flex-1"},ae=["src","alt"],ne={class:"flex items-center gap-3"},ie={key:0,class:"flex-1"},se=["src","alt"],de={class:"flex items-center gap-2"},ce={key:2,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},ue={class:"flex gap-2 pt-4"},me=["disabled"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ve={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ge={class:"flex items-center justify-between p-4 border-b border-border"},fe={class:"flex-1 overflow-auto h-full"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},he={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},_e={class:"flex items-center justify-between p-4 border-b border-border"},pe={class:"flex-1 overflow-auto h-full"};function ye(a,e,u,o,f,x){const v=M("router-link"),d=M("Media");return s(),i(S,null,[t("form",{onSubmit:e[11]||(e[11]=L((...r)=>o.handleSubmit&&o.handleSubmit(...r),["prevent"])),class:"space-y-4"},[t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.localForm.name=r),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название услуги"},null,512),[[I,o.localForm.name]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.localForm.slug=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[I,o.localForm.slug]]),e[16]||(e[16]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.localForm.chapter_id=r),onChange:e[3]||(e[3]=(...r)=>o.fetchCasesForChapter&&o.fetchCasesForChapter(...r)),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[17]||(e[17]=t("option",{value:null},"Не выбран",-1)),(s(!0),i(S,null,V(o.chapters,r=>(s(),i("option",{key:r.id,value:r.id},h(r.name),9,Y))),128))],544),[[T,o.localForm.chapter_id]])]),o.localForm.chapter_id&&o.casesForChapter.length>0?(s(),i("div",Z,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Случаи в этом разделе",-1)),t("div",$,[t("div",ee,[(s(!0),i(S,null,V(o.casesForChapter,r=>(s(),i("div",{key:r.id,class:"text-sm text-muted-foreground flex items-center gap-2"},[e[19]||(e[19]=t("span",{class:"w-2 h-2 rounded-full bg-accent"},null,-1)),p(" "+h(r.name),1)]))),128))])]),t("p",oe,[p(" Всего случаев: "+h(o.casesForChapter.length)+". ",1),y(v,{to:{name:"admin.decisions.cases",query:{chapter_id:o.localForm.chapter_id}},class:"text-accent hover:underline"},{default:D(()=>[...e[20]||(e[20]=[p(" Управление случаями ",-1)])]),_:1},8,["to"])])])):o.localForm.chapter_id&&!o.loadingCases?(s(),i("div",te,[e[23]||(e[23]=p(" В этом разделе пока нет случаев. ",-1)),y(v,{to:{name:"admin.decisions.cases.create",query:{chapter_id:o.localForm.chapter_id}},class:"text-accent hover:underline"},{default:D(()=>[...e[22]||(e[22]=[p(" Создать случай ",-1)])]),_:1},8,["to"])])):g("",!0),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),t("div",re,[o.selectedImage?(s(),i("div",le,[t("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,ae)])):g("",!0),t("button",{type:"button",onClick:e[4]||(e[4]=(...r)=>o.openImageModal&&o.openImageModal(...r)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},h(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(s(),i("button",{key:1,type:"button",onClick:e[5]||(e[5]=(...r)=>o.removeImage&&o.removeImage(...r)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):g("",!0)])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",ne,[o.selectedIcon?(s(),i("div",ie,[t("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,se)])):g("",!0),t("button",{type:"button",onClick:e[6]||(e[6]=(...r)=>o.openIconModal&&o.openIconModal(...r)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},h(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(s(),i("button",{key:1,type:"button",onClick:e[7]||(e[7]=(...r)=>o.removeIcon&&o.removeIcon(...r)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):g("",!0)])]),t("div",null,[e[26]||(e[26]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),_(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.localForm.order=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[I,o.localForm.order,void 0,{number:!0}]])]),t("div",de,[_(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.localForm.is_active=r),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[G,o.localForm.is_active]]),e[27]||(e[27]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активна ",-1))]),u.error?(s(),i("div",ce,h(u.error),1)):g("",!0),t("div",ue,[t("button",{type:"button",onClick:e[10]||(e[10]=(...r)=>o.handleCancel&&o.handleCancel(...r)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:u.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},h(u.saving?"Сохранение...":"Сохранить"),9,me)])],32),o.showImageMediaModal?(s(),i("div",be,[t("div",ve,[t("div",ge,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[12]||(e[12]=r=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",fe,[y(d,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):g("",!0),o.showIconMediaModal?(s(),i("div",xe,[t("div",he,[t("div",_e,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:e[13]||(e[13]=r=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",pe,[y(d,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):g("",!0)],64)}const ke=U(X,[["render",ye]]),we={name:"ServiceFormPage",components:{ServiceForm:ke},setup(){const a=A(),e=H(),u=m(!1),o=m(!1),f=m(null),x=m(null),v=m({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,image:null,icon:null,order:0,is_active:!0}),d=O(()=>!!a.params.id),r=async()=>{if(!d.value){u.value=!1;return}u.value=!0,f.value=null;try{const b=await j(`/services/${a.params.id}`);if(!b.ok)throw new Error("Ошибка загрузки услуги");const c=await b.json();c.data&&(v.value={id:c.data.id,name:c.data.name||"",slug:c.data.slug||"",chapter_id:c.data.chapter_id||null,image_id:c.data.image_id||null,icon_id:c.data.icon_id||null,image:c.data.image||null,icon:c.data.icon||null,order:c.data.order??0,is_active:c.data.is_active!==!1})}catch(b){f.value=b.message||"Ошибка загрузки услуги",console.error("Error fetching service:",b)}finally{u.value=!1}},n=async b=>{o.value=!0,x.value=null;try{const c=d.value?`/services/${a.params.id}`:"/services",k=await(d.value?J:K)(c,b);if(!k.ok){const F=await k.json().catch(()=>({}));throw new Error(F.message||`Ошибка ${d.value?"обновления":"создания"} услуги`)}await Q.fire({title:d.value?"Услуга обновлена":"Услуга создана",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.services"})}catch(c){x.value=c.message||"Ошибка сохранения услуги"}finally{o.value=!1}},w=()=>{e.push({name:"admin.decisions.services"})};return q(()=>{r()}),{loading:u,saving:o,error:f,formError:x,form:v,isEdit:d,saveService:n,goBack:w}}},Fe={class:"service-form-page space-y-6"},Ce={class:"flex items-center justify-between"},Ie={class:"text-3xl font-semibold text-foreground"},Se={key:0,class:"flex items-center justify-center py-12"},Me={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},je={class:"text-destructive"},Ee={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Be(a,e,u,o,f,x){const v=M("ServiceForm");return s(),i("div",Fe,[t("div",Ce,[t("div",null,[t("h1",Ie,h(o.isEdit?"Редактировать услугу":"Создать услугу"),1),e[1]||(e[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление услугой для блока решений",-1))]),t("button",{onClick:e[0]||(e[0]=(...d)=>o.goBack&&o.goBack(...d)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(s(),i("div",Se,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):g("",!0),o.error?(s(),i("div",Me,[t("p",je,h(o.error),1)])):g("",!0),o.loading?g("",!0):(s(),i("div",Ee,[y(v,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveService,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const Pe=U(we,[["render",Be]]);export{Pe as default};
