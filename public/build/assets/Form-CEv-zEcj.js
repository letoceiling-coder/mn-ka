import{_ as F,r as m,q as D,o as C,e as i,h as l,f as b,i as x,v as I,y as U,F as M,k as z,t as f,D as N,g as P,l as w,b as j,d as s,c as q,H as R,z as G}from"./app-DaAEG5wj.js";import{a as B,b as H,c as L}from"./api-DccBIR6h.js";import{S as O}from"./sweetalert2.esm.all-C0u8rGqG.js";import T from"./Media-DU8FpYag.js";const A={name:"ServiceForm",components:{Media:T},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const d=m([]),o=m(!1),v=m(!1),u=m(null),c=m(null),t=m({name:n.initialData.name||"",slug:n.initialData.slug||"",chapter_id:n.initialData.chapter_id||null,image_id:n.initialData.image_id||null,icon_id:n.initialData.icon_id||null,order:n.initialData.order??0,is_active:n.initialData.is_active!==!1}),h=async()=>{try{const r=await B("/chapters");if(r.ok){const V=await r.json();d.value=V.data||[]}}catch(r){console.error("Error fetching chapters:",r)}},k=()=>{o.value=!0},y=()=>{v.value=!0},g=r=>{u.value=r,t.value.image_id=r.id,o.value=!1},a=r=>{c.value=r,t.value.icon_id=r.id,v.value=!1},S=()=>{u.value=null,t.value.image_id=null},_=()=>{c.value=null,t.value.icon_id=null};D(()=>n.initialData,r=>{t.value={name:r.name||"",slug:r.slug||"",chapter_id:r.chapter_id||null,image_id:r.image_id||null,icon_id:r.icon_id||null,order:r.order??0,is_active:r.is_active!==!1},r.image&&(u.value=r.image),r.icon&&(c.value=r.icon)},{deep:!0});const p=()=>{e("submit",{name:t.value.name,slug:t.value.slug||null,chapter_id:t.value.chapter_id||null,image_id:t.value.image_id||null,icon_id:t.value.icon_id||null,order:t.value.order,is_active:t.value.is_active})},E=()=>{e("cancel")};return C(()=>{h(),n.initialData.image&&(u.value=n.initialData.image),n.initialData.icon&&(c.value=n.initialData.icon)}),{chapters:d,localForm:t,showImageMediaModal:o,showIconMediaModal:v,selectedImage:u,selectedIcon:c,openImageModal:k,openIconModal:y,handleImageSelected:g,handleIconSelected:a,removeImage:S,removeIcon:_,handleSubmit:p,handleCancel:E}}},J=["value"],K={class:"flex items-center gap-3"},Q={key:0,class:"flex-1"},W=["src","alt"],X={class:"flex items-center gap-3"},Y={key:0,class:"flex-1"},Z=["src","alt"],$={class:"flex items-center gap-2"},ee={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},oe={class:"flex gap-2 pt-4"},te=["disabled"],le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},re={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ne={class:"flex items-center justify-between p-4 border-b border-border"},ae={class:"flex-1 overflow-auto h-full"},ie={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},se={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},de={class:"flex items-center justify-between p-4 border-b border-border"},ce={class:"flex-1 overflow-auto h-full"};function ue(n,e,d,o,v,u){const c=j("Media");return s(),i(M,null,[l("form",{onSubmit:e[10]||(e[10]=P((...t)=>o.handleSubmit&&o.handleSubmit(...t),["prevent"])),class:"space-y-4"},[l("div",null,[e[13]||(e[13]=l("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),x(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.localForm.name=t),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название услуги"},null,512),[[I,o.localForm.name]])]),l("div",null,[e[14]||(e[14]=l("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),x(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.localForm.slug=t),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[I,o.localForm.slug]]),e[15]||(e[15]=l("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),l("div",null,[e[17]||(e[17]=l("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),x(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.localForm.chapter_id=t),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[16]||(e[16]=l("option",{value:null},"Не выбран",-1)),(s(!0),i(M,null,z(o.chapters,t=>(s(),i("option",{key:t.id,value:t.id},f(t.name),9,J))),128))],512),[[U,o.localForm.chapter_id]])]),l("div",null,[e[18]||(e[18]=l("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),l("div",K,[o.selectedImage?(s(),i("div",Q,[l("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,W)])):b("",!0),l("button",{type:"button",onClick:e[3]||(e[3]=(...t)=>o.openImageModal&&o.openImageModal(...t)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(s(),i("button",{key:1,type:"button",onClick:e[4]||(e[4]=(...t)=>o.removeImage&&o.removeImage(...t)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):b("",!0)])]),l("div",null,[e[19]||(e[19]=l("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),l("div",X,[o.selectedIcon?(s(),i("div",Y,[l("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,Z)])):b("",!0),l("button",{type:"button",onClick:e[5]||(e[5]=(...t)=>o.openIconModal&&o.openIconModal(...t)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(s(),i("button",{key:1,type:"button",onClick:e[6]||(e[6]=(...t)=>o.removeIcon&&o.removeIcon(...t)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):b("",!0)])]),l("div",null,[e[20]||(e[20]=l("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),x(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.localForm.order=t),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[I,o.localForm.order,void 0,{number:!0}]])]),l("div",$,[x(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.localForm.is_active=t),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[N,o.localForm.is_active]]),e[21]||(e[21]=l("label",{for:"is_active",class:"text-sm font-medium"}," Активна ",-1))]),d.error?(s(),i("div",ee,f(d.error),1)):b("",!0),l("div",oe,[l("button",{type:"button",onClick:e[9]||(e[9]=(...t)=>o.handleCancel&&o.handleCancel(...t)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),l("button",{type:"submit",disabled:d.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},f(d.saving?"Сохранение...":"Сохранить"),9,te)])],32),o.showImageMediaModal?(s(),i("div",le,[l("div",re,[l("div",ne,[e[22]||(e[22]=l("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),l("button",{onClick:e[11]||(e[11]=t=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),l("div",ae,[w(c,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):b("",!0),o.showIconMediaModal?(s(),i("div",ie,[l("div",se,[l("div",de,[e[23]||(e[23]=l("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),l("button",{onClick:e[12]||(e[12]=t=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),l("div",ce,[w(c,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):b("",!0)],64)}const me=F(A,[["render",ue]]),be={name:"ServiceFormPage",components:{ServiceForm:me},setup(){const n=R(),e=G(),d=m(!1),o=m(!1),v=m(null),u=m(null),c=m({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,image:null,icon:null,order:0,is_active:!0}),t=q(()=>!!n.params.id),h=async()=>{if(!t.value){d.value=!1;return}d.value=!0,v.value=null;try{const g=await B(`/services/${n.params.id}`);if(!g.ok)throw new Error("Ошибка загрузки услуги");const a=await g.json();a.data&&(c.value={id:a.data.id,name:a.data.name||"",slug:a.data.slug||"",chapter_id:a.data.chapter_id||null,image_id:a.data.image_id||null,icon_id:a.data.icon_id||null,image:a.data.image||null,icon:a.data.icon||null,order:a.data.order??0,is_active:a.data.is_active!==!1})}catch(g){v.value=g.message||"Ошибка загрузки услуги",console.error("Error fetching service:",g)}finally{d.value=!1}},k=async g=>{o.value=!0,u.value=null;try{const a=t.value?`/services/${n.params.id}`:"/services",_=await(t.value?H:L)(a,g);if(!_.ok){const p=await _.json().catch(()=>({}));throw new Error(p.message||`Ошибка ${t.value?"обновления":"создания"} услуги`)}await O.fire({title:t.value?"Услуга обновлена":"Услуга создана",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.services"})}catch(a){u.value=a.message||"Ошибка сохранения услуги"}finally{o.value=!1}},y=()=>{e.push({name:"admin.decisions.services"})};return C(()=>{h()}),{loading:d,saving:o,error:v,formError:u,form:c,isEdit:t,saveService:k,goBack:y}}},ve={class:"service-form-page space-y-6"},ge={class:"flex items-center justify-between"},fe={class:"text-3xl font-semibold text-foreground"},xe={key:0,class:"flex items-center justify-center py-12"},_e={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},he={class:"text-destructive"},ke={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function ye(n,e,d,o,v,u){const c=j("ServiceForm");return s(),i("div",ve,[l("div",ge,[l("div",null,[l("h1",fe,f(o.isEdit?"Редактировать услугу":"Создать услугу"),1),e[1]||(e[1]=l("p",{class:"text-muted-foreground mt-1"},"Управление услугой для блока решений",-1))]),l("button",{onClick:e[0]||(e[0]=(...t)=>o.goBack&&o.goBack(...t)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(s(),i("div",xe,[...e[2]||(e[2]=[l("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):b("",!0),o.error?(s(),i("div",_e,[l("p",he,f(o.error),1)])):b("",!0),o.loading?b("",!0):(s(),i("div",ke,[w(c,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveService,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const Me=F(be,[["render",ye]]);export{Me as default};
