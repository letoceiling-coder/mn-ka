import{_ as M,d as f,e as V,y as F,c as d,b as o,g as x,p as y,C as U,F as T,l as j,o as i,t as b,v as B,h as O,a as W,w as q,x as oe,j as L,m as ne,i as se,s as re,f as ie,A as le,r as E,B as ae,z as de}from"./app-DGcwVKox.js";import{D as ce}from"./DecisionCard-CfIeq-7g.js";import{L as ue}from"./LazyImage-BlUYTay9.js";import{u as me,P as fe}from"./useDebounce-DeX9wrE9.js";import{F as pe}from"./FeedbackForm-Dwv2UDht.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const ge={name:"ServiceOptionsStage",props:{service:{type:Object,required:!0}},emits:["update-options"],setup(g,{emit:e}){const l=f(null),t=f(null),c=f(null),v=V(()=>{if(!t.value||!g.service.option_trees)return[];const w=g.service.option_trees.find(p=>p.id===t.value);return!w||!w.items||w.items.length===0?g.service.instances||[]:w.items.map(p=>({id:p.id,name:p.name}))}),n=()=>{u()},r=()=>{c.value=null,u()},a=()=>{u()},u=()=>{e("update-options",{option:l.value,optionTree:t.value,instance:c.value})};return F(()=>g.service?.id,()=>{l.value=null,t.value=null,c.value=null}),{selectedOption:l,selectedOptionTree:t,selectedInstance:c,availableInstances:v,onOptionChange:n,onOptionTreeChange:r,onInstanceChange:a}}},ve={class:"w-full max-w-4xl mx-auto"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},xe={class:"md:col-span-1"},be=["value"],we={class:"md:col-span-1"},ke=["value"],Ce={key:0,class:"md:col-span-1"},_e=["value"];function ye(g,e,l,t,c,v){return i(),d("div",ve,[o("div",he,[o("div",xe,[e[7]||(e[7]=o("div",{class:"flex items-center gap-3 mb-3"},[o("span",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-[#688E67] text-white font-semibold text-sm flex-shrink-0"},"1"),o("span",{class:"text-sm md:text-base font-medium text-foreground"},"Категория заявителя")],-1)),y(o("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.selectedOption=n),onChange:e[1]||(e[1]=(...n)=>t.onOptionChange&&t.onOptionChange(...n)),class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},[e[6]||(e[6]=o("option",{value:""},"Выберите категорию",-1)),(i(!0),d(T,null,j(l.service.options,n=>(i(),d("option",{key:n.id,value:n.id},b(n.name),9,be))),128))],544),[[U,t.selectedOption]])]),o("div",we,[e[9]||(e[9]=o("div",{class:"flex items-center gap-3 mb-3"},[o("span",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-[#688E67] text-white font-semibold text-sm flex-shrink-0"},"2"),o("span",{class:"text-sm md:text-base font-medium text-foreground"},"Цель вашего обращения")],-1)),y(o("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>t.selectedOptionTree=n),onChange:e[3]||(e[3]=(...n)=>t.onOptionTreeChange&&t.onOptionTreeChange(...n)),class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},[e[8]||(e[8]=o("option",{value:""},"Выберите цель",-1)),(i(!0),d(T,null,j(l.service.option_trees,n=>(i(),d("option",{key:n.id,value:n.id},b(n.name),9,ke))),128))],544),[[U,t.selectedOptionTree]])]),t.selectedOptionTree&&t.availableInstances.length>0?(i(),d("div",Ce,[e[11]||(e[11]=o("div",{class:"flex items-center gap-3 mb-3"},[o("span",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-[#688E67] text-white font-semibold text-sm flex-shrink-0"},"3"),o("span",{class:"text-sm md:text-base font-medium text-foreground"},"Подходящий случай")],-1)),y(o("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>t.selectedInstance=n),onChange:e[5]||(e[5]=(...n)=>t.onInstanceChange&&t.onInstanceChange(...n)),class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},[e[10]||(e[10]=o("option",{value:""},"Выберите случай",-1)),(i(!0),d(T,null,j(t.availableInstances,n=>(i(),d("option",{key:n.id,value:n.id},b(n.name),9,_e))),128))],544),[[U,t.selectedInstance]])])):x("",!0)])])}const Se=M(ge,[["render",ye]]),Oe={name:"ServiceFormsStage",props:{service:{type:Object,required:!0}},emits:["update-form"],setup(g,{emit:e}){const l=f({name:"",phone:"",comment:""}),{debounced:t}=me(()=>{e("update-form",{...l.value})},300),c=()=>{t()},v=n=>{let r=n.replace(/\D/g,"");if(r.length>11&&(r=r.slice(0,11)),r.length>0&&!r.startsWith("7")&&(r.startsWith("8")?r="7"+r.slice(1):r="7"+r),r.length<=1)return r.length===0?"":"+7";let a="+7";const u=r.slice(1);return u.length>0&&(a+=" ("+u.slice(0,3),u.length>3&&(a+=") "+u.slice(3,6),u.length>6&&(a+="-"+u.slice(6,8),u.length>8&&(a+="-"+u.slice(8,10))))),a};return F(()=>l.value.phone,n=>{const r=v(n);r!==n&&(l.value.phone=r),c()}),F(()=>l.value.name,()=>{c()}),F(()=>l.value.comment,()=>{c()}),{form:l,updateForm:c}}},Ee={class:"w-full max-w-2xl mx-auto"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},Te={class:"md:col-span-2"};function je(g,e,l,t,c,v){return i(),d("div",Ee,[o("div",Fe,[o("div",null,[e[6]||(e[6]=o("label",{for:"service-name",class:"block text-sm font-medium text-foreground mb-2"}," Как к Вам обращаться * ",-1)),y(o("input",{id:"service-name",type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>t.form.name=n),onInput:e[1]||(e[1]=(...n)=>t.updateForm&&t.updateForm(...n)),placeholder:"Ваше имя",class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent",required:""},null,544),[[B,t.form.name]])]),o("div",null,[e[7]||(e[7]=o("label",{for:"service-phone",class:"block text-sm font-medium text-foreground mb-2"}," Ваш номер телефона * ",-1)),y(o("input",{id:"service-phone",type:"tel","onUpdate:modelValue":e[2]||(e[2]=n=>t.form.phone=n),onInput:e[3]||(e[3]=(...n)=>t.updateForm&&t.updateForm(...n)),placeholder:"+7 (___) ___-__-__",class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent",required:""},null,544),[[B,t.form.phone]])]),o("div",Te,[e[8]||(e[8]=o("label",{for:"service-comment",class:"block text-sm font-medium text-foreground mb-2"}," Комментарий (необязательно) ",-1)),y(o("textarea",{id:"service-comment","onUpdate:modelValue":e[4]||(e[4]=n=>t.form.comment=n),onInput:e[5]||(e[5]=(...n)=>t.updateForm&&t.updateForm(...n)),placeholder:"Введите комментарий или пометку",rows:"4",class:"w-full px-4 py-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent resize-none"},null,544),[[B,t.form.comment]])])])])}const Me=M(Oe,[["render",je]]),Ie={name:"ServiceSuccessStage",props:{service:{type:Object,required:!0}}},Ue={class:"w-full max-w-md mx-auto text-center"};function Be(g,e,l,t,c,v){return i(),d("div",Ue,[...e[0]||(e[0]=[o("div",{class:"flex justify-center mb-6"},[o("svg",{width:"116",height:"90",viewBox:"0 0 116 90",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M5.30078 42.0864L42.8008 79.0864L110.301 5.08636",stroke:"#688E67","stroke-width":"15.095","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),o("h2",{class:"text-xl md:text-2xl font-semibold text-foreground"}," Спасибо за Ваше обращение, в ближайшее время мы свяжемся с Вами ",-1)])])}const Le=M(Ie,[["render",Be]]),Ve={name:"ServicePage",components:{DecisionCard:ce,LazyImage:ue,ProductSkeleton:fe,FeedbackForm:pe,ServiceOptionsStage:Se,ServiceFormsStage:Me,ServiceSuccessStage:Le},setup(){const g=ae(),e=f(!1),l=f(null),t=f(null),c=f([]),v=f(!1),n=f("options"),r=f({option:null,optionTree:null,instance:null}),a=f({name:"",phone:"",comment:""}),u=f(window.innerWidth),w=f(!1),p=f(null),I=f(null),k=f(null),G=V(()=>({options:"ServiceOptionsStage",forms:"ServiceFormsStage",success:"ServiceSuccessStage"})[n.value]||"ServiceOptionsStage"),Z=V(()=>n.value==="options"?r.value.option&&r.value.optionTree&&r.value.instance:n.value==="forms"?a.value.name.trim()!==""&&a.value.phone.trim()!=="":!1),P=()=>{u.value=window.innerWidth},R=s=>{r.value={...r.value,...s}},J=s=>{a.value={...a.value,...s}},Y=async()=>{n.value==="options"?(n.value="forms",await de(),await A()):n.value==="forms"&&await Q()},A=()=>new Promise(s=>{if(!I.value){s();return}setTimeout(()=>{const m=I.value;if(!m){s();return}const S=m.getBoundingClientRect().top+window.pageYOffset-100;K(Math.max(0,S),600).then(s)},150)}),K=(s,m)=>new Promise(h=>{const C=window.pageYOffset,_=s-C;let S=null;const N=z=>{S===null&&(S=z);const H=z-S,ee=Math.min(H/m,1),te=.5-Math.cos(ee*Math.PI)/2;window.scrollTo(0,C+_*te),H<m?requestAnimationFrame(N):h()};requestAnimationFrame(N)}),Q=async()=>{e.value=!0;try{const s=await fetch("/api/public/leave-services",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({service_id:t.value.id,name:a.value.name,phone:a.value.phone,comment:a.value.comment||"",option:r.value.option,option_tree:r.value.optionTree,instance:r.value.instance})});if(s.ok)n.value="success";else{const m=await s.json().catch(()=>({}));l.value=m.message||"Ошибка при отправке заявки"}}catch(s){l.value="Ошибка при отправке заявки",console.error("Error submitting form:",s)}finally{e.value=!1}},D=async()=>{e.value=!0,l.value=null,k.value&&k.value.abort(),k.value=new AbortController;try{const s=g.params.slug,m=`/api/public/services/${encodeURIComponent(s)}`,h=await fetch(m,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:k.value.signal}),C=h.headers.get("content-type");if(!C||!C.includes("application/json"))throw new Error(`Ошибка: сервер вернул не JSON ответ (статус: ${h.status})`);const _=await h.json();if(!h.ok)throw new Error(_.message||`Ошибка ${h.status}: Услуга не найдена`);if(_.data)t.value=_.data,Promise.all([X(),$()]);else throw new Error("Услуга не найдена")}catch(s){if(s.name==="AbortError")return;console.error("Error fetching service:",s),s instanceof SyntaxError&&s.message.includes("JSON")?l.value="Ошибка: сервер вернул некорректный ответ.":l.value=s.message||"Ошибка загрузки услуги"}finally{e.value=!1}},X=async()=>{if(!v.value)try{const s=await fetch("/api/public/services?active=1&limit=8",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(s.ok){const m=await s.json();c.value=(m.data||[]).filter(h=>h.id!==t.value?.id).slice(0,8)}}catch(s){console.error("Error fetching services:",s)}},$=async()=>{try{const s=await fetch("/api/public/modal-settings/services",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(s.ok){const m=await s.json();m.data&&m.data.is_active&&(p.value=m.data)}}catch(s){console.error("Error fetching modal settings:",s)}};return F(()=>g.params.slug,(s,m)=>{s!==m&&(t.value=null,c.value=[],n.value="options",r.value={option:null,optionTree:null,instance:null},a.value={name:"",phone:"",comment:""},D())}),ie(()=>{window.addEventListener("resize",P),D()}),le(()=>{window.removeEventListener("resize",P),k.value&&k.value.abort()}),{loading:e,error:l,service:t,servicesList:c,stage:n,selectedOptions:r,formData:a,windowWidth:u,showInfoModal:w,modalSettings:p,currentStageComponent:G,canProceed:Z,handleOptionsUpdate:R,handleFormUpdate:J,handleNextStage:Y,formContainer:I,scrollToForm:A,loadingLists:v}}},Pe={class:"service-page min-h-screen bg-background"},Ae={class:"w-full px-3 sm:px-4 md:px-5"},De={class:"w-full max-w-[1200px] mx-auto"},Ne={key:1,class:"py-12"},ze={class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},He={class:"text-destructive"},We={key:2},qe={class:"hidden md:block mt-4"},Ge={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ze={class:"text-foreground"},Re={class:"mt-6 md:mt-8 grid md:grid-cols-2 gap-6 md:gap-8 items-center"},Je={class:"text-2xl md:text-3xl font-semibold text-foreground mb-3 md:text-left text-center"},Ye={key:0,class:"text-base md:text-lg text-muted-foreground leading-relaxed md:text-left text-center"},Ke={class:"relative"},Qe={class:"mt-8 py-5 relative bg-[#F4F6FC] rounded-lg"},Xe={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-4 md:px-6"},$e={class:"mt-6 mb-8 flex justify-center px-4 md:px-6"},et=["disabled"],tt={key:0,class:"mt-12 pb-12"},ot={class:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4"},nt={class:"mt-12 pb-12"},st={class:"bg-background rounded-lg p-6 max-w-md w-full"},rt={class:"text-lg font-semibold mb-4"},it=["innerHTML"];function lt(g,e,l,t,c,v){const n=E("ProductSkeleton"),r=E("router-link"),a=E("LazyImage"),u=E("DecisionCard"),w=E("FeedbackForm");return i(),d("div",Pe,[o("div",Ae,[o("div",De,[t.loading&&!t.service?(i(),O(n,{key:0})):x("",!0),t.error&&!t.loading?(i(),d("div",Ne,[o("div",ze,[o("p",He,b(t.error),1)])])):x("",!0),t.service&&!t.loading?(i(),d("div",We,[o("div",qe,[o("nav",Ge,[W(r,{to:"/",class:"hover:text-foreground transition-colors"},{default:q(()=>[...e[4]||(e[4]=[L("Главная",-1)])]),_:1}),e[5]||(e[5]=o("span",null,"/",-1)),e[6]||(e[6]=o("span",{class:"text-foreground"},"Услуги",-1)),e[7]||(e[7]=o("span",null,"/",-1)),o("span",Ze,b(t.service.name),1)])]),o("div",Re,[o("div",null,[o("h1",Je,b(t.service.name),1),t.service.description?(i(),d("div",Ye,b(typeof t.service.description=="string"?t.service.description:t.service.description?.ru||""),1)):x("",!0)]),o("div",Ke,[t.service.image?(i(),O(a,{key:0,src:t.service.image.url,alt:t.service.name,"image-class":"w-full h-auto rounded-lg shadow-md","container-class":"relative w-full",eager:!0},null,8,["src","alt"])):x("",!0),e[8]||(e[8]=oe('<div class="absolute top-4 right-4 cursor-pointer hidden md:block"><svg width="44" height="48" viewBox="0 0 44 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M35.3327 15.2C39.0145 15.2 41.9993 12.2451 41.9993 8.60002C41.9993 4.95493 39.0145 2 35.3327 2C31.6508 2 28.666 4.95493 28.666 8.60002C28.666 12.2451 31.6508 15.2 35.3327 15.2Z" stroke="#688E67" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8.66664 30.5998C12.3485 30.5998 15.3333 27.6449 15.3333 23.9998C15.3333 20.3547 12.3485 17.3997 8.66664 17.3997C4.98476 17.3997 2 20.3547 2 23.9998C2 27.6449 4.98476 30.5998 8.66664 30.5998Z" stroke="#688E67" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M35.3327 46C39.0145 46 41.9993 43.0451 41.9993 39.4C41.9993 35.7549 39.0145 32.8 35.3327 32.8C31.6508 32.8 28.666 35.7549 28.666 39.4C28.666 43.0451 31.6508 46 35.3327 46Z" stroke="#688E67" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><g filter="url(#filter0_d_743_2384)"><path d="M14.2227 27.3001L29.7782 36.1002M29.7782 11.9001L14.2227 20.7001" stroke="#688E67" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" shape-rendering="crispEdges"></path></g><defs><filter id="filter0_d_743_2384" x="8.22266" y="9.89972" width="27.5557" height="36.2008" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="4"></feOffset><feGaussianBlur stdDeviation="2"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_743_2384"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_743_2384" result="shape"></feBlend></filter></defs></svg></div>',1))])]),o("div",Qe,[o("div",Xe,[e[10]||(e[10]=o("div",{class:"flex flex-col gap-2"},[o("span",{class:"text-sm md:text-base font-semibold text-foreground"},[L(" Для получения услуги "),o("span",{class:"text-[#688E67]"},"выберите необходимые параметры")])],-1)),t.windowWidth>767?(i(),d("button",{key:0,onClick:e[0]||(e[0]=p=>t.showInfoModal=!0),class:"flex items-center justify-center w-10 h-10 hover:bg-muted/10 rounded-lg transition-colors",type:"button"},[...e[9]||(e[9]=[o("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M0 2.22222V37.7778C0 38.3671 0.234126 38.9324 0.650874 39.3491C1.06762 39.7659 1.63285 40 2.22222 40H37.7778C38.3671 40 38.9324 39.7659 39.3491 39.3491C39.7659 38.9324 40 38.3671 40 37.7778V2.22222C40 1.63285 39.7659 1.06762 39.3491 0.650874C38.9324 0.234126 38.3671 0 37.7778 0H2.22222C1.63285 0 1.06762 0.234126 0.650874 0.650874C0.234126 1.06762 0 1.63285 0 2.22222ZM17.7778 10.8889C17.7778 9.78432 18.6732 8.88889 19.7778 8.88889H20.2222C21.3268 8.88889 22.2222 9.78432 22.2222 10.8889V11.3333C22.2222 12.4379 21.3268 13.3333 20.2222 13.3333H19.7778C18.6732 13.3333 17.7778 12.4379 17.7778 11.3333V10.8889ZM17.7778 19.7778C17.7778 18.6732 18.6732 17.7778 19.7778 17.7778H20.2222C21.3268 17.7778 22.2222 18.6732 22.2222 19.7778V29.1111C22.2222 30.2157 21.3268 31.1111 20.2222 31.1111H19.7778C18.6732 31.1111 17.7778 30.2157 17.7778 29.1111V19.7778Z",fill:"#688E67"})],-1)])])):x("",!0)]),o("div",{id:"service-form-container",ref:"formContainer",class:ne(["mt-8 px-4 md:px-6",t.windowWidth>767?"px-5":""])},[(i(),O(se(t.currentStageComponent),{service:t.service,onUpdateOptions:t.handleOptionsUpdate,onUpdateForm:t.handleFormUpdate},null,40,["service","onUpdateOptions","onUpdateForm"]))],2),o("div",$e,[t.stage!=="success"?(i(),d("button",{key:0,onClick:e[1]||(e[1]=(...p)=>t.handleNextStage&&t.handleNextStage(...p)),disabled:!t.canProceed,class:"w-full md:w-auto md:px-8 h-12 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium"},b(t.stage==="options"?"Получить услугу":"Отправить заявку"),9,et)):(i(),O(r,{key:1,to:"/products",class:"inline-block w-full md:w-auto md:px-8 h-12 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors flex items-center justify-center font-medium"},{default:q(()=>[...e[11]||(e[11]=[L(" Смотреть другие услуги ",-1)])]),_:1}))])]),t.servicesList.length>0?(i(),d("div",tt,[e[12]||(e[12]=o("h2",{class:"text-2xl md:text-3xl font-semibold text-foreground mb-6"},"Другие услуги",-1)),o("div",ot,[(i(!0),d(T,null,j(t.servicesList,p=>(i(),O(u,{key:`service-${p.id}`,decision:p,slug:"services",class:"h-full"},null,8,["decision"]))),128))])])):x("",!0),o("div",nt,[W(w,{title:"Остались вопросы?",description:"Напишите нам, и мы с удовольствием ответим на все ваши вопросы"})])])):x("",!0)])]),t.showInfoModal&&t.modalSettings?(i(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[3]||(e[3]=re(p=>t.showInfoModal=!1,["self"]))},[o("div",st,[o("h3",rt,b(t.modalSettings.title||"Информация"),1),o("p",{class:"text-muted-foreground mb-4",innerHTML:t.modalSettings.content||"Здесь будет информация об услуге."},null,8,it),o("button",{onClick:e[2]||(e[2]=p=>t.showInfoModal=!1),class:"w-full h-10 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors"}," Закрыть ")])])):x("",!0)])}const pt=M(Ve,[["render",lt]]);export{pt as default};
