import{_ as z,e as i,h as t,f as _,l as B,t as c,w as S,F as C,k as j,r as x,o as T,b as E,d as a,m as I}from"./app-Dl5YdxLj.js";import{a as F,d as L}from"./api-DccBIR6h.js";import{S as d}from"./sweetalert2.esm.all-C0u8rGqG.js";const D={name:"DecisionServices",setup(){const b=x(!1),o=x(!1),h=x(!1),e=x(null),w=x([]),g=async()=>{b.value=!0,e.value=null;try{const r=await F("/services");if(!r.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥");const l=await r.json();w.value=l.data||[]}catch(r){e.value=r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥",console.error("Error fetching services:",r)}finally{b.value=!1}},v=async(r="csv")=>{o.value=!0;try{const l=localStorage.getItem("token"),u=await fetch(`/api/v1/services/export${r==="zip"?"?format=zip":""}`,{method:"GET",headers:{Authorization:`Bearer ${l}`,Accept:r==="zip"?"application/zip":"text/csv"}});if(!u.ok)throw new Error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥");const y=await u.blob(),m=window.URL.createObjectURL(y),s=document.createElement("a");s.href=m;const p=r==="zip"?"zip":"csv";s.download=`services_${new Date().toISOString().split("T")[0]}.${p}`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(m),document.body.removeChild(s),await d.fire({title:"–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(l){await d.fire({title:"–û—à–∏–±–∫–∞",text:l.message||"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥",icon:"error",confirmButtonText:"–û–ö"})}finally{o.value=!1}},n=async r=>{const l=r.target.files?.[0];if(!l)return;const f=100*1024*1024;if(l.size>f){await d.fire({title:"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π",html:`
                        <p>–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: <strong>${(l.size/1024/1024).toFixed(2)} MB</strong></p>
                        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <strong>100 MB</strong></p>
                        <p class="mt-4 text-sm text-gray-600">–ï—Å–ª–∏ —Ñ–∞–π–ª –º–µ–Ω—å—à–µ 100MB, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:</p>
                        <ul class="mt-2 text-sm text-left list-disc list-inside text-gray-600">
                            <li>PHP: upload_max_filesize, post_max_size</li>
                            <li>–í–µ–±-—Å–µ—Ä–≤–µ—Ä: client_max_body_size (nginx) –∏–ª–∏ LimitRequestBody (apache)</li>
                        </ul>
                    `,icon:"error",confirmButtonText:"–û–ö"}),r.target.value="";return}h.value=!0;try{const u=new FormData;u.append("file",l);const y=localStorage.getItem("token"),m=await fetch("/api/v1/services/import",{method:"POST",headers:{Authorization:`Bearer ${y}`},body:u});if(m.status===413)throw new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100MB. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (upload_max_filesize, post_max_size).");let s;try{s=await m.json()}catch{throw m.status===413?new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (413 Content Too Large). –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."):new Error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞")}if(!m.ok){const p=s?.message||s?.errors?.[0]||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥";throw new Error(p)}await d.fire({title:"–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",html:`
                        <p>${s.message}</p>
                        ${s.errors&&s.errors.length>0?`
                            <details class="mt-4 text-left">
                                <summary class="cursor-pointer text-sm">–û—à–∏–±–∫–∏ (${s.errors.length})</summary>
                                <div class="mt-2 max-h-40 overflow-y-auto text-xs">
                                    ${s.errors.map(p=>`<p>–°—Ç—Ä–æ–∫–∞ ${p.row}: ${p.errors.join(", ")}</p>`).join("")}
                                </div>
                            </details>
                        `:""}
                    `,icon:s.success_count>0?"success":"warning",confirmButtonText:"–û–ö"}),r.target.value="",await g()}catch(u){await d.fire({title:"–û—à–∏–±–∫–∞",text:u.message||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —É—Å–ª—É–≥",icon:"error",confirmButtonText:"–û–ö"})}finally{h.value=!1}},k=async r=>{if((await d.fire({title:"–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É?",text:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É "${r.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626"})).isConfirmed)try{if(!(await L(`/services/${r.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏");await d.fire({title:"–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await g()}catch(f){await d.fire({title:"–û—à–∏–±–∫–∞",text:f.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏",icon:"error",confirmButtonText:"–û–ö"})}};return T(()=>{g()}),{loading:b,exporting:o,importing:h,error:e,services:w,fetchServices:g,deleteService:k,exportServices:v,handleImportFile:n}}},M={class:"services-page space-y-6"},V={class:"flex items-center justify-between"},P={class:"flex items-center gap-3"},R=["disabled"],N={key:0},O={key:1},U=["disabled"],A={key:0},G={key:1},Z={class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 cursor-pointer"},q=["disabled"],H={key:0},J={key:1},K={key:0,class:"flex items-center justify-center py-12"},Q={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},W={class:"text-destructive"},X={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},Y={class:"divide-y divide-border"},$={class:"flex-1"},ee={class:"font-medium text-foreground"},te={class:"text-sm text-muted-foreground"},oe={class:"flex items-center gap-2"},re=["onClick"],se={key:3,class:"text-center py-12 bg-card rounded-lg border border-border"};function ne(b,o,h,e,w,g){const v=E("router-link");return a(),i("div",M,[t("div",V,[o[4]||(o[4]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–£—Å–ª—É–≥–∏"),t("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏ –¥–ª—è –±–ª–æ–∫–∞ —Ä–µ—à–µ–Ω–∏–π")],-1)),t("div",P,[t("button",{onClick:o[0]||(o[0]=n=>e.exportServices("csv")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",O,"...")):(a(),i("span",N,"üì•")),t("span",null,c(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç CSV"),1)],8,R),t("button",{onClick:o[1]||(o[1]=n=>e.exportServices("zip")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",G,"...")):(a(),i("span",A,"üì¶")),t("span",null,c(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç ZIP"),1)],8,U),t("label",Z,[t("input",{type:"file",accept:".zip,.csv,.txt",onChange:o[2]||(o[2]=(...n)=>e.handleImportFile&&e.handleImportFile(...n)),class:"hidden",disabled:e.loading||e.importing},null,40,q),e.importing?(a(),i("span",J,"...")):(a(),i("span",H,"üì§")),t("span",null,c(e.importing?"–ò–º–ø–æ—Ä—Ç...":"–ò–º–ø–æ—Ä—Ç ZIP/CSV"),1)]),B(v,{to:{name:"admin.decisions.services.create"},class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},{default:S(()=>[...o[3]||(o[3]=[t("span",null,"+",-1),t("span",null,"–°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É",-1)])]),_:1})])]),e.loading?(a(),i("div",K,[...o[5]||(o[5]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥...",-1)])])):_("",!0),e.error?(a(),i("div",Q,[t("p",W,c(e.error),1)])):_("",!0),!e.loading&&e.services.length>0?(a(),i("div",X,[t("div",Y,[(a(!0),i(C,null,j(e.services,n=>(a(),i("div",{key:n.id,class:"p-4 hover:bg-muted/10 transition-colors flex items-center justify-between"},[t("div",$,[t("h3",ee,c(n.name),1),t("p",te," Slug: "+c(n.slug)+" | –ü–æ—Ä—è–¥–æ–∫: "+c(n.order)+" | "+c(n.is_active?"–ê–∫—Ç–∏–≤–Ω–∞":"–ù–µ–∞–∫—Ç–∏–≤–Ω–∞"),1)]),t("div",oe,[B(v,{to:{name:"admin.decisions.services.edit",params:{id:n.id}},class:"px-3 py-1.5 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors inline-block"},{default:S(()=>[...o[6]||(o[6]=[I(" –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",-1)])]),_:1},8,["to"]),t("button",{onClick:k=>e.deleteService(n),class:"px-3 py-1.5 text-sm bg-destructive/10 text-destructive hover:bg-destructive/20 rounded-lg transition-colors"}," –£–¥–∞–ª–∏—Ç—å ",8,re)])]))),128))])])):_("",!0),!e.loading&&e.services.length===0?(a(),i("div",se,[...o[7]||(o[7]=[t("p",{class:"text-muted-foreground"},"–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):_("",!0)])}const ce=z(D,[["render",ne]]);export{ce as default};
