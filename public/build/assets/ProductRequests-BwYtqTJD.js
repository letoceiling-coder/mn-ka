import{_ as J,c as r,b as e,d as i,t as a,l as f,v as F,D as k,q as U,F as x,k as p,p as K,A as R,h as m,i as O,j as Q,o as d,f as _}from"./app-B_qSWCTG.js";import{a as C,b as W}from"./api-V9GPpd21.js";import{S}from"./sweetalert2.esm.all-C0u8rGqG.js";const X={name:"ProductRequests",setup(){const h=m(!1),t=m(null),q=m([]),o=m(null),g=m(null),j=m([]),s=m(null),y=m(null),b=m({search:"",status:null,assigned_to:null}),w=m({status:null,assigned_to:null,notes:null}),v=async(n=1)=>{h.value=!0,t.value=null;try{const l=new URLSearchParams({page:n.toString(),per_page:"20"});b.value.search&&l.append("search",b.value.search),b.value.status&&l.append("status",b.value.status),b.value.assigned_to&&l.append("assigned_to",b.value.assigned_to);const u=await C(`/product-requests?${l.toString()}`);if(!u.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫");const c=await u.json();q.value=c.data||[],o.value={current_page:c.current_page,last_page:c.last_page,from:c.from,to:c.to,total:c.total}}catch(l){t.value=l.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫",console.error("Error fetching requests:",l)}finally{h.value=!1}},M=async()=>{try{const n=await C("/product-requests/stats");if(n.ok){const l=await n.json();s.value=l.data}}catch(n){console.error("Error fetching stats:",n)}},E=async()=>{try{const n=await C("/users");if(n.ok){const l=await n.json();j.value=l.data||[]}}catch(n){console.error("Error fetching users:",n)}},P=async()=>{try{const n=localStorage.getItem("token"),l={Accept:"application/json","Content-Type":"application/json"};n&&(l.Authorization=`Bearer ${n}`);const u=await fetch("/api/auth/user",{method:"GET",headers:l});if(u.ok){const c=await u.json();y.value=c.user||c}}catch(n){console.error("Error fetching auth user:",n)}},V=async n=>{try{const l=await C(`/product-requests/${n.id}`);if(!l.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–∫–∏");const u=await l.json();g.value=u.data,w.value={status:u.data.status,assigned_to:u.data.assigned_to,notes:u.data.notes||""}}catch(l){S.fire({title:"–û—à–∏–±–∫–∞",text:l.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫—É",icon:"error"})}},D=async()=>{if(g.value)try{const n=await W(`/product-requests/${g.value.id}`,w.value);if(!n.ok){const u=await n.json().catch(()=>({}));throw new Error(u.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏")}const l=await n.json();g.value=l.data,await v(o.value?.current_page||1),await M(),S.fire({title:"–£—Å–ø–µ—à–Ω–æ",text:"–ó–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(n){S.fire({title:"–û—à–∏–±–∫–∞",text:n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É",icon:"error"})}},T=()=>{g.value=null,w.value={status:null,assigned_to:null,notes:null}},B=()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{v(1)},500)},L=()=>{v(1)},z=n=>{v(n)},A=n=>{const l={new:"bg-accent/20 text-accent border-accent/50",in_progress:"bg-blue-500/20 text-blue-600 border-blue-500/50",completed:"bg-green-500/20 text-green-600 border-green-500/50",cancelled:"bg-gray-500/20 text-gray-600 border-gray-500/50",rejected:"bg-red-500/20 text-red-600 border-red-500/50"};return l[n]||l.new},N=n=>({new:"–ù–æ–≤–∞—è",in_progress:"–í –æ–±—Ä–∞–±–æ—Ç–∫–µ",completed:"–ó–∞–≤–µ—Ä—à–µ–Ω–∞",cancelled:"–û—Ç–º–µ–Ω–µ–Ω–∞",rejected:"–û—Ç–∫–ª–æ–Ω–µ–Ω–∞"})[n]||n,G=n=>n?new Date(n).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",H=O(()=>{if(!o.value)return[];const n=[],l=o.value.current_page,u=o.value.last_page;for(let c=Math.max(1,l-2);c<=Math.min(u,l+2);c++)n.push(c);return n});return Q(async()=>{await Promise.all([v(),M(),E(),P()])}),{loading:h,error:t,requests:q,pagination:o,selectedRequest:g,users:j,stats:s,authUser:y,filters:b,editForm:w,viewRequest:V,updateRequest:D,closeRequestModal:T,handleSearch:B,handleFilterChange:L,handlePageChange:z,getStatusClass:A,getStatusLabel:N,formatDate:G,getPageNumbers:H}}},Y={class:"product-requests-page space-y-6"},Z={class:"flex items-center justify-between"},I={key:0,class:"flex items-center gap-4"},$={class:"text-center"},ee={class:"text-2xl font-bold text-foreground"},te={class:"text-center"},oe={class:"text-2xl font-bold text-foreground"},se={class:"bg-card rounded-lg border border-border p-4"},ne={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},re={class:"md:col-span-2"},de={class:"relative"},ae=["value"],le=["value"],ie={key:0,class:"flex items-center justify-center py-12"},ue={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ce={class:"text-destructive"},me={key:2},ge={key:0,class:"text-center py-12 text-muted-foreground"},be={key:1,class:"space-y-3"},fe=["onClick"],xe={class:"flex items-start justify-between gap-4"},pe={class:"flex-1 min-w-0"},ve={class:"flex items-center gap-3 mb-2"},_e={class:"font-semibold text-foreground"},he={class:"text-sm text-muted-foreground"},ye={class:"space-y-1 text-sm"},we={class:"text-foreground"},ke={key:0,class:"text-muted-foreground"},Re={key:1,class:"text-muted-foreground"},Ce={key:2,class:"text-muted-foreground"},qe={key:3,class:"text-muted-foreground"},je={key:0,class:"text-sm text-muted-foreground mt-2 line-clamp-2"},Se={class:"flex items-center gap-2 flex-shrink-0"},Me={key:0,class:"h-2 w-2 bg-accent rounded-full",title:"–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞"},Fe={key:2,class:"mt-6 flex items-center justify-between"},Ue={class:"text-sm text-muted-foreground"},Ee={class:"flex items-center gap-2"},Pe=["disabled"],Ve={class:"flex items-center gap-1"},De=["onClick"],Te=["disabled"],Be={class:"bg-card rounded-lg border border-border shadow-2xl max-w-4xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col"},Le={class:"flex items-center justify-between p-6 border-b border-border"},ze={class:"text-2xl font-semibold text-foreground"},Ae={class:"flex items-center gap-2 mt-2"},Ne={class:"text-xs text-muted-foreground"},Ge={class:"p-6 space-y-6 overflow-y-auto flex-1"},He={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je={class:"text-foreground mt-1"},Ke={class:"text-foreground mt-1"},Oe={class:"text-foreground mt-1"},Qe={class:"text-foreground mt-1"},We=["value"],Xe={key:0},Ye={class:"text-foreground mt-1 whitespace-pre-wrap"},Ze={key:1},Ie={class:"space-y-1"},$e={class:"space-y-4"},et={key:2},tt={class:"space-y-2"},ot={class:"flex items-center justify-between mb-1"},st={class:"text-sm font-medium text-foreground"},nt={class:"text-xs text-muted-foreground"},rt={key:0,class:"text-xs text-muted-foreground mb-1"},dt={key:1,class:"text-sm text-foreground"},at={class:"p-6 border-t border-border flex justify-end gap-3"};function lt(h,t,q,o,g,j){return d(),r("div",Y,[e("div",Z,[t[19]||(t[19]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"–ó–∞—è–≤–∫–∏"),e("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã")],-1)),o.stats?(d(),r("div",I,[e("div",$,[e("div",ee,a(o.stats.new),1),t[17]||(t[17]=e("div",{class:"text-xs text-muted-foreground"},"–ù–æ–≤—ã–µ",-1))]),e("div",te,[e("div",oe,a(o.stats.in_progress),1),t[18]||(t[18]=e("div",{class:"text-xs text-muted-foreground"},"–í –æ–±—Ä–∞–±–æ—Ç–∫–µ",-1))])])):i("",!0)]),e("div",se,[e("div",ne,[e("div",re,[e("div",de,[t[20]||(t[20]=e("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),f(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>o.filters.search=s),onInput:t[1]||(t[1]=(...s)=>o.handleSearch&&o.handleSearch(...s)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[F,o.filters.search]])])]),e("div",null,[f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.filters.status=s),onChange:t[3]||(t[3]=(...s)=>o.handleFilterChange&&o.handleFilterChange(...s)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...t[21]||(t[21]=[e("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),U('<option value="new">–ù–æ–≤–∞—è</option><option value="in_progress">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option><option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option><option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option><option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>',5)])],544),[[k,o.filters.status]])]),e("div",null,[f(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.filters.assigned_to=s),onChange:t[5]||(t[5]=(...s)=>o.handleFilterChange&&o.handleFilterChange(...s)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[t[22]||(t[22]=e("option",{value:null},"–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",-1)),e("option",{value:o.authUser?.id},"–ú–æ–∏ –∑–∞—è–≤–∫–∏",8,ae),(d(!0),r(x,null,p(o.users,s=>(d(),r("option",{key:s.id,value:s.id},a(s.name),9,le))),128))],544),[[k,o.filters.assigned_to]])])])]),o.loading?(d(),r("div",ie,[...t[23]||(t[23]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin"}),e("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...")],-1)])])):i("",!0),o.error?(d(),r("div",ue,[e("p",ce,a(o.error),1)])):i("",!0),!o.loading&&!o.error?(d(),r("div",me,[o.requests.length===0?(d(),r("div",ge,[...t[24]||(t[24]=[e("p",null,"–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):(d(),r("div",be,[(d(!0),r(x,null,p(o.requests,s=>(d(),r("div",{key:s.id,onClick:y=>o.viewRequest(s),class:R(["bg-card border border-border rounded-lg p-4 hover:shadow-md transition-all cursor-pointer",{"border-accent/50 bg-accent/5":s.status==="new","border-blue-500/50 bg-blue-500/5":s.status==="in_progress","border-green-500/50 bg-green-500/5":s.status==="completed"}])},[e("div",xe,[e("div",pe,[e("div",ve,[e("h3",_e,"#"+a(s.id),1),e("span",{class:R(["px-2 py-1 text-xs rounded font-medium",o.getStatusClass(s.status)])},a(o.getStatusLabel(s.status)),3),e("span",he,a(o.formatDate(s.created_at)),1)]),e("div",ye,[e("p",we,[t[25]||(t[25]=e("span",{class:"font-medium"},"–ö–ª–∏–µ–Ω—Ç:",-1)),_(" "+a(s.name),1)]),s.phone?(d(),r("p",ke,[t[26]||(t[26]=e("span",{class:"font-medium"},"–¢–µ–ª–µ—Ñ–æ–Ω:",-1)),_(" "+a(s.phone),1)])):i("",!0),s.email?(d(),r("p",Re,[t[27]||(t[27]=e("span",{class:"font-medium"},"Email:",-1)),_(" "+a(s.email),1)])):i("",!0),s.product?(d(),r("p",Ce,[t[28]||(t[28]=e("span",{class:"font-medium"},"–ü—Ä–æ–¥—É–∫—Ç:",-1)),_(" "+a(s.product.name),1)])):i("",!0),s.assigned_user?(d(),r("p",qe,[t[29]||(t[29]=e("span",{class:"font-medium"},"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:",-1)),_(" "+a(s.assigned_user.name),1)])):i("",!0)]),s.comment?(d(),r("p",je,a(s.comment),1)):i("",!0)]),e("div",Se,[s.status==="new"?(d(),r("span",Me)):i("",!0)])])],10,fe))),128))])),o.pagination&&o.pagination.last_page>1?(d(),r("div",Fe,[e("div",Ue," –ü–æ–∫–∞–∑–∞–Ω–æ "+a(o.pagination.from)+" - "+a(o.pagination.to)+" –∏–∑ "+a(o.pagination.total),1),e("div",Ee,[e("button",{onClick:t[6]||(t[6]=s=>o.handlePageChange(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,Pe),e("div",Ve,[(d(!0),r(x,null,p(o.getPageNumbers,s=>(d(),r("button",{key:s,onClick:y=>o.handlePageChange(s),class:R(["px-3 py-2 rounded-md text-sm transition-colors",s===o.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},a(s),11,De))),128))]),e("button",{onClick:t[7]||(t[7]=s=>o.handlePageChange(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,Te)])])):i("",!0)])):i("",!0),o.selectedRequest?(d(),r("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 overflow-y-auto",onClick:t[16]||(t[16]=K((...s)=>o.closeRequestModal&&o.closeRequestModal(...s),["self"]))},[e("div",Be,[e("div",Le,[e("div",null,[e("h2",ze,"–ó–∞—è–≤–∫–∞ #"+a(o.selectedRequest.id),1),e("div",Ae,[e("span",{class:R(["px-2 py-1 text-xs rounded font-medium",o.getStatusClass(o.selectedRequest.status)])},a(o.getStatusLabel(o.selectedRequest.status)),3),e("span",Ne," –°–æ–∑–¥–∞–Ω–∞: "+a(o.formatDate(o.selectedRequest.created_at)),1)])]),e("button",{onClick:t[8]||(t[8]=(...s)=>o.closeRequestModal&&o.closeRequestModal(...s)),class:"p-2 hover:bg-muted/10 rounded-lg transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å"},[...t[30]||(t[30]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ge,[e("div",He,[e("div",null,[t[31]||(t[31]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ö–ª–∏–µ–Ω—Ç",-1)),e("p",Je,a(o.selectedRequest.name),1)]),e("div",null,[t[32]||(t[32]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω",-1)),e("p",Ke,a(o.selectedRequest.phone||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",null,[t[33]||(t[33]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Email",-1)),e("p",Oe,a(o.selectedRequest.email||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",null,[t[34]||(t[34]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ü—Ä–æ–¥—É–∫—Ç",-1)),e("p",Qe,a(o.selectedRequest.product?.name||"–ù–µ —É–∫–∞–∑–∞–Ω (–æ–±—â–∞—è –∑–∞—è–≤–∫–∞)"),1)]),e("div",null,[t[36]||(t[36]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",-1)),f(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.editForm.assigned_to=s),onChange:t[10]||(t[10]=(...s)=>o.updateRequest&&o.updateRequest(...s)),class:"w-full mt-1 px-3 py-2 border border-border rounded bg-background text-sm"},[t[35]||(t[35]=e("option",{value:null},"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω",-1)),(d(!0),r(x,null,p(o.users,s=>(d(),r("option",{key:s.id,value:s.id},a(s.name),9,We))),128))],544),[[k,o.editForm.assigned_to]])])]),o.selectedRequest.comment?(d(),r("div",Xe,[t[37]||(t[37]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞",-1)),e("p",Ye,a(o.selectedRequest.comment),1)])):i("",!0),o.selectedRequest.services&&o.selectedRequest.services.length>0?(d(),r("div",Ze,[t[38]||(t[38]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏",-1)),e("div",Ie,[(d(!0),r(x,null,p(o.selectedRequest.services,s=>(d(),r("div",{key:s.id||s,class:"px-3 py-2 bg-muted/50 rounded text-sm"},a(typeof s=="object"?s.name:s),1))),128))])])):i("",!0),e("div",$e,[e("div",null,[t[40]||(t[40]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–°—Ç–∞—Ç—É—Å",-1)),f(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>o.editForm.status=s),onChange:t[12]||(t[12]=(...s)=>o.updateRequest&&o.updateRequest(...s)),class:"w-full px-3 py-2 border border-border rounded bg-background text-sm"},[...t[39]||(t[39]=[U('<option value="new">–ù–æ–≤–∞—è</option><option value="in_progress">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option><option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option><option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option><option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>',5)])],544),[[k,o.editForm.status]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–ó–∞–º–µ—Ç–∫–∏",-1)),f(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>o.editForm.notes=s),onBlur:t[14]||(t[14]=(...s)=>o.updateRequest&&o.updateRequest(...s)),rows:"4",placeholder:"–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –∑–∞—è–≤–∫–µ...",class:"w-full px-3 py-2 border border-border rounded bg-background text-sm resize-none"},null,544),[[F,o.editForm.notes]])])]),o.selectedRequest.history&&o.selectedRequest.history.length>0?(d(),r("div",et,[t[42]||(t[42]=e("label",{class:"text-sm font-medium text-muted-foreground mb-3 block"},"–ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏",-1)),e("div",tt,[(d(!0),r(x,null,p(o.selectedRequest.history,s=>(d(),r("div",{key:s.id,class:"p-3 bg-muted/30 rounded border-l-2 border-border"},[e("div",ot,[e("span",st,a(s.action_name||s.action),1),e("span",nt,a(o.formatDate(s.created_at)),1)]),s.user?(d(),r("div",rt," –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "+a(s.user.name),1)):i("",!0),s.comment?(d(),r("div",dt,a(s.comment),1)):i("",!0)]))),128))])])):i("",!0)]),e("div",at,[e("button",{onClick:t[15]||(t[15]=(...s)=>o.closeRequestModal&&o.closeRequestModal(...s)),class:"px-4 py-2 border border-border rounded hover:bg-accent/10 text-sm"}," –ó–∞–∫—Ä—ã—Ç—å ")])])])):i("",!0)])}const mt=J(X,[["render",lt]]);export{mt as default};
