import{_ as V,e as n,F as _,k as M,b as j,d,h as t,f,t as m,l as D,g as q,i as v,v as k,y as B,D as H,r as c,c as N,o as z,n as L}from"./app-4C-xA3Sw.js";import{a as E,b as A,c as G,d as I}from"./api-DccBIR6h.js";import{S as y}from"./sweetalert2.esm.all-C0u8rGqG.js";const J={name:"MenuTree",props:{items:{type:Array,required:!0}},emits:["edit","delete","refresh"]},K={class:"menu-tree"},O={class:"flex items-center justify-between p-4 border-b border-border hover:bg-muted/5"},Q={class:"flex items-center gap-3 flex-1"},W={class:"flex items-center gap-2 flex-1"},X={class:"text-sm font-medium text-foreground"},Y={class:"text-xs px-2 py-1 rounded bg-muted text-muted-foreground"},Z={key:0,class:"text-xs text-muted-foreground"},$={key:1,class:"text-xs px-2 py-1 rounded bg-red-500/10 text-red-500"},ee={class:"flex items-center gap-2"},te=["onClick"],oe=["onClick"],re={key:0,class:"ml-6 border-l border-border"};function le(i,e,u,r,w,p){const g=j("MenuTree",!0);return d(),n("div",K,[(d(!0),n(_,null,M(u.items,o=>(d(),n("div",{key:o.id,class:"menu-item"},[t("div",O,[t("div",Q,[t("div",W,[t("span",X,m(o.title),1),t("span",Y,m(o.type),1),o.url||o.slug?(d(),n("span",Z,m(o.url||(o.slug?"/"+o.slug:"")),1)):f("",!0),o.is_active?f("",!0):(d(),n("span",$," Неактивен "))])]),t("div",ee,[t("button",{onClick:s=>i.$emit("edit",o),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,te),t("button",{onClick:s=>i.$emit("delete",o),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,oe)])]),o.children&&o.children.length>0?(d(),n("div",re,[D(g,{items:o.children,onEdit:e[0]||(e[0]=s=>i.$emit("edit",s)),onDelete:e[1]||(e[1]=s=>i.$emit("delete",s)),onRefresh:e[2]||(e[2]=s=>i.$emit("refresh"))},null,8,["items"])])):f("",!0)]))),128))])}const se=V(J,[["render",le],["__scopeId","data-v-e89499a2"]]),ne={name:"Menus",components:{MenuTree:se},setup(){const i=c(!1),e=c(!1),u=c(null),r=c([]),w=c([]),p=c("header"),g=c(!1),o=c(!1),s=c({id:null,title:"",slug:"",url:"",type:"header",parent_id:null,order:0,is_active:!0}),U=[{value:"header",label:"Header Меню"},{value:"footer",label:"Footer Меню"},{value:"burger",label:"Burger Меню"}],S=N(()=>w.value.filter(l=>l.type===s.value.type&&l.id!==s.value.id&&(!l.parent_id||l.parent_id===null))),h=async()=>{i.value=!0,u.value=null;try{const l=await E("/menus",{type:p.value});if(!l.ok)throw new Error("Ошибка загрузки меню");const b=await l.json();r.value=b.data||[];const a=await E("/menus");if(a.ok){const x=await a.json();w.value=C(x.data||[])}}catch(l){u.value=l.message||"Ошибка загрузки меню"}finally{i.value=!1}},C=l=>{let b=[];return l.forEach(a=>{b.push(a),a.children&&a.children.length>0&&(b=b.concat(C(a.children)))}),b},F=l=>{s.value={id:l.id,title:l.title,slug:l.slug||"",url:l.url||"",type:l.type,parent_id:l.parent_id,order:l.order,is_active:l.is_active},o.value=!0},R=async l=>{if((await y.fire({title:"Удалить пункт меню?",text:`Вы уверены, что хотите удалить "${l.title}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Да, удалить",cancelButtonText:"Отмена"})).isConfirmed)try{const a=await I(`/menus/${l.id}`);if(!a.ok){const x=await a.json();throw new Error(x.message||"Ошибка удаления")}await y.fire("Удалено!","Пункт меню успешно удален.","success"),await h()}catch(a){await y.fire("Ошибка!",a.message||"Не удалось удалить пункт меню.","error")}},P=async()=>{e.value=!0,u.value=null;try{const l=s.value.id?`/menus/${s.value.id}`:"/menus",a=await(s.value.id?A:G)(l,{title:s.value.title,slug:s.value.slug||null,url:s.value.url||null,type:s.value.type,parent_id:s.value.parent_id||null,order:s.value.order||0,is_active:s.value.is_active});if(!a.ok){const x=await a.json();throw new Error(x.message||"Ошибка сохранения")}await y.fire("Успешно!","Пункт меню успешно сохранен.","success"),T(),await h()}catch(l){u.value=l.message||"Ошибка сохранения",await y.fire("Ошибка!",u.value,"error")}finally{e.value=!1}},T=()=>{g.value=!1,o.value=!1,s.value={id:null,title:"",slug:"",url:"",type:p.value,parent_id:null,order:0,is_active:!0}};return z(async()=>{await h()}),{loading:i,saving:e,error:u,menus:r,selectedType:p,menuTypes:U,showCreateModal:g,showEditModal:o,form:s,availableParents:S,fetchMenus:h,editMenu:F,deleteMenu:R,saveMenu:P,closeModal:T}}},de={class:"menus-page space-y-6"},ae={class:"flex items-center justify-between"},ie={class:"flex gap-2"},ue=["onClick"],ce={key:0,class:"flex items-center justify-center py-12"},be={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},fe={class:"text-destructive"},me={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},ve={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},ge={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm overflow-y-auto p-4"},pe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md my-auto"},xe={class:"p-6"},ye={class:"text-lg font-semibold mb-4"},we=["value"],he={class:"flex items-center gap-2"},ke={class:"flex gap-2 pt-4"},_e=["disabled"];function Me(i,e,u,r,w,p){const g=j("MenuTree");return d(),n("div",de,[t("div",ae,[e[11]||(e[11]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Меню"),t("p",{class:"text-muted-foreground mt-1"},"Управление меню сайта (Header, Footer, Burger)")],-1)),t("button",{onClick:e[0]||(e[0]=o=>r.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...e[10]||(e[10]=[t("span",null,"+",-1),t("span",null,"Создать пункт меню",-1)])])]),t("div",ie,[(d(!0),n(_,null,M(r.menuTypes,o=>(d(),n("button",{key:o.value,onClick:s=>{r.selectedType=o.value,r.fetchMenus()},class:L(["px-4 py-2 rounded-lg transition-colors",r.selectedType===o.value?"bg-accent/20 text-accent border border-accent/40":"bg-card border border-border text-foreground hover:bg-muted/10"])},m(o.label),11,ue))),128))]),r.loading?(d(),n("div",ce,[...e[12]||(e[12]=[t("p",{class:"text-muted-foreground"},"Загрузка меню...",-1)])])):f("",!0),r.error?(d(),n("div",be,[t("p",fe,m(r.error),1)])):f("",!0),!r.loading&&r.menus.length>0?(d(),n("div",me,[D(g,{items:r.menus,onEdit:r.editMenu,onDelete:r.deleteMenu,onRefresh:r.fetchMenus},null,8,["items","onEdit","onDelete","onRefresh"])])):f("",!0),!r.loading&&r.menus.length===0?(d(),n("div",ve,[...e[13]||(e[13]=[t("p",{class:"text-muted-foreground"},"Меню не найдены. Создайте первый пункт меню.",-1)])])):f("",!0),r.showCreateModal||r.showEditModal?(d(),n("div",ge,[t("div",pe,[t("div",xe,[t("h3",ye,m(r.showEditModal?"Редактировать пункт меню":"Создать пункт меню"),1),t("form",{onSubmit:e[9]||(e[9]=q((...o)=>r.saveMenu&&r.saveMenu(...o),["prevent"])),class:"space-y-4"},[t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm font-medium mb-1 block"},"Название",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.title=o),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[k,r.form.title]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium mb-1 block"},"URL или Slug",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.url=o),type:"text",placeholder:"/page или https://example.com",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[k,r.form.url]]),e[16]||(e[16]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Оставьте пустым, если используете slug",-1))]),t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.form.slug=o),type:"text",placeholder:"page-slug",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[k,r.form.slug]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-1 block"},"Тип меню",-1)),v(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.type=o),required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},[...e[18]||(e[18]=[t("option",{value:"header"},"Header",-1),t("option",{value:"footer"},"Footer",-1),t("option",{value:"burger"},"Burger Menu",-1)])],512),[[B,r.form.type]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Родительский пункт",-1)),v(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.parent_id=o),class:"w-full h-10 px-3 border border-border rounded bg-background"},[e[20]||(e[20]=t("option",{value:null},"Нет (корневой элемент)",-1)),(d(!0),n(_,null,M(r.availableParents,o=>(d(),n("option",{key:o.id,value:o.id},m(o.title),9,we))),128))],512),[[B,r.form.parent_id]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.order=o),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[k,r.form.order,void 0,{number:!0}]])]),t("div",he,[v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.form.is_active=o),type:"checkbox",id:"is_active",class:"w-4 h-4"},null,512),[[H,r.form.is_active]]),e[23]||(e[23]=t("label",{for:"is_active",class:"text-sm font-medium cursor-pointer"},"Активен",-1))]),t("div",ke,[t("button",{type:"button",onClick:e[8]||(e[8]=(...o)=>r.closeModal&&r.closeModal(...o)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:r.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},m(r.saving?"Сохранение...":"Сохранить"),9,_e)])],32)])])])):f("",!0)])}const Ee=V(ne,[["render",Me]]);export{Ee as default};
