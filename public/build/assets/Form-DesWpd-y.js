import{_ as B,h as d,z as Y,j as P,c as r,b as t,d as x,p as _,v as V,D as Z,F as k,l as A,t as f,u as E,s as $,a as T,r as U,o as n,i as ee,C as oe,E as te}from"./app-nyV1LXZ4.js";import{a as I,b as se,c as le}from"./api-V9GPpd21.js";import{S as re}from"./sweetalert2.esm.all-C0u8rGqG.js";import ne from"./Media-DSvKuQRa.js";import"./index-CCovHx2z.js";/* empty css                        */const ae={name:"ServiceForm",components:{Media:ne},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(a,{emit:o}){const u=d([]),e=d([]),y=d([]),h=d([]),g=d([]),l=d(!1),m=d(!1),w=d(!1),S=d(!1),b=d([]),i=d([]),M=d([]),p=d([]),F=d(!1),O=d(!1),j=d(null),C=d(null),v=d({name:a.initialData.name||"",slug:a.initialData.slug||"",chapter_id:a.initialData.chapter_id||null,image_id:a.initialData.image_id||null,icon_id:a.initialData.icon_id||null,order:a.initialData.order??0,is_active:a.initialData.is_active!==!1}),D=async()=>{try{const s=await I("/chapters");if(s.ok){const c=await s.json();u.value=c.data||[]}}catch(s){console.error("Error fetching chapters:",s)}},z=async()=>{l.value=!0;try{const s=await I("/products?active=1");if(s.ok){const c=await s.json();e.value=c.data||[]}}catch(s){console.error("Error fetching products:",s)}finally{l.value=!1}},N=async()=>{m.value=!0;try{const s=await I("/options?active=1");if(s.ok){const c=await s.json();y.value=c.data||[]}}catch(s){console.error("Error fetching options:",s)}finally{m.value=!1}},R=async()=>{w.value=!0;try{const s=await I("/option-trees?active=1");if(s.ok){const c=await s.json();h.value=c.data||[]}}catch(s){console.error("Error fetching option trees:",s)}finally{w.value=!1}},q=async()=>{S.value=!0;try{const s=await I("/instances?active=1");if(s.ok){const c=await s.json();g.value=c.data||[]}}catch(s){console.error("Error fetching instances:",s)}finally{S.value=!1}},G=()=>{F.value=!0},L=()=>{O.value=!0},H=s=>{j.value=s,v.value.image_id=s.id,F.value=!1},J=s=>{C.value=s,v.value.icon_id=s.id,O.value=!1},K=()=>{j.value=null,v.value.image_id=null},Q=()=>{C.value=null,v.value.icon_id=null};Y(()=>a.initialData,s=>{v.value={name:s.name||"",slug:s.slug||"",chapter_id:s.chapter_id||null,image_id:s.image_id||null,icon_id:s.icon_id||null,order:s.order??0,is_active:s.is_active!==!1},s.image&&(j.value=s.image),s.icon&&(C.value=s.icon),s.products&&Array.isArray(s.products)&&(b.value=s.products.map(c=>c.id||c)),s.options&&Array.isArray(s.options)&&(i.value=s.options.map(c=>c.id||c)),s.option_trees&&Array.isArray(s.option_trees)&&(M.value=s.option_trees.map(c=>c.id||c)),s.instances&&Array.isArray(s.instances)&&(p.value=s.instances.map(c=>c.id||c))},{deep:!0});const W=()=>{o("submit",{name:v.value.name,slug:v.value.slug||null,chapter_id:v.value.chapter_id||null,image_id:v.value.image_id||null,icon_id:v.value.icon_id||null,order:v.value.order,is_active:v.value.is_active,products:b.value,options:i.value,option_trees:M.value,instances:p.value})},X=()=>{o("cancel")};return P(()=>{D(),z(),N(),R(),q(),a.initialData.image&&(j.value=a.initialData.image),a.initialData.icon&&(C.value=a.initialData.icon),a.initialData.products&&Array.isArray(a.initialData.products)&&(b.value=a.initialData.products.map(s=>s.id||s)),a.initialData.options&&Array.isArray(a.initialData.options)&&(i.value=a.initialData.options.map(s=>s.id||s)),a.initialData.option_trees&&Array.isArray(a.initialData.option_trees)&&(M.value=a.initialData.option_trees.map(s=>s.id||s)),a.initialData.instances&&Array.isArray(a.initialData.instances)&&(p.value=a.initialData.instances.map(s=>s.id||s))}),{chapters:u,products:e,options:y,optionTrees:h,instances:g,loadingProducts:l,loadingOptions:m,loadingOptionTrees:w,loadingInstances:S,selectedProducts:b,selectedOptions:i,selectedOptionTrees:M,selectedInstances:p,localForm:v,showImageMediaModal:F,showIconMediaModal:O,selectedImage:j,selectedIcon:C,openImageModal:G,openIconModal:L,handleImageSelected:H,handleIconSelected:J,removeImage:K,removeIcon:Q,handleSubmit:W,handleCancel:X}}},ie=["value"],de={class:"flex items-center gap-3"},ce={key:0,class:"flex-1"},ue=["src","alt"],me={class:"flex items-center gap-3"},ve={key:0,class:"flex-1"},be=["src","alt"],fe={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},ge={key:0,class:"text-sm text-muted-foreground"},xe={key:1,class:"text-sm text-muted-foreground"},_e={key:2,class:"space-y-2"},ye=["value"],he={class:"text-sm"},pe={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},ke={key:0,class:"text-sm text-muted-foreground"},Ie={key:1,class:"text-sm text-muted-foreground"},we={key:2,class:"space-y-2"},Se=["value"],Me={class:"text-sm"},Fe={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},je={key:0,class:"text-sm text-muted-foreground"},Ce={key:1,class:"text-sm text-muted-foreground"},Ae={key:2,class:"space-y-2"},Ee=["value"],Oe={class:"text-sm"},Ve={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},Te={key:0,class:"text-sm text-muted-foreground"},Be={key:1,class:"text-sm text-muted-foreground"},Pe={key:2,class:"space-y-2"},Ue=["value"],De={class:"text-sm"},ze={class:"flex items-center gap-2"},Ne={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},Re={class:"flex gap-2 pt-4"},qe=["disabled"],Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Le={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},He={class:"flex items-center justify-between p-4 border-b border-border"},Je={class:"flex-1 overflow-auto h-full"},Ke={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Qe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},We={class:"flex items-center justify-between p-4 border-b border-border"},Xe={class:"flex-1 overflow-auto h-full"};function Ye(a,o,u,e,y,h){const g=U("Media");return n(),r(k,null,[t("form",{onSubmit:o[14]||(o[14]=$((...l)=>e.handleSubmit&&e.handleSubmit(...l),["prevent"])),class:"space-y-4"},[t("div",null,[o[17]||(o[17]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),_(t("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>e.localForm.name=l),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название услуги"},null,512),[[V,e.localForm.name]])]),t("div",null,[o[18]||(o[18]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),_(t("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>e.localForm.slug=l),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[V,e.localForm.slug]]),o[19]||(o[19]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[o[21]||(o[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),_(t("select",{"onUpdate:modelValue":o[2]||(o[2]=l=>e.localForm.chapter_id=l),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[o[20]||(o[20]=t("option",{value:null},"Не выбран",-1)),(n(!0),r(k,null,A(e.chapters,l=>(n(),r("option",{key:l.id,value:l.id},f(l.name),9,ie))),128))],512),[[Z,e.localForm.chapter_id]])]),t("div",null,[o[22]||(o[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),t("div",de,[e.selectedImage?(n(),r("div",ce,[t("img",{src:e.selectedImage.url,alt:e.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,ue)])):x("",!0),t("button",{type:"button",onClick:o[3]||(o[3]=(...l)=>e.openImageModal&&e.openImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(e.selectedImage?"Изменить":"Выбрать изображение"),1),e.selectedImage?(n(),r("button",{key:1,type:"button",onClick:o[4]||(o[4]=(...l)=>e.removeImage&&e.removeImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):x("",!0)])]),t("div",null,[o[23]||(o[23]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",me,[e.selectedIcon?(n(),r("div",ve,[t("img",{src:e.selectedIcon.url,alt:e.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,be)])):x("",!0),t("button",{type:"button",onClick:o[5]||(o[5]=(...l)=>e.openIconModal&&e.openIconModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},f(e.selectedIcon?"Изменить":"Выбрать иконку"),1),e.selectedIcon?(n(),r("button",{key:1,type:"button",onClick:o[6]||(o[6]=(...l)=>e.removeIcon&&e.removeIcon(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):x("",!0)])]),t("div",null,[o[24]||(o[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),_(t("input",{"onUpdate:modelValue":o[7]||(o[7]=l=>e.localForm.order=l),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[V,e.localForm.order,void 0,{number:!0}]])]),t("div",null,[o[25]||(o[25]=t("label",{class:"text-sm font-medium mb-1 block"},"Продукты",-1)),t("div",fe,[e.loadingProducts?(n(),r("div",ge," Загрузка продуктов... ")):e.products.length===0?(n(),r("div",xe," Продукты не найдены ")):(n(),r("div",_e,[(n(!0),r(k,null,A(e.products,l=>(n(),r("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[_(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":o[8]||(o[8]=m=>e.selectedProducts=m),class:"w-4 h-4 rounded border-border"},null,8,ye),[[E,e.selectedProducts]]),t("span",he,f(l.name),1)]))),128))]))])]),t("div",null,[o[26]||(o[26]=t("label",{class:"text-sm font-medium mb-1 block"},"Опции",-1)),t("div",pe,[e.loadingOptions?(n(),r("div",ke," Загрузка опций... ")):e.options.length===0?(n(),r("div",Ie," Опции не найдены ")):(n(),r("div",we,[(n(!0),r(k,null,A(e.options,l=>(n(),r("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[_(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":o[9]||(o[9]=m=>e.selectedOptions=m),class:"w-4 h-4 rounded border-border"},null,8,Se),[[E,e.selectedOptions]]),t("span",Me,f(l.name),1)]))),128))]))])]),t("div",null,[o[27]||(o[27]=t("label",{class:"text-sm font-medium mb-1 block"},"Деревья опций",-1)),t("div",Fe,[e.loadingOptionTrees?(n(),r("div",je," Загрузка деревьев опций... ")):e.optionTrees.length===0?(n(),r("div",Ce," Деревья опций не найдены ")):(n(),r("div",Ae,[(n(!0),r(k,null,A(e.optionTrees,l=>(n(),r("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[_(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":o[10]||(o[10]=m=>e.selectedOptionTrees=m),class:"w-4 h-4 rounded border-border"},null,8,Ee),[[E,e.selectedOptionTrees]]),t("span",Oe,f(l.name),1)]))),128))]))])]),t("div",null,[o[28]||(o[28]=t("label",{class:"text-sm font-medium mb-1 block"},"Экземпляры",-1)),t("div",Ve,[e.loadingInstances?(n(),r("div",Te," Загрузка экземпляров... ")):e.instances.length===0?(n(),r("div",Be," Экземпляры не найдены ")):(n(),r("div",Pe,[(n(!0),r(k,null,A(e.instances,l=>(n(),r("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[_(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":o[11]||(o[11]=m=>e.selectedInstances=m),class:"w-4 h-4 rounded border-border"},null,8,Ue),[[E,e.selectedInstances]]),t("span",De,f(l.name),1)]))),128))]))])]),t("div",ze,[_(t("input",{"onUpdate:modelValue":o[12]||(o[12]=l=>e.localForm.is_active=l),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[E,e.localForm.is_active]]),o[29]||(o[29]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активна ",-1))]),u.error?(n(),r("div",Ne,f(u.error),1)):x("",!0),t("div",Re,[t("button",{type:"button",onClick:o[13]||(o[13]=(...l)=>e.handleCancel&&e.handleCancel(...l)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:u.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},f(u.saving?"Сохранение...":"Сохранить"),9,qe)])],32),e.showImageMediaModal?(n(),r("div",Ge,[t("div",Le,[t("div",He,[o[30]||(o[30]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:o[15]||(o[15]=l=>e.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",Je,[T(g,{"selection-mode":!0,"count-file":1,onFileSelected:e.handleImageSelected},null,8,["onFileSelected"])])])])):x("",!0),e.showIconMediaModal?(n(),r("div",Ke,[t("div",Qe,[t("div",We,[o[31]||(o[31]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:o[16]||(o[16]=l=>e.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",Xe,[T(g,{"selection-mode":!0,"count-file":1,onFileSelected:e.handleIconSelected},null,8,["onFileSelected"])])])])):x("",!0)],64)}const Ze=B(ae,[["render",Ye]]),$e={name:"ServiceFormPage",components:{ServiceForm:Ze},setup(){const a=oe(),o=te(),u=d(!1),e=d(!1),y=d(null),h=d(null),g=d({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,image:null,icon:null,order:0,is_active:!0}),l=ee(()=>!!a.params.id),m=async()=>{if(!l.value){u.value=!1;return}u.value=!0,y.value=null;try{const b=await I(`/services/${a.params.id}`);if(!b.ok)throw new Error("Ошибка загрузки услуги");const i=await b.json();i.data&&(g.value={id:i.data.id,name:i.data.name||"",slug:i.data.slug||"",chapter_id:i.data.chapter_id||null,image_id:i.data.image_id||null,icon_id:i.data.icon_id||null,image:i.data.image||null,icon:i.data.icon||null,order:i.data.order??0,is_active:i.data.is_active!==!1,products:i.data.products||[],options:i.data.options||[],option_trees:i.data.option_trees||[],instances:i.data.instances||[]})}catch(b){y.value=b.message||"Ошибка загрузки услуги",console.error("Error fetching service:",b)}finally{u.value=!1}},w=async b=>{e.value=!0,h.value=null;try{const i=l.value?`/services/${a.params.id}`:"/services",p=await(l.value?se:le)(i,b);if(!p.ok){const F=await p.json().catch(()=>({}));throw new Error(F.message||`Ошибка ${l.value?"обновления":"создания"} услуги`)}await re.fire({title:l.value?"Услуга обновлена":"Услуга создана",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),o.push({name:"admin.decisions.services"})}catch(i){h.value=i.message||"Ошибка сохранения услуги"}finally{e.value=!1}},S=()=>{o.push({name:"admin.decisions.services"})};return P(()=>{m()}),{loading:u,saving:e,error:y,formError:h,form:g,isEdit:l,saveService:w,goBack:S}}},eo={class:"service-form-page space-y-6"},oo={class:"flex items-center justify-between"},to={class:"text-3xl font-semibold text-foreground"},so={key:0,class:"flex items-center justify-center py-12"},lo={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ro={class:"text-destructive"},no={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function ao(a,o,u,e,y,h){const g=U("ServiceForm");return n(),r("div",eo,[t("div",oo,[t("div",null,[t("h1",to,f(e.isEdit?"Редактировать услугу":"Создать услугу"),1),o[1]||(o[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление услугой для блока решений",-1))]),t("button",{onClick:o[0]||(o[0]=(...l)=>e.goBack&&e.goBack(...l)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),e.loading?(n(),r("div",so,[...o[2]||(o[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):x("",!0),e.error?(n(),r("div",lo,[t("p",ro,f(e.error),1)])):x("",!0),e.loading?x("",!0):(n(),r("div",no,[T(g,{"initial-data":e.form,saving:e.saving,error:e.formError,onSubmit:e.saveService,onCancel:e.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const fo=B($e,[["render",ao]]);export{fo as default};
