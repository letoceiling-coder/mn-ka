import{_ as M,c,b as o,t as f,d as D,F as j,k as L,p as x,h as i,j as T,J as y,o as v,x as N,s as V}from"./app-BSkE_Ewe.js";const F={name:"HomePageSettings",setup(){const p=i(!0),a=i(!1),u=i(null),r=i(!1),g=i([]),m=i(null),e=i(null),l=i(null),s=async()=>{p.value=!0,u.value=null;try{const t=await y.get("/api/v1/home-page-blocks");t.data&&t.data.data&&(g.value=t.data.data)}catch(t){u.value=t.response?.data?.message||"Ошибка загрузки блоков",console.error("Error fetching blocks:",t)}finally{p.value=!1}},b=(t,d,n)=>{m.value=d,e.value=n,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",t.target)},h=()=>{m.value=null,e.value=null,l.value=null},k=t=>{t.dataTransfer.dropEffect="move"},w=(t,d)=>{e.value!==null&&e.value!==d&&(l.value=d)},I=t=>{e.value!==null&&e.value!==t&&(l.value=t)},C=()=>{},E=async t=>{if(!m.value||e.value===null)return;const d=l.value!==null?l.value:e.value;if(e.value===d){l.value=null;return}const n=[...g.value],[_]=n.splice(e.value,1);n.splice(d,0,_),n.forEach((S,H)=>{S.order=H}),g.value=n,l.value=null,await B()},B=async()=>{a.value=!0,r.value=!1;try{const t=g.value.map((d,n)=>({id:d.id,order:n}));await y.post("/api/v1/home-page-blocks/update-order",{blocks:t}),r.value=!0,setTimeout(()=>{r.value=!1},3e3)}catch(t){u.value=t.response?.data?.message||"Ошибка сохранения порядка",console.error("Error saving order:",t),await s()}finally{a.value=!1}},O=async(t,d)=>{try{await y.put(`/api/v1/home-page-blocks/${t}`,{is_active:d});const n=g.value.find(_=>_.id===t);n&&(n.is_active=d)}catch(n){u.value=n.response?.data?.message||"Ошибка обновления блока",console.error("Error toggling block:",n),await s()}};return T(()=>{s()}),{loading:p,saving:a,error:u,saveSuccess:r,blocks:g,draggedItem:m,draggedIndex:e,dragOverIndex:l,onDragStart:b,onDragEnd:h,onDragOver:k,onItemDragOver:w,onItemDragEnter:I,onItemDragLeave:C,onDrop:E,toggleBlock:O}}},P={class:"home-page-settings space-y-6"},z={key:0,class:"flex items-center justify-center py-12"},J={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},q={class:"text-sm text-red-600"},A={key:2,class:"bg-card rounded-lg border border-border p-6"},G=["onDragstart","onDragover","onDragenter"],K={class:"flex-1"},Q={class:"flex items-center gap-3"},R={class:"font-medium text-foreground"},U={class:"text-xs text-muted-foreground"},W={class:"text-sm text-muted-foreground mt-1"},X={class:"flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-accent/10 text-accent font-semibold"},Y={class:"flex items-center gap-2 cursor-pointer"},Z=["checked","onChange"],$={class:"text-sm text-foreground"},ee={key:0,class:"mt-6 flex items-center justify-center py-4"},re={key:1,class:"mt-6 bg-green-50 border border-green-200 rounded-lg p-4"};function te(p,a,u,r,g,m){return v(),c("div",P,[a[9]||(a[9]=o("div",null,[o("h1",{class:"text-3xl font-semibold text-foreground"},"Главная страница"),o("p",{class:"text-muted-foreground mt-1"},"Управление порядком блоков на главной странице")],-1)),r.loading?(v(),c("div",z,[...a[4]||(a[4]=[o("div",{class:"text-muted-foreground"},"Загрузка...",-1)])])):r.error?(v(),c("div",J,[o("p",q,f(r.error),1)])):(v(),c("div",A,[a[8]||(a[8]=o("div",{class:"mb-6"},[o("p",{class:"text-sm text-muted-foreground"}," Перетащите блоки мышкой, чтобы изменить их порядок на главной странице ")],-1)),o("div",{class:"space-y-3",onDragover:a[2]||(a[2]=x((...e)=>r.onDragOver&&r.onDragOver(...e),["prevent"])),onDrop:a[3]||(a[3]=x((...e)=>r.onDrop&&r.onDrop(...e),["prevent"]))},[(v(!0),c(j,null,L(r.blocks,(e,l)=>(v(),c("div",{key:e.id,class:N(["flex items-center gap-4 p-4 border border-border rounded-lg bg-background transition-all cursor-move",{dragging:r.draggedItem?.id===e.id,"drag-over":r.dragOverIndex===l}]),draggable:!0,onDragstart:s=>r.onDragStart(s,e,l),onDragend:a[0]||(a[0]=(...s)=>r.onDragEnd&&r.onDragEnd(...s)),onDragover:x(s=>r.onItemDragOver(s,l),["prevent"]),onDragenter:x(s=>r.onItemDragEnter(l),["prevent"]),onDragleave:a[1]||(a[1]=(...s)=>r.onItemDragLeave&&r.onItemDragLeave(...s))},[a[5]||(a[5]=V('<div class="flex-shrink-0 text-muted-foreground cursor-grab active:cursor-grabbing" data-v-a9433696><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a9433696><path d="M7 5H13M7 10H13M7 15H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-a9433696></path><circle cx="4" cy="5" r="1" fill="currentColor" data-v-a9433696></circle><circle cx="4" cy="10" r="1" fill="currentColor" data-v-a9433696></circle><circle cx="4" cy="15" r="1" fill="currentColor" data-v-a9433696></circle><circle cx="16" cy="5" r="1" fill="currentColor" data-v-a9433696></circle><circle cx="16" cy="10" r="1" fill="currentColor" data-v-a9433696></circle><circle cx="16" cy="15" r="1" fill="currentColor" data-v-a9433696></circle></svg></div>',1)),o("div",K,[o("div",Q,[o("h3",R,f(e.block_name),1),o("span",U,"("+f(e.block_key)+")",1)]),o("p",W,"Компонент: "+f(e.component_name),1)]),o("div",X,f(e.order),1),o("label",Y,[o("input",{type:"checkbox",checked:e.is_active,onChange:s=>r.toggleBlock(e.id,s.target.checked),class:"w-4 h-4 rounded border-border"},null,40,Z),o("span",$,f(e.is_active?"Активен":"Неактивен"),1)])],42,G))),128))],32),r.saving?(v(),c("div",ee,[...a[6]||(a[6]=[o("div",{class:"text-muted-foreground"},"Сохранение...",-1)])])):D("",!0),r.saveSuccess?(v(),c("div",re,[...a[7]||(a[7]=[o("p",{class:"text-sm text-green-600"},"Порядок блоков успешно сохранен!",-1)])])):D("",!0)]))])}const oe=M(F,[["render",te],["__scopeId","data-v-a9433696"]]);export{oe as default};
