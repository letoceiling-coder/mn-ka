import{_ as F,h as k,i as p,c as n,d as u,a as b,b as r,B as S,p as D,F as N,k as T,r as _,o as s,j as H,e as z,s as A,t as C,w as j,z as Z,D as J,f as M}from"./app-Bij6eeV3.js";import{S as K}from"./SEOHead-NxdzwFEZ.js";import{L as B}from"./LazyImage-CWPSpwB3.js";import{F as W}from"./index-Dzs-8xi1.js";import{C as G}from"./CaseCard-bGRFZbaz.js";import{F as q}from"./FeedbackForm-Du3Y9RcI.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const Q={name:"CaseImageCarousel",components:{FsLightbox:W,LazyImage:B},props:{images:{type:Array,default:()=>[]},caseName:{type:String,default:"Кейс"}},setup(i){const a=k(!1),l=k(1),e=k(0),c=p(()=>i.images.map(h=>h.webp||h.url||"")),v=p(()=>i.images[e.value]||i.images[0]||{});return{lightboxToggler:a,currentSlide:l,currentIndex:e,lightboxSources:c,currentImage:v,openLightbox:h=>{c.value.length>0&&(l.value=h+1,a.value=!a.value)},nextSlide:()=>{e.value<i.images.length-1&&e.value++},previousSlide:()=>{e.value>0&&e.value--},goToSlide:h=>{e.value=h}}}},X={key:0,class:"relative w-full"},Y={class:"relative w-full case-carousel"},$=["disabled"],ee=["disabled"],te={key:0,class:"flex justify-center gap-2 mt-4"},ae=["onClick"];function re(i,a,l,e,c,v){const y=_("FsLightbox"),m=_("LazyImage");return l.images.length>0?(s(),n("div",X,[b(y,{toggler:e.lightboxToggler,sources:e.lightboxSources,slide:e.currentSlide,type:"image"},null,8,["toggler","sources","slide"]),r("div",Y,[r("div",{class:"relative w-full aspect-[100/51] bg-gray-100 rounded-xl overflow-hidden cursor-pointer group",onClick:a[2]||(a[2]=g=>e.openLightbox(e.currentIndex))},[b(m,{src:e.currentImage.webp||e.currentImage.url,alt:`${l.caseName} - изображение ${e.currentIndex+1}`,"image-class":"w-full h-full object-cover","container-class":"relative w-full h-full",eager:!0},null,8,["src","alt"]),l.images.length>1?(s(),n("button",{key:0,onClick:a[0]||(a[0]=D((...g)=>e.previousSlide&&e.previousSlide(...g),["stop"])),class:S(["absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===0}]),disabled:e.currentIndex===0},[...a[3]||(a[3]=[r("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M10 12L6 8L10 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,$)):u("",!0),l.images.length>1?(s(),n("button",{key:1,onClick:a[1]||(a[1]=D((...g)=>e.nextSlide&&e.nextSlide(...g),["stop"])),class:S(["absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-[#688E67] border-2 border-white text-white rounded-full flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity z-10",{"opacity-50 cursor-not-allowed":e.currentIndex===l.images.length-1}]),disabled:e.currentIndex===l.images.length-1},[...a[4]||(a[4]=[r("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M6 4L10 8L6 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],10,ee)):u("",!0)]),l.images.length>1?(s(),n("div",te,[(s(!0),n(N,null,T(l.images,(g,w)=>(s(),n("button",{key:w,onClick:h=>e.goToSlide(w),class:S(["w-2 h-2 rounded-full transition-all",w===e.currentIndex?"bg-[#688E67] w-8":"bg-gray-300 hover:bg-gray-400"])},null,10,ae))),128))])):u("",!0)])])):u("",!0)}const se=F(Q,[["render",re],["__scopeId","data-v-68d43b13"]]),oe={name:"SimilarCases",components:{CaseCard:G},props:{chapterId:{type:Number,default:null},excludeCaseId:{type:Number,default:null},limit:{type:Number,default:2}},setup(i){const a=k([]),l=k(!1),e=async()=>{l.value=!0;try{const c=new URLSearchParams;i.chapterId&&c.append("chapter_id",i.chapterId),i.excludeCaseId&&c.append("offerNot",i.excludeCaseId);const v=await fetch(`/api/public/cases?${c.toString()}`);if(v.ok){const m=(await v.json()).data||[];a.value=m.filter(g=>g.id!==i.excludeCaseId).slice(0,i.limit)}}catch(c){console.error("Error fetching similar cases:",c)}finally{l.value=!1}};return H(()=>{e()}),{similarCases:a,loading:l}}},ne={key:0,class:"w-full px-3 sm:px-4 md:px-5"},le={class:"w-full max-w-[1200px] mx-auto mt-6 md:mt-8"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8"};function ce(i,a,l,e,c,v){const y=_("CaseCard");return e.similarCases.length>0?(s(),n("div",ne,[r("div",le,[a[0]||(a[0]=r("h2",{class:"text-2xl md:text-3xl font-bold text-black mb-6 md:mb-8"}," Похожие кейсы ",-1)),r("div",ie,[(s(!0),n(N,null,T(e.similarCases,m=>(s(),z(y,{key:m.id,"case-item":m},null,8,["case-item"]))),128))])])])):u("",!0)}const de=F(oe,[["render",ce]]),ue={name:"CasePage",components:{SEOHead:K,LazyImage:B,CaseImageCarousel:se,SimilarCases:de,FeedbackForm:q},setup(){const i=J(),a=k(!1),l=k(null),e=k(null),c=p(()=>{if(!e.value||!e.value.images)return console.log("No images in caseItem:",e.value),[];const t=e.value.images.slice(0,2).filter(o=>{const d=o&&(o.url||o.webp);return d||console.warn("Image without URL:",o),d});return console.log("Hero images computed:",{total:e.value.images.length,valid:t.length,images:t}),t}),v=p(()=>{if(!e.value)return null;let t=e.value.description;if(typeof t=="string"&&t.trim().startsWith("{"))try{t=JSON.parse(t)}catch{return t}if(t){if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){if(t.ru)return t.ru;if(t.short)return t.short;if(t.full)return t.full;if(t.detailed){const o=typeof t.detailed=="string"?t.detailed:String(t.detailed);return o.length>200?o.substring(0,200)+"...":o}if(Array.isArray(t)&&t.length>0)return t[0]}}return null}),y=p(()=>{if(!e.value)return null;let t=null;if(e.value.html_content?t=e.value.html_content:e.value.html&&(t=e.value.html),!t)return null;if(typeof t=="string"&&t.trim().startsWith("{"))try{t=JSON.parse(t)}catch{return t.includes("<")?t:null}if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){if(t.content)return t.content;if(t.ru)return t.ru;if(t.lead)return t.lead;if(t.full)return t.full;if(Array.isArray(t)&&t.length>0)return t[0]}return null}),m=t=>{if(!t)return"";try{const o=new Date(t),d=o.getDate(),V=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][o.getMonth()],P=String(o.getHours()).padStart(2,"0"),R=String(o.getMinutes()).padStart(2,"0");return`${d} ${V} ${P}:${R}`}catch{return t}},g=t=>{console.error("Error loading image:",t.target.src),t.target.style.display="none"},w=async()=>{const t=window.location.href,o=e.value?.name||"Кейс";if(navigator.share)try{await navigator.share({title:o,text:v.value||"",url:t})}catch(d){d.name!=="AbortError"&&console.error("Error sharing:",d)}else try{await navigator.clipboard.writeText(t),alert("Ссылка скопирована в буфер обмена")}catch(d){console.error("Failed to copy:",d)}},h=async()=>{a.value=!0,l.value=null;try{const o=`/api/public/cases/${i.params.slug}`,d=await fetch(o,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!d.ok)throw d.status===404?new Error("Кейс не найден"):new Error("Ошибка загрузки кейса");const f=await d.json();if(f.data)e.value=Array.isArray(f.data)?f.data[0]:f.data,console.log("Case loaded:",{name:e.value.name,description:e.value.description,html:e.value.html,hasImages:!!e.value.images,imagesCount:e.value.images?.length,images:e.value.images,hasImage:!!e.value.image,image:e.value.image,chapter:e.value.chapter});else throw new Error("Кейс не найден")}catch(t){console.error("Error fetching case:",t),l.value=t.message||"Ошибка загрузки кейса"}finally{a.value=!1}};Z(()=>i.params.slug,(t,o)=>{t!==o&&(e.value=null,h())}),H(()=>{h()});const x=p(()=>e.value?e.value.seo_title?e.value.seo_title:`${e.value.name} - Lagom | Пример реализованного проекта`:"Кейс - Lagom"),I=p(()=>{if(!e.value)return"Пример успешно реализованного проекта по подбору и оформлению земельного участка.";if(e.value.seo_description)return e.value.seo_description;const t=v.value;return t&&t.length>50?t:`Кейс: ${e.value.name} - успешно реализованный проект по подбору и оформлению земельного участка. Подробная информация о проекте, результатах и особенностях реализации.`}),L=p(()=>e.value?e.value.seo_keywords?e.value.seo_keywords:`${e.value.name}, кейс, проект, пример работ, земельные участки, объект, Lagom`:"кейс, проект, земельные участки"),O=p(()=>{if(!e.value)return"";if(c.value&&c.value.length>0){const t=c.value[0];return t.url||t.webp||""}return e.value.image?.url?e.value.image.url:""}),E=p(()=>e.value?window.location.origin+"/cases/"+(e.value.slug||""):""),U=p(()=>{if(!e.value)return null;const t={"@context":"https://schema.org","@type":"Article",headline:e.value.name,description:I.value,url:E.value,author:{"@type":"Organization",name:"Lagom"}};if((e.value.published||e.value.created_at)&&(t.datePublished=e.value.created_at,t.dateModified=e.value.updated_at||e.value.created_at),e.value.images&&e.value.images.length>0){const d=e.value.images.filter(f=>f.url||f.webp).map(f=>window.location.origin+(f.url||f.webp));d.length>0&&(t.image=d)}else e.value.image?.url&&(t.image=window.location.origin+e.value.image.url);const o={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Главная",item:window.location.origin},{"@type":"ListItem",position:2,name:"Кейсы и объекты",item:window.location.origin+"/cases"},{"@type":"ListItem",position:3,name:e.value.name,item:E.value}]};return[t,o]});return{loading:a,error:l,caseItem:e,heroImages:c,caseDescription:v,caseHtml:y,formatDate:m,handleImageError:g,handleShare:w,caseTitle:x,caseMetaDescription:I,caseKeywords:L,caseImage:O,canonicalUrl:E,caseSchema:U}}},me={class:"case-page min-h-screen bg-white"},ge={class:"w-full px-3 sm:px-4 md:px-5"},he={class:"w-full max-w-[1200px] mx-auto"},ve={key:0,class:"py-12 space-y-8"},fe={key:1,class:"py-12"},pe={class:"p-4 bg-red-50 border border-red-200 rounded-lg"},ye={class:"text-red-600"},xe={key:2},we={class:"hidden md:flex items-center gap-2 text-sm text-gray-600 mt-4"},be={class:"text-black"},_e={class:"mt-6 md:mt-8"},ke={class:"text-2xl md:text-3xl lg:text-4xl font-bold text-black mb-3 md:mb-4"},Ie={key:0,class:"mt-3 text-base md:text-lg text-gray-600"},Ce=["src","alt"],Se={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},Le=["innerHTML"],Ee={key:3,class:"mt-6 md:mt-8 relative"},je={class:"mt-6 md:mt-8 pt-6 border-t border-gray-200"},Me={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Fe={key:0,class:"flex flex-col gap-1"},Ne={class:"text-base text-black font-medium"},Te={key:1,class:"mt-12"},De={key:2,class:"w-full px-3 sm:px-4 md:px-5 mt-12 pb-12"},Ae={class:"w-full max-w-[1200px] mx-auto"};function He(i,a,l,e,c,v){const y=_("SEOHead"),m=_("router-link"),g=_("CaseImageCarousel"),w=_("SimilarCases"),h=_("FeedbackForm");return s(),n("div",me,[e.caseItem?(s(),z(y,{key:0,title:e.caseTitle,description:e.caseMetaDescription,keywords:e.caseKeywords,"og-image":e.caseImage,canonical:e.canonicalUrl,schema:e.caseSchema},null,8,["title","description","keywords","og-image","canonical","schema"])):u("",!0),r("div",ge,[r("div",he,[e.loading&&!e.caseItem?(s(),n("div",ve,[...a[2]||(a[2]=[A('<div class="h-8 bg-gray-200 rounded w-1/3 animate-pulse" data-v-a4e1b253></div><div class="h-64 bg-gray-200 rounded animate-pulse" data-v-a4e1b253></div><div class="space-y-4" data-v-a4e1b253><div class="h-4 bg-gray-200 rounded animate-pulse" data-v-a4e1b253></div><div class="h-4 bg-gray-200 rounded w-5/6 animate-pulse" data-v-a4e1b253></div></div>',3)])])):u("",!0),e.error&&!e.loading?(s(),n("div",fe,[r("div",pe,[r("p",ye,C(e.error),1),b(m,{to:"/cases",class:"mt-4 inline-block text-sm text-[#688E67] hover:underline"},{default:j(()=>[...a[3]||(a[3]=[M(" Вернуться к списку кейсов ",-1)])]),_:1})])])):u("",!0),e.caseItem&&!e.loading?(s(),n("div",xe,[r("nav",we,[b(m,{to:"/",class:"hover:text-black transition-colors"},{default:j(()=>[...a[4]||(a[4]=[M(" Главная ",-1)])]),_:1}),a[6]||(a[6]=r("span",null,"/",-1)),b(m,{to:"/cases",class:"hover:text-black transition-colors"},{default:j(()=>[...a[5]||(a[5]=[M(" Кейсы и объекты ",-1)])]),_:1}),a[7]||(a[7]=r("span",null,"/",-1)),r("span",be,C(e.caseItem.name),1)]),r("div",_e,[r("h1",ke,C(e.caseItem.name),1)]),e.caseDescription?(s(),n("div",Ie,C(e.caseDescription),1)):u("",!0),e.heroImages&&e.heroImages.length>0?(s(),n("div",{key:1,class:S(["grid gap-4 md:gap-6 mt-6 md:mt-8",e.heroImages.length>=2?"grid-cols-1 md:grid-cols-2":"grid-cols-1"])},[(s(!0),n(N,null,T(e.heroImages,(x,I)=>(s(),n("div",{key:x.id||I,class:S(["relative w-full bg-gray-100 rounded-lg overflow-hidden",e.heroImages.length>=2?"aspect-[50/33]":"aspect-[100/51]"])},[x.url||x.webp?(s(),n("img",{key:0,src:x.webp||x.url,alt:`${e.caseItem.name} - изображение ${I+1}`,class:"w-full h-full object-cover",loading:"lazy",decoding:"async",onError:a[0]||(a[0]=(...L)=>e.handleImageError&&e.handleImageError(...L))},null,40,Ce)):(s(),n("div",Se,[...a[8]||(a[8]=[r("span",{class:"text-gray-400 text-sm"},"Изображение не загружено",-1)])]))],2))),128))],2)):u("",!0),e.caseHtml?(s(),n("div",{key:2,class:"mt-6 md:mt-8 prose prose-sm md:prose-base max-w-none prose-headings:text-black prose-p:text-gray-700 prose-a:text-[#688E67]",innerHTML:e.caseHtml},null,8,Le)):u("",!0),e.caseItem.images&&e.caseItem.images.length>0?(s(),n("div",Ee,[b(g,{images:e.caseItem.images,"case-name":e.caseItem.name},null,8,["images","case-name"])])):u("",!0),r("div",je,[r("div",Me,[e.caseItem.published||e.caseItem.created_at?(s(),n("div",Fe,[a[9]||(a[9]=r("span",{class:"text-sm text-gray-600"},"Опубликован",-1)),r("span",Ne,C(e.caseItem.published||e.formatDate(e.caseItem.created_at)),1)])):u("",!0),r("button",{onClick:a[1]||(a[1]=(...x)=>e.handleShare&&e.handleShare(...x)),class:"inline-flex items-center gap-2 px-4 py-2 text-[#688E67] hover:bg-[#688E67]/10 rounded-lg transition-colors font-medium self-start md:self-auto cursor-pointer"},[...a[10]||(a[10]=[A('<span data-v-a4e1b253>Поделиться</span><svg width="29" height="32" viewBox="0 0 29 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-6" data-v-a4e1b253><path d="M23.498 10C25.9833 10 27.998 7.98528 27.998 5.5C27.998 3.01472 25.9833 1 23.498 1C21.0128 1 18.998 3.01472 18.998 5.5C18.998 7.98528 21.0128 10 23.498 10Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a4e1b253></path><path d="M5.5 20.5001C7.98528 20.5001 10 18.4854 10 16.0001C10 13.5148 7.98528 11.5001 5.5 11.5001C3.01472 11.5001 1 13.5148 1 16.0001C1 18.4854 3.01472 20.5001 5.5 20.5001Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a4e1b253></path><path d="M23.498 31C25.9833 31 27.998 28.9853 27.998 26.5C27.998 24.0147 25.9833 22 23.498 22C21.0128 22 18.998 24.0147 18.998 26.5C18.998 28.9853 21.0128 31 23.498 31Z" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a4e1b253></path><path d="M9.24805 18.25L19.748 24.25M19.748 7.75L9.24805 13.75" stroke="#688E67" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a4e1b253></path></svg>',2)])])])])])):u("",!0)])]),e.caseItem&&!e.loading?(s(),n("div",Te,[b(w,{"chapter-id":e.caseItem.chapter_id,"exclude-case-id":e.caseItem.id,limit:2},null,8,["chapter-id","exclude-case-id"])])):u("",!0),e.caseItem&&!e.loading?(s(),n("div",De,[r("div",Ae,[b(h,{title:"Оставьте заявку",description:"Мы бесплатно подберём участок и покажем, как его оформить под ваш проект"})])])):u("",!0)])}const Ze=F(ue,[["render",He],["__scopeId","data-v-a4e1b253"]]);export{Ze as default};
