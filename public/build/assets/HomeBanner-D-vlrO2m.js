import{_ as U,e as a,h as t,f as g,t as k,i as s,v as b,y as V,D as j,g as y,l as B,r as f,o as C,b as D,d as i}from"./app-BmfaJQPd.js";import{a as F,b as N,c as P}from"./api-DccBIR6h.js";import{S as _}from"./sweetalert2.esm.all-C0u8rGqG.js";import R from"./Media-DYQQM8Kp.js";const L={name:"HomeBanner",components:{Media:R},setup(){const v=f(!1),e=f(!1),m=f(null),o=f(!1),x=f(null),n=f({id:null,title:"Баннер на главной",slug:"home-banner",background_image:null,heading_1:"",heading_2:"",description:"",button_text:"",button_type:"url",button_value:"",is_active:!0}),p=async()=>{v.value=!0,m.value=null;try{const d=await F("/banners");if(d.ok){const l=(await d.json()).data?.find(c=>c.slug==="home-banner");l&&(n.value={id:l.id,title:l.title,slug:l.slug,background_image:l.background_image||null,heading_1:l.heading_1||"",heading_2:l.heading_2||"",description:l.description||"",button_text:l.button_text||"",button_type:l.button_type||"url",button_value:l.button_value||"",is_active:l.is_active!==void 0?l.is_active:!0})}}catch(d){m.value=d.message||"Ошибка загрузки баннера"}finally{v.value=!1}},r=()=>{o.value=!0},w=()=>{o.value=!1,x.value&&x.value.click()},h=async d=>{const u=d.target.files?.[0];if(!u)return;const l=new FileReader;l.onload=c=>{n.value.background_image=c.target.result},l.readAsDataURL(u)},M=d=>{if(console.log("handleImageSelected called with file:",d),d&&d.type==="photo"){const u=d.url.replace(/^\//,"");console.log("Setting background_image to:",u),n.value.background_image=u,o.value=!1}else console.warn("File is not a photo:",d)},I=async()=>{e.value=!0,m.value=null;try{const d=n.value.id?`/banners/${n.value.id}`:"/banners",l=await(n.value.id?N:P)(d,{title:n.value.title,slug:n.value.slug,background_image:n.value.background_image,heading_1:n.value.heading_1,heading_2:n.value.heading_2,description:n.value.description,button_text:n.value.button_text,button_type:n.value.button_type,button_value:n.value.button_value,is_active:n.value.is_active});if(!l.ok){const S=await l.json();throw new Error(S.message||"Ошибка сохранения")}const c=await l.json();n.value.id=c.data.id,await _.fire("Успешно!","Баннер успешно сохранен.","success"),await p()}catch(d){m.value=d.message||"Ошибка сохранения баннера",await _.fire("Ошибка!",d.message||"Не удалось сохранить баннер.","error")}finally{e.value=!1}};return C(()=>{p()}),{loading:v,saving:e,error:m,form:n,showMediaModal:o,imageInput:x,selectImage:r,uploadNewImage:w,handleImageSelect:h,handleImageSelected:M,saveBanner:I}}},E={class:"home-banner-page space-y-6"},H={key:0,class:"flex items-center justify-center py-12"},W={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},q={class:"text-destructive"},z={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"space-y-3"},G={key:0,class:"relative"},T=["src"],J={class:"mt-2 flex gap-2"},K={key:1},O={class:"border-t border-border pt-6"},Q={class:"mb-4"},X={class:"mb-4"},Y={key:0},Z={key:1},$={class:"flex items-center gap-2"},ee={class:"flex gap-3 pt-4 border-t border-border"},te=["disabled"],oe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col my-auto"},re={class:"p-4 border-b border-border flex items-center justify-between flex-shrink-0"},le={class:"flex-1 overflow-auto h-full"};function ne(v,e,m,o,x,n){const p=D("Media");return i(),a("div",E,[e[34]||(e[34]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Баннер на главной"),t("p",{class:"text-muted-foreground mt-1"},"Настройка главного баннера сайта")])],-1)),o.loading?(i(),a("div",H,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка баннера...",-1)])])):g("",!0),o.error?(i(),a("div",W,[t("p",q,k(o.error),1)])):g("",!0),o.loading?g("",!0):(i(),a("div",z,[t("form",{onSubmit:e[13]||(e[13]=y((...r)=>o.saveBanner&&o.saveBanner(...r),["prevent"])),class:"p-6 space-y-6"},[t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm font-medium mb-2 block"},"Название баннера",-1)),s(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.title=r),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Баннер на главной"},null,512),[[b,o.form.title]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-2 block"},"Фоновое изображение",-1)),t("div",A,[o.form.background_image?(i(),a("div",G,[t("img",{src:o.form.background_image.startsWith("data:")||o.form.background_image.startsWith("/")?o.form.background_image:`/${o.form.background_image}`,alt:"Preview",class:"w-full h-48 object-cover rounded border border-border"},null,8,T),t("div",J,[t("button",{type:"button",onClick:e[1]||(e[1]=(...r)=>o.selectImage&&o.selectImage(...r)),class:"px-4 py-2 bg-accent/10 text-accent border border-accent/40 rounded hover:bg-accent/20"}," Изменить изображение "),t("button",{type:"button",onClick:e[2]||(e[2]=r=>o.form.background_image=null),class:"px-4 py-2 bg-destructive/10 text-destructive border border-destructive/40 rounded hover:bg-destructive/20"}," Удалить ")])])):(i(),a("div",K,[t("button",{type:"button",onClick:e[3]||(e[3]=(...r)=>o.selectImage&&o.selectImage(...r)),class:"w-full h-32 border-2 border-dashed border-border rounded flex items-center justify-center hover:bg-muted/10 transition-colors"},[...e[18]||(e[18]=[t("span",{class:"text-muted-foreground"},"Выберите изображение",-1)])])]))]),t("input",{ref:"imageInput",type:"file",accept:"image/*",class:"hidden",onChange:e[4]||(e[4]=(...r)=>o.handleImageSelect&&o.handleImageSelect(...r))},null,544),e[20]||(e[20]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Рекомендуемый размер: 1920x700px",-1))]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-2 block"},"Заголовок (первая строка)",-1)),s(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.heading_1=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Подберём и оформим"},null,512),[[b,o.form.heading_1]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-2 block"},"Заголовок (вторая строка)",-1)),s(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.heading_2=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"участок под ваш проект"},null,512),[[b,o.form.heading_2]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),s(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.description=r),rows:"3",class:"w-full px-3 py-2 border border-border rounded bg-background text-foreground",placeholder:`— от ИЖС до складов
и ритейла`},null,512),[[b,o.form.description]]),e[24]||(e[24]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Используйте перенос строки для многострочного текста",-1))]),t("div",O,[e[31]||(e[31]=t("h3",{class:"text-lg font-semibold mb-4"},"Настройки кнопки",-1)),t("div",Q,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-2 block"},"Текст кнопки",-1)),s(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.button_text=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Подробнее"},null,512),[[b,o.form.button_text]])]),t("div",X,[e[27]||(e[27]=t("label",{class:"text-sm font-medium mb-2 block"},"Тип кнопки",-1)),s(t("select",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.button_type=r),class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground"},[...e[26]||(e[26]=[t("option",{value:"url"},"URL (ссылка)",-1),t("option",{value:"method"},"Метод (popup)",-1)])],512),[[V,o.form.button_type]])]),o.form.button_type==="url"?(i(),a("div",Y,[e[28]||(e[28]=t("label",{class:"text-sm font-medium mb-2 block"},"URL",-1)),s(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.button_value=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"/page или https://example.com"},null,512),[[b,o.form.button_value]])])):g("",!0),o.form.button_type==="method"?(i(),a("div",Z,[e[29]||(e[29]=t("label",{class:"text-sm font-medium mb-2 block"},"ID метода",-1)),s(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.button_value=r),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background text-foreground",placeholder:"Методы будут добавлены позже",disabled:""},null,512),[[b,o.form.button_value]]),e[30]||(e[30]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Выбор методов будет доступен после создания функционала методов",-1))])):g("",!0)]),t("div",$,[s(t("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.is_active=r),type:"checkbox",id:"is_active",class:"w-4 h-4"},null,512),[[j,o.form.is_active]]),e[32]||(e[32]=t("label",{for:"is_active",class:"text-sm font-medium"},"Активен",-1))]),t("div",ee,[t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},k(o.saving?"Сохранение...":"Сохранить"),9,te)])],32)])),o.showMediaModal?(i(),a("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm overflow-y-auto p-4",onClick:e[15]||(e[15]=y(r=>o.showMediaModal=!1,["self"]))},[t("div",oe,[t("div",re,[e[33]||(e[33]=t("h3",{class:"text-lg font-semibold"},"Выберите изображение",-1)),t("button",{onClick:e[14]||(e[14]=r=>o.showMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",le,[B(p,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):g("",!0)])}const ue=U(L,[["render",ne]]);export{ue as default};
