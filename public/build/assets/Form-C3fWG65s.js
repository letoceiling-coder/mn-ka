import{_ as S,h as _,j as M,c as u,d as y,b as t,F as V,k as U,l as q,v as x,a as j,r as E,o as c,t as k,q as B,i as O,C as F,E as N,D as T,s as P}from"./app-BbVWLAW1.js";import{a as R,b as G,c as L}from"./api-V9GPpd21.js";import{S as z}from"./sweetalert2.esm.all-C0u8rGqG.js";import W from"./Media-IJgwZJhN.js";import"./index-D7BMszVs.js";/* empty css                        */const A={name:"QuizQuestionConfig",components:{Media:W},props:{question:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["update"],setup(i,{emit:e}){const l=_(!1),o=_(null),f=_({}),m=()=>{i.question.question_data?.selects&&i.question.question_data.selects.forEach((n,b)=>{n.src&&(f.value[b]={url:n.src.startsWith("/")?n.src:`/${n.src}`,original_name:n.title||"Изображение"})})},v=()=>{e("update",i.question.question_data)},s=n=>{o.value=n,l.value=!0},r=()=>{l.value=!1,o.value=null},a=n=>{if(n){const b=o.value;b!==null&&i.question.question_data?.selects&&(f.value[b]=n,i.question.question_data.selects[b].src=n.url,v())}r()},h=n=>{f.value[n]&&delete f.value[n],i.question.question_data?.selects?.[n]&&(i.question.question_data.selects[n].src=""),v()},w=(n,b)=>{n.target.style.display="none"},Q=()=>{i.question.question_data||(i.question.question_data={}),i.question.question_data.selects||(i.question.question_data.selects=[]);const n=i.question.question_data.selects.length;i.question.question_data.selects.push({id:n+1,name:"",src:"",title:"",child:null}),v()},C=n=>{if(i.question.question_data?.selects){i.question.question_data.selects.splice(n,1),delete f.value[n];const b={};Object.keys(f.value).forEach(p=>{const g=parseInt(p);g<n?b[g]=f.value[g]:g>n&&(b[g-1]=f.value[g])}),f.value=b,v()}},D=()=>{i.question.question_data||(i.question.question_data={}),i.question.question_data.selects||(i.question.question_data.selects=[]),i.question.question_data.selects.push({id:i.question.question_data.selects.length+1,name:""}),v()},d=n=>{i.question.question_data?.selects&&(i.question.question_data.selects.splice(n,1),v())};return i.question.question_data||(i.question.question_type==="images-collect"||i.question.question_type==="selects"?i.question.question_data={selects:[]}:i.question.question_type==="inputs"?i.question.question_data={label:"",placeholder:"",child:null}:i.question.question_type==="forms"?i.question.question_data={form:{},child:null}:i.question.question_data={}),M(()=>{m()}),{showMediaModal:l,currentImageIndex:o,selectedImages:f,updateQuestionData:v,openImageModal:s,closeMediaModal:r,handleImageSelected:a,removeImage:h,handleImageError:w,addImageSelect:Q,removeImageSelect:C,addSelectOption:D,removeSelectOption:d}}},H={class:"quiz-question-config space-y-4"},J={key:0,class:"space-y-4"},K={class:"flex items-center justify-between"},X={key:0,class:"space-y-3"},Y={class:"flex items-center justify-between"},Z={class:"text-sm font-medium"},$=["onClick"],ee={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},te={class:"flex items-center gap-3"},oe={key:0,class:"flex-shrink-0"},se=["src","alt","onError"],ne=["onClick"],ie=["onClick"],de=["onUpdate:modelValue"],le=["onUpdate:modelValue"],ae={key:1,class:"text-sm text-muted-foreground"},re={key:1,class:"space-y-4"},ue={class:"flex items-center justify-between"},ce={key:0,class:"space-y-2"},be=["onUpdate:modelValue"],me=["onClick"],fe={key:1,class:"text-sm text-muted-foreground"},ve={key:2,class:"space-y-3"},ge={key:3,class:"space-y-3"},qe={key:4,class:"text-sm text-muted-foreground"},xe={key:5,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},_e={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ye={class:"flex items-center justify-between p-4 border-b border-border"},pe={class:"flex-1 overflow-auto h-full"};function ke(i,e,l,o,f,m){const v=E("Media");return c(),u("div",H,[l.question.question_type==="images-collect"?(c(),u("div",J,[t("div",K,[e[16]||(e[16]=t("label",{class:"text-sm font-medium"},"Изображения для выбора",-1)),t("button",{onClick:e[0]||(e[0]=(...s)=>o.addImageSelect&&o.addImageSelect(...s)),type:"button",class:"px-3 py-1 text-xs bg-accent/10 text-accent border border-accent/40 rounded hover:bg-accent/20"}," + Добавить изображение ")]),l.question.question_data?.selects&&l.question.question_data.selects.length>0?(c(),u("div",X,[(c(!0),u(V,null,U(l.question.question_data.selects,(s,r)=>(c(),u("div",{key:r,class:"border border-border rounded-lg p-3 space-y-3"},[t("div",Y,[t("span",Z,"Изображение "+k(r+1),1),t("button",{onClick:a=>o.removeImageSelect(r),type:"button",class:"px-2 py-1 text-xs bg-destructive/10 text-destructive rounded hover:bg-destructive/20"}," Удалить ",8,$)]),t("div",ee,[t("div",null,[e[17]||(e[17]=t("label",{class:"text-xs font-medium mb-1 block"},"Изображение",-1)),t("div",te,[o.selectedImages[r]?(c(),u("div",oe,[t("img",{src:o.selectedImages[r]?.url||s.src,alt:o.selectedImages[r]?.original_name||"Изображение",class:"w-20 h-20 object-cover rounded border border-border",onError:a=>o.handleImageError(a,r)},null,40,se)])):y("",!0),t("button",{type:"button",onClick:a=>o.openImageModal(r),class:"px-3 py-1.5 text-xs border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"},k(o.selectedImages[r]||s.src?"Изменить":"Выбрать изображение"),9,ne),o.selectedImages[r]||s.src?(c(),u("button",{key:1,type:"button",onClick:a=>o.removeImage(r),class:"px-3 py-1.5 text-xs border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors"}," Удалить ",8,ie)):y("",!0)])]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-xs font-medium mb-1 block"},"Заголовок",-1)),q(t("input",{"onUpdate:modelValue":a=>s.title=a,type:"text",class:"w-full h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Название опции",onInput:e[1]||(e[1]=(...a)=>o.updateQuestionData&&o.updateQuestionData(...a))},null,40,de),[[x,s.title]])])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-xs font-medium mb-1 block"},"ID следующего вопроса",-1)),q(t("input",{"onUpdate:modelValue":a=>s.child=a,type:"number",class:"w-32 h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Оставьте пустым для следующего",onInput:e[2]||(e[2]=(...a)=>o.updateQuestionData&&o.updateQuestionData(...a))},null,40,le),[[x,s.child,void 0,{number:!0}]])])]))),128))])):(c(),u("p",ae,"Добавьте изображения для выбора"))])):l.question.question_type==="selects"?(c(),u("div",re,[t("div",ue,[e[20]||(e[20]=t("label",{class:"text-sm font-medium"},"Варианты выбора",-1)),t("button",{onClick:e[3]||(e[3]=(...s)=>o.addSelectOption&&o.addSelectOption(...s)),type:"button",class:"px-3 py-1 text-xs bg-accent/10 text-accent border border-accent/40 rounded hover:bg-accent/20"}," + Добавить вариант ")]),l.question.question_data?.selects&&l.question.question_data.selects.length>0?(c(),u("div",ce,[(c(!0),u(V,null,U(l.question.question_data.selects,(s,r)=>(c(),u("div",{key:r,class:"flex items-center gap-2"},[q(t("input",{"onUpdate:modelValue":a=>s.name=a,type:"text",class:"flex-1 h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Название варианта",onInput:e[4]||(e[4]=(...a)=>o.updateQuestionData&&o.updateQuestionData(...a))},null,40,be),[[x,s.name]]),t("button",{onClick:a=>o.removeSelectOption(r),type:"button",class:"px-2 py-1 text-xs bg-destructive/10 text-destructive rounded hover:bg-destructive/20"}," Удалить ",8,me)]))),128))])):(c(),u("p",fe,"Добавьте варианты выбора"))])):l.question.question_type==="inputs"?(c(),u("div",ve,[t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Метка поля",-1)),q(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.question.question_data.label=s),type:"text",class:"w-full h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Площадь участка",onInput:e[6]||(e[6]=(...s)=>o.updateQuestionData&&o.updateQuestionData(...s))},null,544),[[x,l.question.question_data.label]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Placeholder",-1)),q(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.question.question_data.placeholder=s),type:"text",class:"w-full h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Введите площадь вашего участка",onInput:e[8]||(e[8]=(...s)=>o.updateQuestionData&&o.updateQuestionData(...s))},null,544),[[x,l.question.question_data.placeholder]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium mb-1 block"},"ID следующего вопроса",-1)),q(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.question.question_data.child=s),type:"number",class:"w-32 h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Оставьте пустым для следующего",onInput:e[10]||(e[10]=(...s)=>o.updateQuestionData&&o.updateQuestionData(...s))},null,544),[[x,l.question.question_data.child,void 0,{number:!0}]])])])):l.question.question_type==="forms"?(c(),u("div",ge,[t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Текст перед формой",-1)),q(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.question.question_text=s),rows:"2",class:"w-full px-2 py-1 text-sm border border-border rounded bg-background",placeholder:"Готово! Мы рассчитаем для вас оптимальный формат проекта...",onInput:e[12]||(e[12]=(...s)=>o.updateQuestionData&&o.updateQuestionData(...s))},null,544),[[x,l.question.question_text]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-1 block"},"ID следующего вопроса",-1)),q(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.question.question_data.child=s),type:"number",class:"w-32 h-9 px-2 text-sm border border-border rounded bg-background",placeholder:"Оставьте пустым для следующего",onInput:e[14]||(e[14]=(...s)=>o.updateQuestionData&&o.updateQuestionData(...s))},null,544),[[x,l.question.question_data.child,void 0,{number:!0}]])])])):l.question.question_type==="thank"?(c(),u("div",qe,[...e[26]||(e[26]=[t("p",null,"Страница благодарности не требует дополнительных настроек.",-1)])])):y("",!0),o.showMediaModal?(c(),u("div",xe,[t("div",_e,[t("div",ye,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[15]||(e[15]=(...s)=>o.closeMediaModal&&o.closeMediaModal(...s)),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",pe,[j(v,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):y("",!0)])}const he=S(A,[["render",ke]]),we={name:"QuizForm",components:{QuizQuestionConfig:he},setup(){const i=F(),e=N(),l=_(!1),o=_(!1),f=_(null),m=_({id:null,title:"",description:"",order:0,is_active:!0,questions:[]}),v=O(()=>!!i.params.id),s=async()=>{if(!v.value){l.value=!1;return}l.value=!0,f.value=null;try{const d=await R(`/quizzes/${i.params.id}`);if(!d.ok)throw new Error("Ошибка загрузки квиза");const n=await d.json();n.data&&(m.value={id:n.data.id,title:n.data.title||"",description:n.data.description||"",order:n.data.order??0,is_active:n.data.is_active!==!1,questions:(n.data.questions||[]).map(b=>({order:b.order||0,question_type:b.question_type,question_text:b.question_text||"",question_data:b.question_data||{},is_active:b.is_active!==!1}))})}catch(d){f.value=d.message||"Ошибка загрузки квиза",console.error("Error fetching quiz:",d)}finally{l.value=!1}},r=()=>{m.value.questions.push({order:m.value.questions.length,question_type:"images-collect",question_text:"",question_data:{},is_active:!0})},a=d=>{m.value.questions.splice(d,1),m.value.questions.forEach((n,b)=>{n.order=b})},h=(d,n)=>{const b=n==="up"?d-1:d+1;if(b<0||b>=m.value.questions.length)return;const[p]=m.value.questions.splice(d,1);m.value.questions.splice(b,0,p),m.value.questions.forEach((g,I)=>{g.order=I})},w=(d,n)=>{d.question_type==="images-collect"?d.question_data={selects:[]}:d.question_type==="selects"?d.question_data={selects:[]}:d.question_type==="inputs"?d.question_data={label:"",placeholder:"",child:null}:d.question_type==="forms"?d.question_data={form:{name:"",email:"",phone:"",check:!1},child:null}:d.question_type==="thank"&&(d.question_data={})},Q=(d,n)=>{m.value.questions[d]&&(m.value.questions[d].question_data=n)},C=async()=>{if(!m.value.title){await z.fire({title:"Ошибка",text:"Пожалуйста, укажите название квиза",icon:"error",confirmButtonText:"ОК"});return}o.value=!0,f.value=null;try{const d={title:m.value.title,description:m.value.description||null,order:m.value.order||0,is_active:m.value.is_active,questions:m.value.questions.map((g,I)=>({order:g.order!==void 0?g.order:I,question_type:g.question_type,question_text:g.question_text||null,question_data:g.question_data||{},is_active:g.is_active!==!1}))},n=v.value?`/quizzes/${i.params.id}`:"/quizzes",p=await(v.value?G:L)(n,d);if(!p.ok){const g=await p.json().catch(()=>({}));throw new Error(g.message||`Ошибка ${v.value?"обновления":"создания"} квиза`)}await z.fire({title:v.value?"Квиз обновлен":"Квиз создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.quizzes.index"})}catch(d){f.value=d.message||"Ошибка сохранения квиза",await z.fire({title:"Ошибка",text:d.message||"Ошибка сохранения квиза",icon:"error",confirmButtonText:"ОК"})}finally{o.value=!1}},D=()=>{e.push({name:"admin.quizzes.index"})};return M(()=>{s()}),{loading:l,saving:o,error:f,form:m,isEdit:v,addQuestion:r,removeQuestion:a,moveQuestion:h,onQuestionTypeChange:w,updateQuestionData:Q,saveQuiz:C,goBack:D}}},Qe={class:"quiz-form-page space-y-6"},Ce={class:"flex items-center justify-between"},De={class:"text-3xl font-semibold text-foreground"},Ie={key:0,class:"flex items-center justify-center py-12"},ze={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Ve={class:"text-destructive"},Ue={key:2,class:"space-y-6"},Se={class:"bg-card rounded-lg border border-border p-6 space-y-4"},Me={class:"flex items-center gap-6"},je={class:"flex items-center gap-2"},Ee={class:"bg-card rounded-lg border border-border p-6 space-y-4"},Be={class:"flex items-center justify-between"},Oe={key:0,class:"space-y-4"},Fe={class:"flex items-center justify-between"},Ne={class:"font-medium text-foreground"},Te={class:"flex items-center gap-2"},Pe=["onClick","disabled"],Re=["onClick","disabled"],Ge=["onClick"],Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},We=["onUpdate:modelValue","onChange"],Ae=["onUpdate:modelValue"],He={key:1,class:"text-center py-8 text-muted-foreground"},Je={class:"flex justify-end gap-3 pt-4"},Ke=["disabled"];function Xe(i,e,l,o,f,m){const v=E("QuizQuestionConfig");return c(),u("div",Qe,[t("div",Ce,[t("div",null,[t("h1",De,k(o.isEdit?"Редактировать квиз":"Создать квиз"),1),e[8]||(e[8]=t("p",{class:"text-muted-foreground mt-1"},"Управление квизом",-1))]),t("button",{onClick:e[0]||(e[0]=(...s)=>o.goBack&&o.goBack(...s)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(c(),u("div",Ie,[...e[9]||(e[9]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):y("",!0),o.error?(c(),u("div",ze,[t("p",Ve,k(o.error),1)])):y("",!0),o.loading?y("",!0):(c(),u("div",Ue,[t("div",Se,[e[14]||(e[14]=t("h2",{class:"text-xl font-semibold text-foreground"},"Основная информация",-1)),t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm font-medium mb-1 block"},"Название квиза *",-1)),q(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.title=s),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название квиза"},null,512),[[x,o.form.title]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium mb-1 block"},"Описание",-1)),q(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.description=s),rows:"3",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите описание квиза"},null,512),[[x,o.form.description]])]),t("div",Me,[t("div",je,[q(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.is_active=s),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[B,o.form.is_active]]),e[12]||(e[12]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),q(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.order=s),type:"number",min:"0",class:"w-24 h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[x,o.form.order,void 0,{number:!0}]])])])]),t("div",Ee,[t("div",Be,[e[15]||(e[15]=t("h2",{class:"text-xl font-semibold text-foreground"},"Вопросы квиза",-1)),t("button",{onClick:e[5]||(e[5]=(...s)=>o.addQuestion&&o.addQuestion(...s)),type:"button",class:"px-4 py-2 text-sm bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors"}," + Добавить вопрос ")]),o.form.questions&&o.form.questions.length>0?(c(),u("div",Oe,[(c(!0),u(V,null,U(o.form.questions,(s,r)=>(c(),u("div",{key:r,class:"border border-border rounded-lg p-4 space-y-4"},[t("div",Fe,[t("h3",Ne,"Вопрос "+k(r+1),1),t("div",Te,[t("button",{onClick:a=>o.moveQuestion(r,"up"),disabled:r===0,type:"button",class:"px-2 py-1 text-sm border border-border rounded hover:bg-muted/10 disabled:opacity-50",title:"Переместить вверх"}," ↑ ",8,Pe),t("button",{onClick:a=>o.moveQuestion(r,"down"),disabled:r===o.form.questions.length-1,type:"button",class:"px-2 py-1 text-sm border border-border rounded hover:bg-muted/10 disabled:opacity-50",title:"Переместить вниз"}," ↓ ",8,Re),t("button",{onClick:a=>o.removeQuestion(r),type:"button",class:"px-2 py-1 text-sm bg-destructive/10 text-destructive rounded hover:bg-destructive/20",title:"Удалить вопрос"}," Удалить ",8,Ge)])]),t("div",Le,[t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm font-medium mb-1 block"},"Тип вопроса *",-1)),q(t("select",{"onUpdate:modelValue":a=>s.question_type=a,class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",onChange:a=>o.onQuestionTypeChange(s,r)},[...e[16]||(e[16]=[P('<option value="images-collect">Выбор из изображений</option><option value="selects">Выбор из списка</option><option value="inputs">Ввод текста</option><option value="forms">Форма контактов</option><option value="thank">Страница благодарности</option>',5)])],40,We),[[T,s.question_type]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-sm font-medium mb-1 block"},"Текст вопроса",-1)),q(t("input",{"onUpdate:modelValue":a=>s.question_text=a,type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите текст вопроса"},null,8,Ae),[[x,s.question_text]])])]),j(v,{question:s,index:r,onUpdate:a=>o.updateQuestionData(r,a)},null,8,["question","index","onUpdate"])]))),128))])):(c(),u("div",He,[...e[19]||(e[19]=[t("p",null,"Вопросы не добавлены. Добавьте первый вопрос.",-1)])]))]),t("div",Je,[t("button",{onClick:e[6]||(e[6]=(...s)=>o.goBack&&o.goBack(...s)),type:"button",class:"px-6 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Отмена "),t("button",{onClick:e[7]||(e[7]=(...s)=>o.saveQuiz&&o.saveQuiz(...s)),disabled:o.saving,type:"button",class:"px-6 py-2 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},k(o.saving?"Сохранение...":"Сохранить квиз"),9,Ke)])]))])}const st=S(we,[["render",Xe]]);export{st as default};
