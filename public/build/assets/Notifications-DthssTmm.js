import{_ as q,e as a,h as t,f as u,i as j,v as J,y as A,x as P,t as l,F as y,k as S,g as G,n as k,r as m,o as H,d as i}from"./app-DMjuRBkz.js";import{S as T}from"./sweetalert2.esm.all-C0u8rGqG.js";const K={name:"Notifications",setup(){const _=m(!1),o=m(null),w=m([]),e=m(null),b=m({search:"",read:null,type:""}),v=m(1),n=m(20),f=m(null),x=m(null),N=m(!1),h=async(s=1)=>{_.value=!0,o.value=null;try{const r=new URLSearchParams;r.append("page",s),r.append("per_page",n.value),b.value.search&&r.append("search",b.value.search),b.value.read!==null&&r.append("read",b.value.read?"1":"0"),b.value.type&&r.append("type",b.value.type);const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};c&&(g.Authorization=`Bearer ${c}`);const d=await fetch(`/api/notifications/all?${r.toString()}`,{method:"GET",headers:g});if(!d.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π");const p=await d.json();w.value=p.data||[],e.value={current_page:p.current_page||1,last_page:p.last_page||1,per_page:p.per_page||n.value,total:p.total||0,from:p.from||0,to:p.to||0},v.value=p.current_page||1}catch(r){o.value=r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"}finally{_.value=!1}},B=()=>{f.value&&clearTimeout(f.value),f.value=setTimeout(()=>{v.value=1,h(1)},500)},M=()=>{v.value=1,h(1)},E=s=>{h(s)},C=async s=>{try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`),(await fetch(`/api/notifications/${s}/read`,{method:"POST",headers:c})).ok&&await h(v.value)}catch(r){console.error("Error marking notification as read:",r)}},D=async s=>{if((await T.fire({title:"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",text:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const c=localStorage.getItem("token"),g={Accept:"application/json","Content-Type":"application/json"};if(c&&(g.Authorization=`Bearer ${c}`),!(await fetch(`/api/notifications/${s}`,{method:"DELETE",headers:g})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");await T.fire({title:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await h(v.value)}catch(c){T.fire({title:"–û—à–∏–±–∫–∞",text:c.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}},F=s=>s?new Date(s).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",z=s=>({info:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",success:"–£—Å–ø–µ—Ö",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",error:"–û—à–∏–±–∫–∞"})[s]||s,L=s=>({info:"bg-blue-500/10 text-blue-500",success:"bg-green-500/10 text-green-500",warning:"bg-yellow-500/10 text-yellow-500",error:"bg-red-500/10 text-red-500"})[s]||"bg-muted text-muted-foreground",V=async s=>{N.value=!0;try{const r=localStorage.getItem("token"),c={Accept:"application/json","Content-Type":"application/json"};r&&(c.Authorization=`Bearer ${r}`);const g=await fetch(`/api/notifications/${s.id}`,{method:"GET",headers:c});if(!g.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");const d=await g.json();x.value=d.data,s.read||await C(s.id)}catch(r){console.error("Error loading notification:",r),x.value=s}finally{N.value=!1}},R=()=>{x.value=null},I=async s=>{await C(s),x.value&&(x.value.read=!0,x.value.read_at=new Date().toISOString())},O=s=>s==null?"–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞":typeof s=="object"?s.name?s.name:s.title?s.title:Array.isArray(s)?s.map(r=>typeof r=="object"?r.name||r.title||JSON.stringify(r):r).join(", "):JSON.stringify(s,null,2):String(s),U=(s,r)=>{const c=[];if(r<=5)for(let d=1;d<=r;d++)c.push(d);else if(s<=3)for(let d=1;d<=5;d++)c.push(d);else if(s>=r-2)for(let d=r-4;d<=r;d++)c.push(d);else for(let d=s-2;d<=s+2;d++)c.push(d);return c};return H(()=>{h(1)}),{loading:_,error:o,notifications:w,pagination:e,filters:b,handleSearch:B,handleFilterChange:M,handlePageChange:E,markAsRead:C,deleteNotification:D,formatDate:F,getTypeLabel:z,getTypeClass:L,getPageNumbers:U,selectedNotification:x,loadingNotification:N,viewNotification:V,closeNotificationModal:R,markAsReadFromModal:I,formatAnswer:O}}},Q={class:"notifications-page space-y-6"},W={class:"bg-card rounded-lg border border-border p-4"},X={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Y={class:"md:col-span-2"},Z={class:"relative"},$={key:0,class:"flex items-center justify-center py-12"},ee={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},te={class:"text-destructive"},oe={key:2,class:"space-y-3"},ne={class:"flex items-start justify-between gap-4"},se={class:"flex-1 min-w-0"},re={class:"flex items-center gap-2 mb-2"},ae={class:"font-semibold text-foreground"},ie={key:0,class:"h-2 w-2 bg-accent rounded-full flex-shrink-0",title:"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"},le={class:"text-sm text-muted-foreground mb-2"},de={class:"flex items-center gap-4 text-xs text-muted-foreground"},ce={key:0},ue={class:"flex items-center gap-2 flex-shrink-0"},fe=["onClick"],ge=["onClick"],me=["onClick"],be={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},pe={key:4,class:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-border gap-4"},xe={class:"text-sm text-muted-foreground"},ve={class:"flex gap-2 items-center"},he=["disabled"],_e={class:"flex gap-1"},ye=["onClick"],ke=["disabled"],we={class:"bg-card rounded-lg border border-border shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},Ne={class:"flex items-center justify-between p-6 border-b border-border"},Ce={class:"text-2xl font-semibold text-foreground"},je={class:"flex items-center gap-2 mt-2"},Se={class:"text-xs text-muted-foreground"},Te={class:"flex-1 overflow-y-auto p-6"},Ae={class:"space-y-6"},Be={class:"text-foreground whitespace-pre-wrap"},Me={key:0,class:"space-y-4"},Ee={key:0,class:"border-t border-border pt-4"},De={class:"space-y-3"},Fe={class:"ml-2 text-foreground"},ze={key:0,class:"mt-4"},Le={class:"bg-muted/50 rounded-lg p-4 space-y-2"},Ve={class:"ml-2 text-foreground"},Re={class:"ml-2 text-foreground"},Ie={class:"ml-2 text-foreground"},Oe={key:1,class:"mt-4"},Ue={class:"space-y-3"},qe={class:"text-sm font-medium text-foreground mb-1"},Je={class:"text-sm text-muted-foreground"},Pe={class:"ml-2"},Ge={key:2,class:"mt-4"},He={class:"ml-2 text-foreground"},Ke={key:1,class:"border-t border-border pt-4"},Qe={class:"bg-muted/50 rounded-lg p-4 text-xs overflow-auto"},We={class:"flex items-center justify-between p-6 border-t border-border bg-muted/30"},Xe={class:"text-sm text-muted-foreground"},Ye={key:0},Ze={key:1},$e={class:"flex gap-2"};function et(_,o,w,e,b,v){return i(),a(y,null,[t("div",Q,[o[17]||(o[17]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),t("p",{class:"text-muted-foreground mt-1"},"–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")])],-1)),t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[o[12]||(o[12]=t("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),j(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>e.filters.search=n),onInput:o[1]||(o[1]=(...n)=>e.handleSearch&&e.handleSearch(...n)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[J,e.filters.search]])])]),t("div",null,[j(t("select",{"onUpdate:modelValue":o[2]||(o[2]=n=>e.filters.read=n),onChange:o[3]||(o[3]=(...n)=>e.handleFilterChange&&e.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[13]||(o[13]=[t("option",{value:null},"–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",-1),t("option",{value:!1},"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1),t("option",{value:!0},"–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1)])],544),[[A,e.filters.read]])]),t("div",null,[j(t("select",{"onUpdate:modelValue":o[4]||(o[4]=n=>e.filters.type=n),onChange:o[5]||(o[5]=(...n)=>e.handleFilterChange&&e.handleFilterChange(...n)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[14]||(o[14]=[P('<option value="">–í—Å–µ —Ç–∏–ø—ã</option><option value="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option><option value="success">–£—Å–ø–µ—Ö</option><option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option><option value="error">–û—à–∏–±–∫–∞</option>',5)])],544),[[A,e.filters.type]])])])]),e.loading?(i(),a("div",$,[...o[15]||(o[15]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...",-1)])])):u("",!0),e.error?(i(),a("div",ee,[t("p",te,l(e.error),1)])):u("",!0),!e.loading&&e.notifications.length>0?(i(),a("div",oe,[(i(!0),a(y,null,S(e.notifications,n=>(i(),a("div",{key:n.id,class:k(["bg-card rounded-lg border p-4 transition-colors",n.read?"border-border":"border-accent bg-accent/5"])},[t("div",ne,[t("div",se,[t("div",re,[t("h3",ae,l(n.title),1),n.read?u("",!0):(i(),a("span",ie)),t("span",{class:k(["px-2 py-1 text-xs rounded",e.getTypeClass(n.type)])},l(e.getTypeLabel(n.type)),3)]),t("p",le,l(n.message),1),t("div",de,[t("span",null,l(e.formatDate(n.created_at)),1),n.read_at?(i(),a("span",ce," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(e.formatDate(n.read_at)),1)):u("",!0)])]),t("div",ue,[t("button",{onClick:f=>e.viewNotification(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,fe),n.read?u("",!0):(i(),a("button",{key:0,onClick:f=>e.markAsRead(n.id),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded transition-colors",title:"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"}," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ ",8,ge)),t("button",{onClick:f=>e.deleteNotification(n.id),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors",title:"–£–¥–∞–ª–∏—Ç—å"}," –£–¥–∞–ª–∏—Ç—å ",8,me)])])],2))),128))])):u("",!0),!e.loading&&e.notifications.length===0?(i(),a("div",be,[...o[16]||(o[16]=[t("p",{class:"text-muted-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):u("",!0),e.pagination&&e.pagination.last_page>1?(i(),a("div",pe,[t("div",xe,[t("span",null," –ü–æ–∫–∞–∑–∞–Ω–æ "+l(e.pagination.from)+"-"+l(e.pagination.to)+" –∏–∑ "+l(e.pagination.total),1)]),t("div",ve,[t("button",{onClick:o[6]||(o[6]=n=>e.handlePageChange(e.pagination.current_page-1)),disabled:e.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,he),t("div",_e,[(i(!0),a(y,null,S(e.getPageNumbers(e.pagination.current_page,e.pagination.last_page),n=>(i(),a("button",{key:n,onClick:f=>e.handlePageChange(n),class:k(["px-3 py-2 rounded-md border text-sm transition-colors min-w-[40px]",n===e.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},l(n),11,ye))),128))]),t("button",{onClick:o[7]||(o[7]=n=>e.handlePageChange(e.pagination.current_page+1)),disabled:e.pagination.current_page===e.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,ke)])])):u("",!0)]),e.selectedNotification?(i(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:o[11]||(o[11]=G((...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n),["self"]))},[t("div",we,[t("div",Ne,[t("div",null,[t("h2",Ce,l(e.selectedNotification.title),1),t("div",je,[t("span",{class:k(["px-2 py-1 text-xs rounded",e.getTypeClass(e.selectedNotification.type)])},l(e.getTypeLabel(e.selectedNotification.type)),3),t("span",Se,l(e.formatDate(e.selectedNotification.created_at)),1)])]),t("button",{onClick:o[8]||(o[8]=(...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n)),class:"p-2 hover:bg-muted/10 rounded-lg transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å"},[...o[18]||(o[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Te,[t("div",Ae,[t("div",null,[o[19]||(o[19]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ",-1)),t("p",Be,l(e.selectedNotification.message),1)]),e.selectedNotification.data?(i(),a("div",Me,[e.selectedNotification.data.quiz_id?(i(),a("div",Ee,[o[28]||(o[28]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-4"},"–î–µ—Ç–∞–ª–∏ –∫–≤–∏–∑–∞",-1)),t("div",De,[t("div",null,[o[20]||(o[20]=t("span",{class:"text-sm font-medium text-muted-foreground"},"–ö–≤–∏–∑:",-1)),t("span",Fe,l(e.selectedNotification.data.quiz_title),1)]),e.selectedNotification.data.contact?(i(),a("div",ze,[o[24]||(o[24]=t("h4",{class:"text-sm font-semibold text-foreground mb-2"},"–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),t("div",Le,[t("div",null,[o[21]||(o[21]=t("span",{class:"text-sm text-muted-foreground"},"–ò–º—è:",-1)),t("span",Ve,l(e.selectedNotification.data.contact.name),1)]),t("div",null,[o[22]||(o[22]=t("span",{class:"text-sm text-muted-foreground"},"Email:",-1)),t("span",Re,l(e.selectedNotification.data.contact.email),1)]),t("div",null,[o[23]||(o[23]=t("span",{class:"text-sm text-muted-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω:",-1)),t("span",Ie,l(e.selectedNotification.data.contact.phone),1)])])])):u("",!0),e.selectedNotification.data.answers&&e.selectedNotification.data.answers.length>0?(i(),a("div",Oe,[o[26]||(o[26]=t("h4",{class:"text-sm font-semibold text-foreground mb-3"},"–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",-1)),t("div",Ue,[(i(!0),a(y,null,S(e.selectedNotification.data.answers,(n,f)=>(i(),a("div",{key:f,class:"bg-muted/30 rounded-lg p-4 border-l-4 border-accent"},[t("div",qe,l(n.question_text||`–í–æ–ø—Ä–æ—Å ${f+1}`),1),t("div",Je,[o[25]||(o[25]=t("strong",null,"–û—Ç–≤–µ—Ç:",-1)),t("span",Pe,l(e.formatAnswer(n.answer)),1)])]))),128))])])):u("",!0),e.selectedNotification.data.completed_at?(i(),a("div",Ge,[o[27]||(o[27]=t("span",{class:"text-sm text-muted-foreground"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),t("span",He,l(e.formatDate(e.selectedNotification.data.completed_at)),1)])):u("",!0)])])):(i(),a("div",Ke,[o[29]||(o[29]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",-1)),t("pre",Qe,l(JSON.stringify(e.selectedNotification.data,null,2)),1)]))])):u("",!0)])]),t("div",We,[t("div",Xe,[e.selectedNotification.read_at?(i(),a("span",Ye," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+l(e.formatDate(e.selectedNotification.read_at)),1)):(i(),a("span",Ze," –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ "))]),t("div",$e,[e.selectedNotification.read?u("",!0):(i(),a("button",{key:0,onClick:o[9]||(o[9]=n=>e.markAsReadFromModal(e.selectedNotification.id)),class:"px-4 py-2 text-sm bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors"}," –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ ")),t("button",{onClick:o[10]||(o[10]=(...n)=>e.closeNotificationModal&&e.closeNotificationModal(...n)),class:"px-4 py-2 text-sm border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," –ó–∞–∫—Ä—ã—Ç—å ")])])])])):u("",!0)],64)}const nt=q(K,[["render",et]]);export{nt as default};
