import{_ as S,c as i,b as e,d as f,t as p,l as h,v as y,q as j,F as V,k as U,p as B,a as F,h as b,j as E,r as N,J as _,o as d}from"./app-B-amqmjt.js";import{S as k}from"./sweetalert2.esm.all-C0u8rGqG.js";import T from"./Media-_1asnyWS.js";import"./api-V9GPpd21.js";import"./index-BXqUdxMh.js";/* empty css                        */const z={name:"WhyChooseUsSettings",components:{Media:T},setup(){const g=b(!0),t=b(!1),m=b(null),o=b(!1),v=b(null),n=b({title:"",is_active:!0,items:[]}),x=async()=>{g.value=!0,m.value=null;try{const s=await _.get("/api/v1/why-choose-us-block-settings");if(s.data&&s.data.data&&(n.value={title:s.data.data.title||"",is_active:s.data.data.is_active!==!1,items:s.data.data.items||[]},n.value.items&&n.value.items.length>0)){for(const c of n.value.items)if(c.icon_id)try{const l=await _.get(`/api/v1/media/${c.icon_id}`);l.data&&l.data.data&&(c.icon=l.data.data)}catch(l){console.error("Error fetching icon:",l)}}}catch(s){m.value=s.response?.data?.message||"Ошибка загрузки настроек",console.error("Error fetching settings:",s)}finally{g.value=!1}},r=s=>{v.value=s,o.value=!0},a=s=>{if(s&&s.type==="photo"&&v.value!==null){const c=n.value.items[v.value];c&&(c.icon_id=s.id,c.icon=s),o.value=!1,v.value=null}},u=()=>{n.value.items||(n.value.items=[]),n.value.items.length<6&&n.value.items.push({text:"",icon_id:null,icon:null})},w=s=>{n.value.items&&n.value.items.length>s&&n.value.items.splice(s,1)},C=(s,c)=>{if(!n.value.items||n.value.items.length<=1)return;const l=c==="up"?s-1:s+1;if(l>=0&&l<n.value.items.length){const M=n.value.items[s];n.value.items[s]=n.value.items[l],n.value.items[l]=M}},I=async()=>{t.value=!0,m.value=null;try{const s={title:n.value.title,is_active:n.value.is_active,items:n.value.items.map(l=>({text:l.text,icon_id:l.icon_id}))},c=await _.put("/api/v1/why-choose-us-block-settings",s);await k.fire({title:"Настройки сохранены",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(s){m.value=s.response?.data?.message||"Ошибка сохранения настроек",await k.fire({title:"Ошибка",text:m.value,icon:"error",confirmButtonText:"ОК"})}finally{t.value=!1}};return E(()=>{x()}),{loading:g,saving:t,error:m,form:n,showMediaModal:o,selectedItemIndex:v,selectIcon:r,handleIconSelected:a,addItem:u,removeItem:w,moveItem:C,saveSettings:I}}},D={class:"why-choose-us-settings-page space-y-6"},W={key:0,class:"flex items-center justify-center py-12"},q={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},J={class:"text-destructive"},L={key:2,class:"space-y-6"},R={class:"bg-card rounded-lg border border-border p-6 space-y-6"},A={class:"space-y-4"},G={class:"flex items-center gap-2"},H={class:"bg-card rounded-lg border border-border p-6 space-y-6"},K={class:"flex items-center justify-between"},O=["disabled"],P={key:0,class:"text-center py-8 text-muted-foreground"},Q={key:1,class:"space-y-4"},X={class:"flex items-center justify-between"},Y={class:"font-semibold text-foreground"},Z=["onClick"],$={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee=["onUpdate:modelValue"],te={class:"space-y-3"},oe={key:0,class:"relative"},se=["src"],ne={class:"mt-2 flex gap-2"},re=["onClick"],le=["onClick"],ie={key:1},de=["onClick"],ae={class:"flex gap-2"},ce=["onClick"],ue=["onClick"],me={class:"flex justify-end gap-3 pt-4 border-t border-border"},ve=["disabled"],fe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col my-auto"},be={class:"p-4 border-b border-border flex items-center justify-between flex-shrink-0"},ge={class:"flex-1 overflow-auto h-full"};function xe(g,t,m,o,v,n){const x=N("Media");return d(),i("div",D,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},'Настройки блока "Почему выбирают нас"'),e("p",{class:"text-muted-foreground mt-1"},'Управление блоком "Почему выбирают нас" на главной странице')],-1)),o.loading?(d(),i("div",W,[...t[6]||(t[6]=[e("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):f("",!0),o.error?(d(),i("div",q,[e("p",J,p(o.error),1)])):f("",!0),o.loading?f("",!0):(d(),i("div",L,[e("div",R,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-foreground"},"Общие настройки",-1)),e("div",A,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-foreground mb-2"}," Заголовок блока ",-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.form.title=r),type:"text",placeholder:"Почему выбирают нас",class:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[y,o.form.title]])]),e("div",G,[h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.is_active=r),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[j,o.form.is_active]]),t[8]||(t[8]=e("label",{for:"is_active",class:"text-sm font-medium text-foreground"}," Блок активен на главной странице ",-1))])])]),e("div",H,[e("div",K,[t[10]||(t[10]=e("h2",{class:"text-xl font-semibold text-foreground"},"Карточки (максимум 6)",-1)),e("button",{onClick:t[2]||(t[2]=(...r)=>o.addItem&&o.addItem(...r)),disabled:o.form.items&&o.form.items.length>=6,class:"px-4 py-2 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"}," + Добавить карточку ",8,O)]),!o.form.items||o.form.items.length===0?(d(),i("div",P,[...t[11]||(t[11]=[e("p",null,"Нет карточек. Добавьте первую карточку.",-1)])])):(d(),i("div",Q,[(d(!0),i(V,null,U(o.form.items,(r,a)=>(d(),i("div",{key:a,class:"border border-border rounded-lg p-4 space-y-4"},[e("div",X,[e("h3",Y,"Карточка "+p(a+1),1),e("button",{onClick:u=>o.removeItem(a),class:"px-3 py-1 text-sm text-destructive hover:bg-destructive/10 rounded transition-colors"}," Удалить ",8,Z)]),e("div",$,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-foreground mb-2"}," Текст карточки ",-1)),h(e("textarea",{"onUpdate:modelValue":u=>r.text=u,rows:"3",placeholder:"500+ участков в базе",class:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent resize-none"},null,8,ee),[[y,r.text]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-foreground mb-2"}," Иконка ",-1)),e("div",te,[r.icon?(d(),i("div",oe,[e("img",{src:r.icon.url||`/${r.icon.disk}/${r.icon.name}`,alt:"Icon preview",class:"w-20 h-20 object-contain rounded-lg border border-border"},null,8,se),e("div",ne,[e("button",{type:"button",onClick:u=>o.selectIcon(a),class:"px-4 py-2 bg-accent/10 text-accent border border-accent/40 rounded hover:bg-accent/20 text-sm"}," Изменить иконку ",8,re),e("button",{type:"button",onClick:u=>{r.icon_id=null,r.icon=null},class:"px-4 py-2 bg-destructive/10 text-destructive border border-destructive/40 rounded hover:bg-destructive/20 text-sm"}," Удалить ",8,le)])])):(d(),i("div",ie,[e("button",{type:"button",onClick:u=>o.selectIcon(a),class:"w-full h-20 border-2 border-dashed border-border rounded flex items-center justify-center hover:bg-muted/10 transition-colors"},[...t[13]||(t[13]=[e("span",{class:"text-muted-foreground text-sm"},"Выберите иконку",-1)])],8,de)]))])])]),e("div",ae,[a>0?(d(),i("button",{key:0,onClick:u=>o.moveItem(a,"up"),class:"px-3 py-1 text-sm border border-border hover:bg-accent/10 rounded transition-colors",title:"Переместить вверх"}," ↑ Вверх ",8,ce)):f("",!0),a<o.form.items.length-1?(d(),i("button",{key:1,onClick:u=>o.moveItem(a,"down"),class:"px-3 py-1 text-sm border border-border hover:bg-accent/10 rounded transition-colors",title:"Переместить вниз"}," ↓ Вниз ",8,ue)):f("",!0)])]))),128))]))]),e("div",me,[e("button",{onClick:t[3]||(t[3]=(...r)=>o.saveSettings&&o.saveSettings(...r)),disabled:o.saving,class:"px-6 py-2 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"},p(o.saving?"Сохранение...":"Сохранить настройки"),9,ve)])])),o.showMediaModal&&o.selectedItemIndex!==null?(d(),i("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm overflow-y-auto p-4",onClick:t[5]||(t[5]=B(r=>o.showMediaModal=!1,["self"]))},[e("div",fe,[e("div",be,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold"},"Выберите иконку",-1)),e("button",{onClick:t[4]||(t[4]=r=>o.showMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),e("div",ge,[F(x,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):f("",!0)])}const Ce=S(z,[["render",xe],["__scopeId","data-v-b922acf7"]]);export{Ce as default};
