import{_ as V,h as s,y as q,j as U,c as i,b as o,d as m,l as g,v as x,D as O,F,k as P,t as _,G as j,p as J,a as I,r as E,o as d,i as K,C as Q,E as W}from"./app-Do2upUsO.js";import{a as M,b as X,c as Y}from"./api-V9GPpd21.js";import{S as Z}from"./sweetalert2.esm.all-C0u8rGqG.js";import $ from"./Media-B1cye4KH.js";import"./index-DJ-e-e6E.js";/* empty css                        */const ee={name:"ProductForm",components:{Media:$},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,html_content:"",order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const c=s([]),t=s([]),f=s(!1),v=s([]),b=s(!1),l=s(!1),p=s(!1),k=s(null),h=s(null),u=s(null),r=s({name:n.initialData.name||"",slug:n.initialData.slug||"",chapter_id:n.initialData.chapter_id||null,image_id:n.initialData.image_id||null,icon_id:n.initialData.icon_id||null,card_preview_image_id:n.initialData.card_preview_image_id||null,short_description:n.initialData.short_description||"",page_title:n.initialData.page_title||"",page_subtitle:n.initialData.page_subtitle||"",cta_text:n.initialData.cta_text||"",cta_link:n.initialData.cta_link||"",html_content:n.initialData.html_content||"",order:n.initialData.order??0,is_active:n.initialData.is_active!==!1}),S=async()=>{try{const a=await M("/chapters");if(a.ok){const y=await a.json();c.value=y.data||[]}}catch(a){console.error("Error fetching chapters:",a)}},w=async()=>{f.value=!0;try{const a=await M("/services?active=1");if(a.ok){const y=await a.json();t.value=y.data||[]}}catch(a){console.error("Error fetching services:",a)}finally{f.value=!1}},C=()=>{b.value=!0},B=()=>{l.value=!0},A=()=>{p.value=!0},D=a=>{k.value=a,r.value.image_id=a.id,b.value=!1},T=a=>{h.value=a,r.value.icon_id=a.id,l.value=!1},z=a=>{u.value=a,r.value.card_preview_image_id=a.id,p.value=!1},L=()=>{k.value=null,r.value.image_id=null},H=()=>{h.value=null,r.value.icon_id=null},N=()=>{u.value=null,r.value.card_preview_image_id=null};q(()=>n.initialData,a=>{r.value={name:a.name||"",slug:a.slug||"",chapter_id:a.chapter_id||null,image_id:a.image_id||null,icon_id:a.icon_id||null,card_preview_image_id:a.card_preview_image_id||null,short_description:a.short_description||"",page_title:a.page_title||"",page_subtitle:a.page_subtitle||"",cta_text:a.cta_text||"",cta_link:a.cta_link||"",html_content:a.html_content||"",order:a.order??0,is_active:a.is_active!==!1},a.image&&(k.value=a.image),a.icon&&(h.value=a.icon),a.card_preview_image&&(u.value=a.card_preview_image),a.services&&Array.isArray(a.services)&&(v.value=a.services.map(y=>y.id||y))},{deep:!0});const R=()=>{e("submit",{name:r.value.name,slug:r.value.slug||null,chapter_id:r.value.chapter_id||null,image_id:r.value.image_id||null,icon_id:r.value.icon_id||null,card_preview_image_id:r.value.card_preview_image_id||null,short_description:r.value.short_description||null,page_title:r.value.page_title||null,page_subtitle:r.value.page_subtitle||null,cta_text:r.value.cta_text||null,cta_link:r.value.cta_link||null,html_content:r.value.html_content||null,order:r.value.order,is_active:r.value.is_active,services:v.value})},G=()=>{e("cancel")};return U(()=>{S(),w(),n.initialData.image&&(k.value=n.initialData.image),n.initialData.icon&&(h.value=n.initialData.icon),n.initialData.card_preview_image&&(u.value=n.initialData.card_preview_image),n.initialData.services&&Array.isArray(n.initialData.services)&&(v.value=n.initialData.services.map(a=>a.id||a))}),{chapters:c,services:t,loadingServices:f,selectedServices:v,localForm:r,showImageMediaModal:b,showIconMediaModal:l,showCardPreviewImageModal:p,selectedImage:k,selectedIcon:h,selectedCardPreviewImage:u,openImageModal:C,openIconModal:B,openCardPreviewImageModal:A,handleImageSelected:D,handleIconSelected:T,handleCardPreviewImageSelected:z,removeImage:L,removeIcon:H,removeCardPreviewImage:N,handleSubmit:R,handleCancel:G}}},te=["value"],oe={class:"flex items-center gap-3"},le={key:0,class:"flex-1"},re=["src","alt"],ae={class:"flex items-center gap-3"},ne={key:0,class:"flex-1"},ie=["src","alt"],de={class:"flex items-center gap-3"},se={key:0,class:"flex-1"},ce=["src","alt"],ue={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},me={key:0,class:"text-sm text-muted-foreground"},be={key:1,class:"text-sm text-muted-foreground"},ge={key:2,class:"space-y-2"},ve=["value"],fe={class:"text-sm"},xe={class:"flex items-center gap-2"},_e={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},pe={class:"flex gap-2 pt-4"},ke=["disabled"],he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ye={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},we={class:"flex items-center justify-between p-4 border-b border-border"},Ie={class:"flex-1 overflow-auto h-full"},Ce={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Fe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},Me={class:"flex items-center justify-between p-4 border-b border-border"},Se={class:"flex-1 overflow-auto h-full"},Pe={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},je={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},Ve={class:"flex items-center justify-between p-4 border-b border-border"},Ue={class:"flex-1 overflow-auto h-full"};function Ee(n,e,c,t,f,v){const b=E("Media");return d(),i(F,null,[o("form",{onSubmit:e[19]||(e[19]=J((...l)=>t.handleSubmit&&t.handleSubmit(...l),["prevent"])),class:"space-y-4"},[o("div",null,[e[23]||(e[23]=o("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),g(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.localForm.name=l),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название продукта"},null,512),[[x,t.localForm.name]])]),o("div",null,[e[24]||(e[24]=o("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),g(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.localForm.slug=l),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[x,t.localForm.slug]]),e[25]||(e[25]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),o("div",null,[e[27]||(e[27]=o("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),g(o("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.localForm.chapter_id=l),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[26]||(e[26]=o("option",{value:null},"Не выбран",-1)),(d(!0),i(F,null,P(t.chapters,l=>(d(),i("option",{key:l.id,value:l.id},_(l.name),9,te))),128))],512),[[O,t.localForm.chapter_id]])]),o("div",null,[e[28]||(e[28]=o("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),o("div",oe,[t.selectedImage?(d(),i("div",le,[o("img",{src:t.selectedImage.url,alt:t.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,re)])):m("",!0),o("button",{type:"button",onClick:e[3]||(e[3]=(...l)=>t.openImageModal&&t.openImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(t.selectedImage?"Изменить":"Выбрать изображение"),1),t.selectedImage?(d(),i("button",{key:1,type:"button",onClick:e[4]||(e[4]=(...l)=>t.removeImage&&t.removeImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):m("",!0)])]),o("div",null,[e[29]||(e[29]=o("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),o("div",ae,[t.selectedIcon?(d(),i("div",ne,[o("img",{src:t.selectedIcon.url,alt:t.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,ie)])):m("",!0),o("button",{type:"button",onClick:e[5]||(e[5]=(...l)=>t.openIconModal&&t.openIconModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(t.selectedIcon?"Изменить":"Выбрать иконку"),1),t.selectedIcon?(d(),i("button",{key:1,type:"button",onClick:e[6]||(e[6]=(...l)=>t.removeIcon&&t.removeIcon(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):m("",!0)])]),o("div",null,[e[30]||(e[30]=o("label",{class:"text-sm font-medium mb-1 block"},"Короткое описание",-1)),g(o("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>t.localForm.short_description=l),rows:"3",maxlength:"500",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none text-sm",placeholder:"Короткое описание для карточек и первого экрана (140–220 символов)"},null,512),[[x,t.localForm.short_description]]),e[31]||(e[31]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Отображается на главной странице",-1))]),o("div",null,[e[32]||(e[32]=o("label",{class:"text-sm font-medium mb-1 block"},"Изображение для карточки (превью)",-1)),o("div",de,[t.selectedCardPreviewImage?(d(),i("div",se,[o("img",{src:t.selectedCardPreviewImage.url,alt:t.selectedCardPreviewImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,ce)])):m("",!0),o("button",{type:"button",onClick:e[8]||(e[8]=(...l)=>t.openCardPreviewImageModal&&t.openCardPreviewImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(t.selectedCardPreviewImage?"Изменить":"Выбрать изображение"),1),t.selectedCardPreviewImage?(d(),i("button",{key:1,type:"button",onClick:e[9]||(e[9]=(...l)=>t.removeCardPreviewImage&&t.removeCardPreviewImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):m("",!0)]),e[33]||(e[33]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Используется только в карточках листинга. Не влияет на основное изображение.",-1))]),o("div",null,[e[34]||(e[34]=o("label",{class:"text-sm font-medium mb-1 block"},"Заголовок страницы (H1)",-1)),g(o("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>t.localForm.page_title=l),type:"text",maxlength:"255",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Заголовок страницы продукта"},null,512),[[x,t.localForm.page_title]]),e[35]||(e[35]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Отображается на главной странице",-1))]),o("div",null,[e[36]||(e[36]=o("label",{class:"text-sm font-medium mb-1 block"},"Подзаголовок/лид страницы",-1)),g(o("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>t.localForm.page_subtitle=l),type:"text",maxlength:"500",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Подзаголовок страницы продукта"},null,512),[[x,t.localForm.page_subtitle]]),e[37]||(e[37]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Отображается на главной странице",-1))]),o("div",null,[e[38]||(e[38]=o("label",{class:"text-sm font-medium mb-1 block"},"Текст кнопки CTA",-1)),g(o("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>t.localForm.cta_text=l),type:"text",maxlength:"255",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Текст кнопки призыва к действию"},null,512),[[x,t.localForm.cta_text]]),e[39]||(e[39]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Отображается на главной странице",-1))]),o("div",null,[e[40]||(e[40]=o("label",{class:"text-sm font-medium mb-1 block"},"Ссылка кнопки CTA",-1)),g(o("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>t.localForm.cta_link=l),type:"text",maxlength:"500",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"URL ссылки кнопки CTA"},null,512),[[x,t.localForm.cta_link]]),e[41]||(e[41]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Отображается на главной странице",-1))]),o("div",null,[e[42]||(e[42]=o("label",{class:"text-sm font-medium mb-1 block"},"HTML контент",-1)),g(o("textarea",{"onUpdate:modelValue":e[14]||(e[14]=l=>t.localForm.html_content=l),rows:"10",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none font-mono text-sm",placeholder:"Введите HTML контент для продукта"},null,512),[[x,t.localForm.html_content]]),e[43]||(e[43]=o("p",{class:"text-xs text-muted-foreground mt-1"},"HTML контент, который будет отображаться на странице продукта",-1))]),o("div",null,[e[44]||(e[44]=o("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),g(o("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>t.localForm.order=l),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[x,t.localForm.order,void 0,{number:!0}]])]),o("div",null,[e[45]||(e[45]=o("label",{class:"text-sm font-medium mb-1 block"},"Услуги",-1)),o("div",ue,[t.loadingServices?(d(),i("div",me," Загрузка услуг... ")):t.services.length===0?(d(),i("div",be," Услуги не найдены ")):(d(),i("div",ge,[(d(!0),i(F,null,P(t.services,l=>(d(),i("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[g(o("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[16]||(e[16]=p=>t.selectedServices=p),class:"w-4 h-4 rounded border-border"},null,8,ve),[[j,t.selectedServices]]),o("span",fe,_(l.name),1)]))),128))]))])]),o("div",xe,[g(o("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>t.localForm.is_active=l),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[j,t.localForm.is_active]]),e[46]||(e[46]=o("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),c.error?(d(),i("div",_e,_(c.error),1)):m("",!0),o("div",pe,[o("button",{type:"button",onClick:e[18]||(e[18]=(...l)=>t.handleCancel&&t.handleCancel(...l)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),o("button",{type:"submit",disabled:c.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},_(c.saving?"Сохранение...":"Сохранить"),9,ke)])],32),t.showImageMediaModal?(d(),i("div",he,[o("div",ye,[o("div",we,[e[47]||(e[47]=o("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),o("button",{onClick:e[20]||(e[20]=l=>t.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),o("div",Ie,[I(b,{"selection-mode":!0,"count-file":1,onFileSelected:t.handleImageSelected},null,8,["onFileSelected"])])])])):m("",!0),t.showIconMediaModal?(d(),i("div",Ce,[o("div",Fe,[o("div",Me,[e[48]||(e[48]=o("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),o("button",{onClick:e[21]||(e[21]=l=>t.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),o("div",Se,[I(b,{"selection-mode":!0,"count-file":1,onFileSelected:t.handleIconSelected},null,8,["onFileSelected"])])])])):m("",!0),t.showCardPreviewImageModal?(d(),i("div",Pe,[o("div",je,[o("div",Ve,[e[49]||(e[49]=o("h3",{class:"text-lg font-semibold"},"Выбрать изображение для карточки",-1)),o("button",{onClick:e[22]||(e[22]=l=>t.showCardPreviewImageModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),o("div",Ue,[I(b,{"selection-mode":!0,"count-file":1,onFileSelected:t.handleCardPreviewImageSelected},null,8,["onFileSelected"])])])])):m("",!0)],64)}const Be=V(ee,[["render",Ee]]),Ae={name:"ProductFormPage",components:{ProductForm:Be},setup(){const n=Q(),e=W(),c=s(!1),t=s(!1),f=s(null),v=s(null),b=s({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,card_preview_image_id:null,short_description:"",page_title:"",page_subtitle:"",cta_text:"",cta_link:"",html_content:"",image:null,icon:null,card_preview_image:null,order:0,is_active:!0}),l=K(()=>!!n.params.id),p=async()=>{if(!l.value){c.value=!1;return}c.value=!0,f.value=null;try{const u=await M(`/products/${n.params.id}`);if(!u.ok)throw new Error("Ошибка загрузки продукта");const r=await u.json();r.data&&(b.value={id:r.data.id,name:r.data.name||"",slug:r.data.slug||"",chapter_id:r.data.chapter_id||null,image_id:r.data.image_id||null,icon_id:r.data.icon_id||null,card_preview_image_id:r.data.card_preview_image_id||null,short_description:r.data.short_description||"",page_title:r.data.page_title||"",page_subtitle:r.data.page_subtitle||"",cta_text:r.data.cta_text||"",cta_link:r.data.cta_link||"",html_content:r.data.html_content||"",image:r.data.image||null,icon:r.data.icon||null,card_preview_image:r.data.card_preview_image||null,order:r.data.order??0,is_active:r.data.is_active!==!1,services:r.data.services||[]})}catch(u){f.value=u.message||"Ошибка загрузки продукта",console.error("Error fetching product:",u)}finally{c.value=!1}},k=async u=>{t.value=!0,v.value=null;try{const r=l.value?`/products/${n.params.id}`:"/products",w=await(l.value?X:Y)(r,u);if(!w.ok){const C=await w.json().catch(()=>({}));throw new Error(C.message||`Ошибка ${l.value?"обновления":"создания"} продукта`)}await Z.fire({title:l.value?"Продукт обновлен":"Продукт создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.products"})}catch(r){v.value=r.message||"Ошибка сохранения продукта"}finally{t.value=!1}},h=()=>{e.push({name:"admin.decisions.products"})};return U(()=>{p()}),{loading:c,saving:t,error:f,formError:v,form:b,isEdit:l,saveProduct:k,goBack:h}}},De={class:"product-form-page space-y-6"},Te={class:"flex items-center justify-between"},ze={class:"text-3xl font-semibold text-foreground"},Le={key:0,class:"flex items-center justify-center py-12"},He={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Ne={class:"text-destructive"},Re={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Ge(n,e,c,t,f,v){const b=E("ProductForm");return d(),i("div",De,[o("div",Te,[o("div",null,[o("h1",ze,_(t.isEdit?"Редактировать продукт":"Создать продукт"),1),e[1]||(e[1]=o("p",{class:"text-muted-foreground mt-1"},"Управление продуктом для блока решений",-1))]),o("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),t.loading?(d(),i("div",Le,[...e[2]||(e[2]=[o("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):m("",!0),t.error?(d(),i("div",He,[o("p",Ne,_(t.error),1)])):m("",!0),t.loading?m("",!0):(d(),i("div",Re,[I(b,{"initial-data":t.form,saving:t.saving,error:t.formError,onSubmit:t.saveProduct,onCancel:t.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const Xe=V(Ae,[["render",Ge]]);export{Xe as default};
