import{_ as J,c as r,b as e,d as i,t as l,l as f,v as F,E as w,s as U,F as x,k as p,p as K,B as k,h as g,i as O,j as Q,o as a,f as R}from"./app-DA_5Afjg.js";import{a as C,b as W}from"./api-V9GPpd21.js";import{S}from"./sweetalert2.esm.all-C0u8rGqG.js";const X={name:"ProductRequests",setup(){const _=g(!1),o=g(null),q=g([]),t=g(null),m=g(null),j=g([]),s=g(null),h=g(null),b=g({search:"",status:null,assigned_to:null}),y=g({status:null,assigned_to:null,notes:null}),v=async(n=1)=>{_.value=!0,o.value=null;try{const d=new URLSearchParams({page:n.toString(),per_page:"20"});b.value.search&&d.append("search",b.value.search),b.value.status&&d.append("status",b.value.status),b.value.assigned_to&&d.append("assigned_to",b.value.assigned_to);const u=await C(`/product-requests?${d.toString()}`);if(!u.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫");const c=await u.json();q.value=c.data||[],t.value={current_page:c.current_page,last_page:c.last_page,from:c.from,to:c.to,total:c.total}}catch(d){o.value=d.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫",console.error("Error fetching requests:",d)}finally{_.value=!1}},M=async()=>{try{const n=await C("/product-requests/stats");if(n.ok){const d=await n.json();s.value=d.data}}catch(n){console.error("Error fetching stats:",n)}},P=async()=>{try{const n=await C("/users");if(n.ok){const d=await n.json();j.value=d.data||[]}}catch(n){console.error("Error fetching users:",n)}},E=async()=>{try{const n=localStorage.getItem("token"),d={Accept:"application/json","Content-Type":"application/json"};n&&(d.Authorization=`Bearer ${n}`);const u=await fetch("/api/auth/user",{method:"GET",headers:d});if(u.ok){const c=await u.json();h.value=c.user||c}}catch(n){console.error("Error fetching auth user:",n)}},V=async n=>{try{const d=await C(`/product-requests/${n.id}`);if(!d.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–∫–∏");const u=await d.json();m.value=u.data,y.value={status:u.data.status,assigned_to:u.data.assigned_to,notes:u.data.notes||""}}catch(d){S.fire({title:"–û—à–∏–±–∫–∞",text:d.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫—É",icon:"error"})}},B=async()=>{if(m.value)try{const n=await W(`/product-requests/${m.value.id}`,y.value);if(!n.ok){const u=await n.json().catch(()=>({}));throw new Error(u.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏")}const d=await n.json();m.value=d.data,await v(t.value?.current_page||1),await M(),S.fire({title:"–£—Å–ø–µ—à–Ω–æ",text:"–ó–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(n){S.fire({title:"–û—à–∏–±–∫–∞",text:n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É",icon:"error"})}},D=()=>{m.value=null,y.value={status:null,assigned_to:null,notes:null}},T=()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{v(1)},500)},L=()=>{v(1)},z=n=>{v(n)},A=n=>{const d={new:"bg-accent/20 text-accent border-accent/50",in_progress:"bg-blue-500/20 text-blue-600 border-blue-500/50",completed:"bg-green-500/20 text-green-600 border-green-500/50",cancelled:"bg-gray-500/20 text-gray-600 border-gray-500/50",rejected:"bg-red-500/20 text-red-600 border-red-500/50"};return d[n]||d.new},N=n=>({new:"–ù–æ–≤–∞—è",in_progress:"–í –æ–±—Ä–∞–±–æ—Ç–∫–µ",completed:"–ó–∞–≤–µ—Ä—à–µ–Ω–∞",cancelled:"–û—Ç–º–µ–Ω–µ–Ω–∞",rejected:"–û—Ç–∫–ª–æ–Ω–µ–Ω–∞"})[n]||n,G=n=>n?new Date(n).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",H=O(()=>{if(!t.value)return[];const n=[],d=t.value.current_page,u=t.value.last_page;for(let c=Math.max(1,d-2);c<=Math.min(u,d+2);c++)n.push(c);return n});return Q(async()=>{await Promise.all([v(),M(),P(),E()])}),{loading:_,error:o,requests:q,pagination:t,selectedRequest:m,users:j,stats:s,authUser:h,filters:b,editForm:y,viewRequest:V,updateRequest:B,closeRequestModal:D,handleSearch:T,handleFilterChange:L,handlePageChange:z,getStatusClass:A,getStatusLabel:N,formatDate:G,getPageNumbers:H}}},Y={class:"product-requests-page space-y-6"},Z={class:"flex items-center justify-between"},I={key:0,class:"flex items-center gap-4"},$={class:"text-center"},ee={class:"text-2xl font-bold text-foreground"},te={class:"text-center"},oe={class:"text-2xl font-bold text-foreground"},se={class:"bg-card rounded-lg border border-border p-4"},ne={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},re={class:"md:col-span-2"},ae={class:"relative"},de=["value"],le=["value"],ie={key:0,class:"flex items-center justify-center py-12"},ue={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ce={class:"text-destructive"},ge={key:2},me={key:0,class:"text-center py-12 text-muted-foreground"},be={key:1,class:"space-y-3"},fe=["onClick"],xe={class:"flex items-start justify-between gap-4"},pe={class:"flex-1 min-w-0"},ve={class:"flex items-center gap-3 mb-2"},_e={class:"font-semibold text-foreground"},he={class:"text-sm text-muted-foreground"},ye={class:"space-y-1 text-sm"},we={class:"text-foreground"},ke={class:"text-muted-foreground"},Re={key:0,class:"text-muted-foreground"},Ce={key:1,class:"text-muted-foreground"},qe={key:0,class:"text-sm text-muted-foreground mt-2 line-clamp-2"},je={class:"flex items-center gap-2 flex-shrink-0"},Se={key:0,class:"h-2 w-2 bg-accent rounded-full",title:"–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞"},Me={key:2,class:"mt-6 flex items-center justify-between"},Fe={class:"text-sm text-muted-foreground"},Ue={class:"flex items-center gap-2"},Pe=["disabled"],Ee={class:"flex items-center gap-1"},Ve=["onClick"],Be=["disabled"],De={class:"bg-card rounded-lg border border-border shadow-2xl max-w-4xl w-full my-8 max-h-[90vh] overflow-hidden flex flex-col"},Te={class:"flex items-center justify-between p-6 border-b border-border"},Le={class:"text-2xl font-semibold text-foreground"},ze={class:"flex items-center gap-2 mt-2"},Ae={class:"text-xs text-muted-foreground"},Ne={class:"p-6 space-y-6 overflow-y-auto flex-1"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"text-foreground mt-1"},Je={class:"text-foreground mt-1"},Ke={class:"text-foreground mt-1"},Oe=["value"],Qe={key:0},We={class:"text-foreground mt-1 whitespace-pre-wrap"},Xe={key:1},Ye={class:"space-y-1"},Ze={class:"space-y-4"},Ie={key:2},$e={class:"space-y-2"},et={class:"flex items-center justify-between mb-1"},tt={class:"text-sm font-medium text-foreground"},ot={class:"text-xs text-muted-foreground"},st={key:0,class:"text-xs text-muted-foreground mb-1"},nt={key:1,class:"text-sm text-foreground"},rt={class:"p-6 border-t border-border flex justify-end gap-3"};function at(_,o,q,t,m,j){return a(),r("div",Y,[e("div",Z,[o[19]||(o[19]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"–ó–∞—è–≤–∫–∏"),e("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã")],-1)),t.stats?(a(),r("div",I,[e("div",$,[e("div",ee,l(t.stats.new),1),o[17]||(o[17]=e("div",{class:"text-xs text-muted-foreground"},"–ù–æ–≤—ã–µ",-1))]),e("div",te,[e("div",oe,l(t.stats.in_progress),1),o[18]||(o[18]=e("div",{class:"text-xs text-muted-foreground"},"–í –æ–±—Ä–∞–±–æ—Ç–∫–µ",-1))])])):i("",!0)]),e("div",se,[e("div",ne,[e("div",re,[e("div",ae,[o[20]||(o[20]=e("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),f(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>t.filters.search=s),onInput:o[1]||(o[1]=(...s)=>t.handleSearch&&t.handleSearch(...s)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[F,t.filters.search]])])]),e("div",null,[f(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.filters.status=s),onChange:o[3]||(o[3]=(...s)=>t.handleFilterChange&&t.handleFilterChange(...s)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...o[21]||(o[21]=[e("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),U('<option value="new">–ù–æ–≤–∞—è</option><option value="in_progress">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option><option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option><option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option><option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>',5)])],544),[[w,t.filters.status]])]),e("div",null,[f(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>t.filters.assigned_to=s),onChange:o[5]||(o[5]=(...s)=>t.handleFilterChange&&t.handleFilterChange(...s)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[o[22]||(o[22]=e("option",{value:null},"–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",-1)),e("option",{value:t.authUser?.id},"–ú–æ–∏ –∑–∞—è–≤–∫–∏",8,de),(a(!0),r(x,null,p(t.users,s=>(a(),r("option",{key:s.id,value:s.id},l(s.name),9,le))),128))],544),[[w,t.filters.assigned_to]])])])]),t.loading?(a(),r("div",ie,[...o[23]||(o[23]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin"}),e("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...")],-1)])])):i("",!0),t.error?(a(),r("div",ue,[e("p",ce,l(t.error),1)])):i("",!0),!t.loading&&!t.error?(a(),r("div",ge,[t.requests.length===0?(a(),r("div",me,[...o[24]||(o[24]=[e("p",null,"–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):(a(),r("div",be,[(a(!0),r(x,null,p(t.requests,s=>(a(),r("div",{key:s.id,onClick:h=>t.viewRequest(s),class:k(["bg-card border border-border rounded-lg p-4 hover:shadow-md transition-all cursor-pointer",{"border-accent/50 bg-accent/5":s.status==="new","border-blue-500/50 bg-blue-500/5":s.status==="in_progress","border-green-500/50 bg-green-500/5":s.status==="completed"}])},[e("div",xe,[e("div",pe,[e("div",ve,[e("h3",_e,"#"+l(s.id),1),e("span",{class:k(["px-2 py-1 text-xs rounded font-medium",t.getStatusClass(s.status)])},l(t.getStatusLabel(s.status)),3),e("span",he,l(t.formatDate(s.created_at)),1)]),e("div",ye,[e("p",we,[o[25]||(o[25]=e("span",{class:"font-medium"},"–ö–ª–∏–µ–Ω—Ç:",-1)),R(" "+l(s.name),1)]),e("p",ke,[o[26]||(o[26]=e("span",{class:"font-medium"},"–¢–µ–ª–µ—Ñ–æ–Ω:",-1)),R(" "+l(s.phone),1)]),s.product?(a(),r("p",Re,[o[27]||(o[27]=e("span",{class:"font-medium"},"–ü—Ä–æ–¥—É–∫—Ç:",-1)),R(" "+l(s.product.name),1)])):i("",!0),s.assigned_user?(a(),r("p",Ce,[o[28]||(o[28]=e("span",{class:"font-medium"},"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:",-1)),R(" "+l(s.assigned_user.name),1)])):i("",!0)]),s.comment?(a(),r("p",qe,l(s.comment),1)):i("",!0)]),e("div",je,[s.status==="new"?(a(),r("span",Se)):i("",!0)])])],10,fe))),128))])),t.pagination&&t.pagination.last_page>1?(a(),r("div",Me,[e("div",Fe," –ü–æ–∫–∞–∑–∞–Ω–æ "+l(t.pagination.from)+" - "+l(t.pagination.to)+" –∏–∑ "+l(t.pagination.total),1),e("div",Ue,[e("button",{onClick:o[6]||(o[6]=s=>t.handlePageChange(t.pagination.current_page-1)),disabled:t.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,Pe),e("div",Ee,[(a(!0),r(x,null,p(t.getPageNumbers,s=>(a(),r("button",{key:s,onClick:h=>t.handlePageChange(s),class:k(["px-3 py-2 rounded-md text-sm transition-colors",s===t.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},l(s),11,Ve))),128))]),e("button",{onClick:o[7]||(o[7]=s=>t.handlePageChange(t.pagination.current_page+1)),disabled:t.pagination.current_page===t.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,Be)])])):i("",!0)])):i("",!0),t.selectedRequest?(a(),r("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 overflow-y-auto",onClick:o[16]||(o[16]=K((...s)=>t.closeRequestModal&&t.closeRequestModal(...s),["self"]))},[e("div",De,[e("div",Te,[e("div",null,[e("h2",Le,"–ó–∞—è–≤–∫–∞ #"+l(t.selectedRequest.id),1),e("div",ze,[e("span",{class:k(["px-2 py-1 text-xs rounded font-medium",t.getStatusClass(t.selectedRequest.status)])},l(t.getStatusLabel(t.selectedRequest.status)),3),e("span",Ae," –°–æ–∑–¥–∞–Ω–∞: "+l(t.formatDate(t.selectedRequest.created_at)),1)])]),e("button",{onClick:o[8]||(o[8]=(...s)=>t.closeRequestModal&&t.closeRequestModal(...s)),class:"p-2 hover:bg-muted/10 rounded-lg transition-colors",title:"–ó–∞–∫—Ä—ã—Ç—å"},[...o[29]||(o[29]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ne,[e("div",Ge,[e("div",null,[o[30]||(o[30]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ö–ª–∏–µ–Ω—Ç",-1)),e("p",He,l(t.selectedRequest.name),1)]),e("div",null,[o[31]||(o[31]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω",-1)),e("p",Je,l(t.selectedRequest.phone),1)]),e("div",null,[o[32]||(o[32]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ü—Ä–æ–¥—É–∫—Ç",-1)),e("p",Ke,l(t.selectedRequest.product?.name||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",null,[o[34]||(o[34]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",-1)),f(e("select",{"onUpdate:modelValue":o[9]||(o[9]=s=>t.editForm.assigned_to=s),onChange:o[10]||(o[10]=(...s)=>t.updateRequest&&t.updateRequest(...s)),class:"w-full mt-1 px-3 py-2 border border-border rounded bg-background text-sm"},[o[33]||(o[33]=e("option",{value:null},"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω",-1)),(a(!0),r(x,null,p(t.users,s=>(a(),r("option",{key:s.id,value:s.id},l(s.name),9,Oe))),128))],544),[[w,t.editForm.assigned_to]])])]),t.selectedRequest.comment?(a(),r("div",Qe,[o[35]||(o[35]=e("label",{class:"text-sm font-medium text-muted-foreground"},"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞",-1)),e("p",We,l(t.selectedRequest.comment),1)])):i("",!0),t.selectedRequest.services&&t.selectedRequest.services.length>0?(a(),r("div",Xe,[o[36]||(o[36]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏",-1)),e("div",Ye,[(a(!0),r(x,null,p(t.selectedRequest.services,s=>(a(),r("div",{key:s.id||s,class:"px-3 py-2 bg-muted/50 rounded text-sm"},l(typeof s=="object"?s.name:s),1))),128))])])):i("",!0),e("div",Ze,[e("div",null,[o[38]||(o[38]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–°—Ç–∞—Ç—É—Å",-1)),f(e("select",{"onUpdate:modelValue":o[11]||(o[11]=s=>t.editForm.status=s),onChange:o[12]||(o[12]=(...s)=>t.updateRequest&&t.updateRequest(...s)),class:"w-full px-3 py-2 border border-border rounded bg-background text-sm"},[...o[37]||(o[37]=[U('<option value="new">–ù–æ–≤–∞—è</option><option value="in_progress">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option><option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option><option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option><option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>',5)])],544),[[w,t.editForm.status]])]),e("div",null,[o[39]||(o[39]=e("label",{class:"text-sm font-medium text-muted-foreground mb-2 block"},"–ó–∞–º–µ—Ç–∫–∏",-1)),f(e("textarea",{"onUpdate:modelValue":o[13]||(o[13]=s=>t.editForm.notes=s),onBlur:o[14]||(o[14]=(...s)=>t.updateRequest&&t.updateRequest(...s)),rows:"4",placeholder:"–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –∑–∞—è–≤–∫–µ...",class:"w-full px-3 py-2 border border-border rounded bg-background text-sm resize-none"},null,544),[[F,t.editForm.notes]])])]),t.selectedRequest.history&&t.selectedRequest.history.length>0?(a(),r("div",Ie,[o[40]||(o[40]=e("label",{class:"text-sm font-medium text-muted-foreground mb-3 block"},"–ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏",-1)),e("div",$e,[(a(!0),r(x,null,p(t.selectedRequest.history,s=>(a(),r("div",{key:s.id,class:"p-3 bg-muted/30 rounded border-l-2 border-border"},[e("div",et,[e("span",tt,l(s.action_name||s.action),1),e("span",ot,l(t.formatDate(s.created_at)),1)]),s.user?(a(),r("div",st," –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "+l(s.user.name),1)):i("",!0),s.comment?(a(),r("div",nt,l(s.comment),1)):i("",!0)]))),128))])])):i("",!0)]),e("div",rt,[e("button",{onClick:o[15]||(o[15]=(...s)=>t.closeRequestModal&&t.closeRequestModal(...s)),class:"px-4 py-2 border border-border rounded hover:bg-accent/10 text-sm"}," –ó–∞–∫—Ä—ã—Ç—å ")])])])):i("",!0)])}const ut=J(X,[["render",at]]);export{ut as default};
