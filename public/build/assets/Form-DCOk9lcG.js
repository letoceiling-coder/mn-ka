import{_ as U,h as m,z as V,j as T,c as s,b as t,d as g,l as _,v as w,E as H,F as M,k as B,f as p,a as k,t as h,w as D,q as P,p as G,r as S,o as d,i as R,D as O,G as A}from"./app-Dmao0LRC.js";import{a as j,b as J,c as K}from"./api-V9GPpd21.js";import{S as Q}from"./sweetalert2.esm.all-C0u8rGqG.js";import W from"./Media-Ct4RNt0P.js";import"./index-fpw1nXPx.js";/* empty css                        */const X={name:"ServiceForm",components:{Media:W},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const u=m([]),o=m([]),f=m(!1),x=m(!1),v=m(!1),c=m(null),l=m(null),a=m({name:n.initialData.name||"",slug:n.initialData.slug||"",chapter_id:n.initialData.chapter_id||null,image_id:n.initialData.image_id||null,icon_id:n.initialData.icon_id||null,html_content:n.initialData.html_content||"",order:n.initialData.order??0,is_active:n.initialData.is_active!==!1}),F=async()=>{try{const r=await j("/chapters");if(r.ok){const C=await r.json();u.value=C.data||[]}}catch(r){console.error("Error fetching chapters:",r)}},b=async()=>{if(!a.value.chapter_id){o.value=[];return}f.value=!0;try{const r=await j(`/cases?chapter_id=${a.value.chapter_id}`);if(r.ok){const C=await r.json();o.value=C.data||[]}}catch(r){console.error("Error fetching cases:",r),o.value=[]}finally{f.value=!1}},i=()=>{x.value=!0},E=()=>{v.value=!0},y=r=>{c.value=r,a.value.image_id=r.id,x.value=!1},I=r=>{l.value=r,a.value.icon_id=r.id,v.value=!1},q=()=>{c.value=null,a.value.image_id=null},z=()=>{l.value=null,a.value.icon_id=null};V(()=>n.initialData,r=>{a.value={name:r.name||"",slug:r.slug||"",chapter_id:r.chapter_id||null,image_id:r.image_id||null,icon_id:r.icon_id||null,html_content:r.html_content||"",order:r.order??0,is_active:r.is_active!==!1},r.image&&(c.value=r.image),r.icon&&(l.value=r.icon),r.chapter_id&&b()},{deep:!0}),V(()=>a.value.chapter_id,()=>{b()});const L=()=>{e("submit",{name:a.value.name,slug:a.value.slug||null,chapter_id:a.value.chapter_id||null,image_id:a.value.image_id||null,icon_id:a.value.icon_id||null,html_content:a.value.html_content||null,order:a.value.order,is_active:a.value.is_active})},N=()=>{e("cancel")};return T(()=>{F(),n.initialData.image&&(c.value=n.initialData.image),n.initialData.icon&&(l.value=n.initialData.icon),n.initialData.chapter_id&&b()}),{chapters:u,casesForChapter:o,loadingCases:f,localForm:a,showImageMediaModal:x,showIconMediaModal:v,selectedImage:c,selectedIcon:l,openImageModal:i,openIconModal:E,handleImageSelected:y,handleIconSelected:I,removeImage:q,removeIcon:z,fetchCasesForChapter:b,handleSubmit:L,handleCancel:N}}},Y=["value"],Z={key:0},$={class:"border border-border rounded-lg p-3 max-h-48 overflow-y-auto bg-muted/5"},ee={class:"space-y-1"},oe={class:"text-xs text-muted-foreground mt-1"},te={key:1,class:"text-sm text-muted-foreground"},le={class:"flex items-center gap-3"},re={key:0,class:"flex-1"},ne=["src","alt"],ae={class:"flex items-center gap-3"},ie={key:0,class:"flex-1"},se=["src","alt"],de={class:"flex items-center gap-2"},ce={key:2,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},ue={class:"flex gap-2 pt-4"},me=["disabled"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ve={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ge={class:"flex items-center justify-between p-4 border-b border-border"},fe={class:"flex-1 overflow-auto h-full"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},he={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},_e={class:"flex items-center justify-between p-4 border-b border-border"},pe={class:"flex-1 overflow-auto h-full"};function ke(n,e,u,o,f,x){const v=S("router-link"),c=S("Media");return d(),s(M,null,[t("form",{onSubmit:e[12]||(e[12]=G((...l)=>o.handleSubmit&&o.handleSubmit(...l),["prevent"])),class:"space-y-4"},[t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.localForm.name=l),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название услуги"},null,512),[[w,o.localForm.name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.localForm.slug=l),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[w,o.localForm.slug]]),e[17]||(e[17]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.localForm.chapter_id=l),onChange:e[3]||(e[3]=(...l)=>o.fetchCasesForChapter&&o.fetchCasesForChapter(...l)),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[18]||(e[18]=t("option",{value:null},"Не выбран",-1)),(d(!0),s(M,null,B(o.chapters,l=>(d(),s("option",{key:l.id,value:l.id},h(l.name),9,Y))),128))],544),[[H,o.localForm.chapter_id]])]),o.localForm.chapter_id&&o.casesForChapter.length>0?(d(),s("div",Z,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Случаи в этом разделе",-1)),t("div",$,[t("div",ee,[(d(!0),s(M,null,B(o.casesForChapter,l=>(d(),s("div",{key:l.id,class:"text-sm text-muted-foreground flex items-center gap-2"},[e[20]||(e[20]=t("span",{class:"w-2 h-2 rounded-full bg-accent"},null,-1)),p(" "+h(l.name),1)]))),128))])]),t("p",oe,[p(" Всего случаев: "+h(o.casesForChapter.length)+". ",1),k(v,{to:{name:"admin.decisions.cases",query:{chapter_id:o.localForm.chapter_id}},class:"text-accent hover:underline"},{default:D(()=>[...e[21]||(e[21]=[p(" Управление случаями ",-1)])]),_:1},8,["to"])])])):o.localForm.chapter_id&&!o.loadingCases?(d(),s("div",te,[e[24]||(e[24]=p(" В этом разделе пока нет случаев. ",-1)),k(v,{to:{name:"admin.decisions.cases.create",query:{chapter_id:o.localForm.chapter_id}},class:"text-accent hover:underline"},{default:D(()=>[...e[23]||(e[23]=[p(" Создать случай ",-1)])]),_:1},8,["to"])])):g("",!0),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),t("div",le,[o.selectedImage?(d(),s("div",re,[t("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,ne)])):g("",!0),t("button",{type:"button",onClick:e[4]||(e[4]=(...l)=>o.openImageModal&&o.openImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},h(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(d(),s("button",{key:1,type:"button",onClick:e[5]||(e[5]=(...l)=>o.removeImage&&o.removeImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):g("",!0)])]),t("div",null,[e[26]||(e[26]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",ae,[o.selectedIcon?(d(),s("div",ie,[t("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,se)])):g("",!0),t("button",{type:"button",onClick:e[6]||(e[6]=(...l)=>o.openIconModal&&o.openIconModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},h(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(d(),s("button",{key:1,type:"button",onClick:e[7]||(e[7]=(...l)=>o.removeIcon&&o.removeIcon(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):g("",!0)])]),t("div",null,[e[27]||(e[27]=t("label",{class:"text-sm font-medium mb-1 block"},"HTML контент",-1)),_(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>o.localForm.html_content=l),rows:"10",class:"w-full px-3 py-2 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none font-mono text-sm",placeholder:"Введите HTML контент для услуги"},null,512),[[w,o.localForm.html_content]]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"},"HTML контент, который будет отображаться на странице услуги",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),_(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.localForm.order=l),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[w,o.localForm.order,void 0,{number:!0}]])]),t("div",de,[_(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>o.localForm.is_active=l),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[P,o.localForm.is_active]]),e[30]||(e[30]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активна ",-1))]),u.error?(d(),s("div",ce,h(u.error),1)):g("",!0),t("div",ue,[t("button",{type:"button",onClick:e[11]||(e[11]=(...l)=>o.handleCancel&&o.handleCancel(...l)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:u.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},h(u.saving?"Сохранение...":"Сохранить"),9,me)])],32),o.showImageMediaModal?(d(),s("div",be,[t("div",ve,[t("div",ge,[e[31]||(e[31]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[13]||(e[13]=l=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",fe,[k(c,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):g("",!0),o.showIconMediaModal?(d(),s("div",xe,[t("div",he,[t("div",_e,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:e[14]||(e[14]=l=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",pe,[k(c,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):g("",!0)],64)}const ye=U(X,[["render",ke]]),we={name:"ServiceFormPage",components:{ServiceForm:ye},setup(){const n=O(),e=A(),u=m(!1),o=m(!1),f=m(null),x=m(null),v=m({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,html_content:"",image:null,icon:null,order:0,is_active:!0}),c=R(()=>!!n.params.id),l=async()=>{if(!c.value){u.value=!1;return}u.value=!0,f.value=null;try{const b=await j(`/services/${n.params.id}`);if(!b.ok)throw new Error("Ошибка загрузки услуги");const i=await b.json();i.data&&(v.value={id:i.data.id,name:i.data.name||"",slug:i.data.slug||"",chapter_id:i.data.chapter_id||null,image_id:i.data.image_id||null,icon_id:i.data.icon_id||null,html_content:i.data.html_content||"",image:i.data.image||null,icon:i.data.icon||null,order:i.data.order??0,is_active:i.data.is_active!==!1})}catch(b){f.value=b.message||"Ошибка загрузки услуги",console.error("Error fetching service:",b)}finally{u.value=!1}},a=async b=>{o.value=!0,x.value=null;try{const i=c.value?`/services/${n.params.id}`:"/services",y=await(c.value?J:K)(i,b);if(!y.ok){const I=await y.json().catch(()=>({}));throw new Error(I.message||`Ошибка ${c.value?"обновления":"создания"} услуги`)}await Q.fire({title:c.value?"Услуга обновлена":"Услуга создана",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.services"})}catch(i){x.value=i.message||"Ошибка сохранения услуги"}finally{o.value=!1}},F=()=>{e.push({name:"admin.decisions.services"})};return T(()=>{l()}),{loading:u,saving:o,error:f,formError:x,form:v,isEdit:c,saveService:a,goBack:F}}},Fe={class:"service-form-page space-y-6"},Ie={class:"flex items-center justify-between"},Ce={class:"text-3xl font-semibold text-foreground"},Me={key:0,class:"flex items-center justify-center py-12"},Se={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},je={class:"text-destructive"},Ee={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Ve(n,e,u,o,f,x){const v=S("ServiceForm");return d(),s("div",Fe,[t("div",Ie,[t("div",null,[t("h1",Ce,h(o.isEdit?"Редактировать услугу":"Создать услугу"),1),e[1]||(e[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление услугой для блока решений",-1))]),t("button",{onClick:e[0]||(e[0]=(...c)=>o.goBack&&o.goBack(...c)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(d(),s("div",Me,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):g("",!0),o.error?(d(),s("div",Se,[t("p",je,h(o.error),1)])):g("",!0),o.loading?g("",!0):(d(),s("div",Ee,[k(v,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveService,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const Le=U(we,[["render",Ve]]);export{Le as default};
