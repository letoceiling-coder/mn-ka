import{_ as k,c as n,b as o,d as c,a as b,w as _,t as i,l as B,D as j,F as y,k as w,h as l,C as D,j as E,r as V,o as a,f as N}from"./app-D6S8wRp1.js";import{a as C,d as S}from"./api-V9GPpd21.js";import{S as v}from"./sweetalert2.esm.all-C0u8rGqG.js";const T={name:"DecisionCases",setup(){const m=D(),e=l(!1),u=l(null),t=l([]),h=l([]),f=l(m.query.chapter_id?parseInt(m.query.chapter_id):null),g=async()=>{try{const r=await C("/chapters");if(r.ok){const d=await r.json();h.value=d.data||[]}}catch(r){console.error("Error fetching chapters:",r)}},s=async()=>{e.value=!0,u.value=null;try{let r="/cases";f.value&&(r+=`?chapter_id=${f.value}`);const d=await C(r);if(!d.ok)throw new Error("Ошибка загрузки случаев");const p=await d.json();t.value=p.data||[]}catch(r){u.value=r.message||"Ошибка загрузки случаев",console.error("Error fetching cases:",r)}finally{e.value=!1}},x=async r=>{if((await v.fire({title:"Удалить случай?",text:`Вы уверены, что хотите удалить случай "${r.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",confirmButtonColor:"#dc2626"})).isConfirmed)try{if(!(await S(`/cases/${r.id}`)).ok)throw new Error("Ошибка удаления случая");await v.fire({title:"Случай удален",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await s()}catch(p){await v.fire({title:"Ошибка",text:p.message||"Ошибка удаления случая",icon:"error",confirmButtonText:"ОК"})}};return E(()=>{g(),s()}),{loading:e,error:u,cases:t,chapters:h,selectedChapter:f,fetchCases:s,deleteCase:x}}},q={class:"cases-page space-y-6"},F={class:"flex items-center justify-between"},M={key:0,class:"flex items-center justify-center py-12"},G={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},L={class:"text-destructive"},R={key:2,class:"flex items-center gap-4"},U=["value"],z={key:3,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"divide-y divide-border"},H={class:"flex-1"},J={class:"font-medium text-foreground"},K={class:"text-sm text-muted-foreground"},O={class:"flex items-center gap-2"},P=["onClick"],Q={key:4,class:"text-center py-12 bg-card rounded-lg border border-border"};function W(m,e,u,t,h,f){const g=V("router-link");return a(),n("div",q,[o("div",F,[e[3]||(e[3]=o("div",null,[o("h1",{class:"text-3xl font-semibold text-foreground"},"Случаи"),o("p",{class:"text-muted-foreground mt-1"},"Управление случаями для блока решений")],-1)),b(g,{to:{name:"admin.decisions.cases.create"},class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},{default:_(()=>[...e[2]||(e[2]=[o("span",null,"+",-1),o("span",null,"Создать случай",-1)])]),_:1})]),t.loading?(a(),n("div",M,[...e[4]||(e[4]=[o("p",{class:"text-muted-foreground"},"Загрузка случаев...",-1)])])):c("",!0),t.error?(a(),n("div",G,[o("p",L,i(t.error),1)])):c("",!0),!t.loading&&t.chapters.length>0?(a(),n("div",R,[B(o("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.selectedChapter=s),onChange:e[1]||(e[1]=(...s)=>t.fetchCases&&t.fetchCases(...s)),class:"px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[e[5]||(e[5]=o("option",{value:null},"Все разделы",-1)),(a(!0),n(y,null,w(t.chapters,s=>(a(),n("option",{key:s.id,value:s.id},i(s.name),9,U))),128))],544),[[j,t.selectedChapter]])])):c("",!0),!t.loading&&t.cases.length>0?(a(),n("div",z,[o("div",A,[(a(!0),n(y,null,w(t.cases,s=>(a(),n("div",{key:s.id,class:"p-4 hover:bg-muted/10 transition-colors flex items-center justify-between"},[o("div",H,[o("h3",J,i(s.name),1),o("p",K," Раздел: "+i(s.chapter?.name||"Не указан")+" | Порядок: "+i(s.order)+" | "+i(s.is_active?"Активен":"Неактивен"),1)]),o("div",O,[b(g,{to:{name:"admin.decisions.cases.edit",params:{id:s.id}},class:"px-3 py-1.5 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors inline-block"},{default:_(()=>[...e[6]||(e[6]=[N(" Редактировать ",-1)])]),_:1},8,["to"]),o("button",{onClick:x=>t.deleteCase(s),class:"px-3 py-1.5 text-sm bg-destructive/10 text-destructive hover:bg-destructive/20 rounded-lg transition-colors"}," Удалить ",8,P)])]))),128))])])):c("",!0),!t.loading&&t.cases.length===0?(a(),n("div",Q,[...e[7]||(e[7]=[o("p",{class:"text-muted-foreground"},"Случаи не найдены",-1)])])):c("",!0)])}const I=k(T,[["render",W]]);export{I as default};
