import{_ as B,d as c,y as R,f as E,c as a,b as t,g as v,p as k,v as w,C as q,F as M,l as j,t as _,u as P,s as G,a as S,r as V,o as s,e as L,B as O,D as T}from"./app-CCdj2HdX.js";import{a as F,b as H,c as J}from"./api-DccBIR6h.js";import{S as K}from"./sweetalert2.esm.all-C0u8rGqG.js";import Q from"./Media-NkbsoIp6.js";import"./index-eZHEw_3p.js";/* empty css                        */const W={name:"ProductForm",components:{Media:Q},props:{initialData:{type:Object,default:()=>({name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,order:0,is_active:!0})},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const u=c([]),o=c([]),g=c(!1),b=c([]),m=c(!1),l=c(!1),f=c(null),h=c(null),d=c({name:n.initialData.name||"",slug:n.initialData.slug||"",chapter_id:n.initialData.chapter_id||null,image_id:n.initialData.image_id||null,icon_id:n.initialData.icon_id||null,order:n.initialData.order??0,is_active:n.initialData.is_active!==!1}),x=async()=>{try{const r=await F("/chapters");if(r.ok){const y=await r.json();u.value=y.data||[]}}catch(r){console.error("Error fetching chapters:",r)}},i=async()=>{g.value=!0;try{const r=await F("/services?active=1");if(r.ok){const y=await r.json();o.value=y.data||[]}}catch(r){console.error("Error fetching services:",r)}finally{g.value=!1}},C=()=>{m.value=!0},p=()=>{l.value=!0},I=r=>{f.value=r,d.value.image_id=r.id,m.value=!1},D=r=>{h.value=r,d.value.icon_id=r.id,l.value=!1},U=()=>{f.value=null,d.value.image_id=null},A=()=>{h.value=null,d.value.icon_id=null};R(()=>n.initialData,r=>{d.value={name:r.name||"",slug:r.slug||"",chapter_id:r.chapter_id||null,image_id:r.image_id||null,icon_id:r.icon_id||null,order:r.order??0,is_active:r.is_active!==!1},r.image&&(f.value=r.image),r.icon&&(h.value=r.icon),r.services&&Array.isArray(r.services)&&(b.value=r.services.map(y=>y.id||y))},{deep:!0});const N=()=>{e("submit",{name:d.value.name,slug:d.value.slug||null,chapter_id:d.value.chapter_id||null,image_id:d.value.image_id||null,icon_id:d.value.icon_id||null,order:d.value.order,is_active:d.value.is_active,services:b.value})},z=()=>{e("cancel")};return E(()=>{x(),i(),n.initialData.image&&(f.value=n.initialData.image),n.initialData.icon&&(h.value=n.initialData.icon),n.initialData.services&&Array.isArray(n.initialData.services)&&(b.value=n.initialData.services.map(r=>r.id||r))}),{chapters:u,services:o,loadingServices:g,selectedServices:b,localForm:d,showImageMediaModal:m,showIconMediaModal:l,selectedImage:f,selectedIcon:h,openImageModal:C,openIconModal:p,handleImageSelected:I,handleIconSelected:D,removeImage:U,removeIcon:A,handleSubmit:N,handleCancel:z}}},X=["value"],Y={class:"flex items-center gap-3"},Z={key:0,class:"flex-1"},$=["src","alt"],ee={class:"flex items-center gap-3"},oe={key:0,class:"flex-1"},te=["src","alt"],le={class:"border border-border rounded-lg p-4 max-h-64 overflow-y-auto"},re={key:0,class:"text-sm text-muted-foreground"},ne={key:1,class:"text-sm text-muted-foreground"},ae={key:2,class:"space-y-2"},se=["value"],ie={class:"text-sm"},de={class:"flex items-center gap-2"},ce={key:0,class:"p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive"},ue={class:"flex gap-2 pt-4"},me=["disabled"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ve={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},ge={class:"flex items-center justify-between p-4 border-b border-border"},fe={class:"flex-1 overflow-auto h-full"},xe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},_e={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col m-4"},he={class:"flex items-center justify-between p-4 border-b border-border"},ye={class:"flex-1 overflow-auto h-full"};function ke(n,e,u,o,g,b){const m=V("Media");return s(),a(M,null,[t("form",{onSubmit:e[11]||(e[11]=G((...l)=>o.handleSubmit&&o.handleSubmit(...l),["prevent"])),class:"space-y-4"},[t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm font-medium mb-1 block"},"Название *",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.localForm.name=l),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Введите название продукта"},null,512),[[w,o.localForm.name]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.localForm.slug=l),type:"text",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Автоматически генерируется из названия"},null,512),[[w,o.localForm.slug]]),e[16]||(e[16]=t("p",{class:"text-xs text-muted-foreground mt-1"},"Если не указан, будет создан автоматически",-1))]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-sm font-medium mb-1 block"},"Раздел",-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.localForm.chapter_id=l),class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[e[17]||(e[17]=t("option",{value:null},"Не выбран",-1)),(s(!0),a(M,null,j(o.chapters,l=>(s(),a("option",{key:l.id,value:l.id},_(l.name),9,X))),128))],512),[[q,o.localForm.chapter_id]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium mb-1 block"},"Изображение",-1)),t("div",Y,[o.selectedImage?(s(),a("div",Z,[t("img",{src:o.selectedImage.url,alt:o.selectedImage.original_name,class:"w-20 h-20 object-cover rounded border border-border"},null,8,$)])):v("",!0),t("button",{type:"button",onClick:e[3]||(e[3]=(...l)=>o.openImageModal&&o.openImageModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(o.selectedImage?"Изменить":"Выбрать изображение"),1),o.selectedImage?(s(),a("button",{key:1,type:"button",onClick:e[4]||(e[4]=(...l)=>o.removeImage&&o.removeImage(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm font-medium mb-1 block"},"Иконка",-1)),t("div",ee,[o.selectedIcon?(s(),a("div",oe,[t("img",{src:o.selectedIcon.url,alt:o.selectedIcon.original_name,class:"w-16 h-16 object-cover rounded border border-border"},null,8,te)])):v("",!0),t("button",{type:"button",onClick:e[5]||(e[5]=(...l)=>o.openIconModal&&o.openIconModal(...l)),class:"px-4 py-2 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors text-sm"},_(o.selectedIcon?"Изменить":"Выбрать иконку"),1),o.selectedIcon?(s(),a("button",{key:1,type:"button",onClick:e[6]||(e[6]=(...l)=>o.removeIcon&&o.removeIcon(...l)),class:"px-4 py-2 border border-destructive text-destructive hover:bg-destructive/10 rounded-lg transition-colors text-sm"}," Удалить ")):v("",!0)])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Порядок",-1)),k(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.localForm.order=l),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[w,o.localForm.order,void 0,{number:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Услуги",-1)),t("div",le,[o.loadingServices?(s(),a("div",re," Загрузка услуг... ")):o.services.length===0?(s(),a("div",ne," Услуги не найдены ")):(s(),a("div",ae,[(s(!0),a(M,null,j(o.services,l=>(s(),a("label",{key:l.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[k(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[8]||(e[8]=f=>o.selectedServices=f),class:"w-4 h-4 rounded border-border"},null,8,se),[[P,o.selectedServices]]),t("span",ie,_(l.name),1)]))),128))]))])]),t("div",de,[k(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.localForm.is_active=l),type:"checkbox",id:"is_active",class:"w-4 h-4 rounded border-border"},null,512),[[P,o.localForm.is_active]]),e[23]||(e[23]=t("label",{for:"is_active",class:"text-sm font-medium"}," Активен ",-1))]),u.error?(s(),a("div",ce,_(u.error),1)):v("",!0),t("div",ue,[t("button",{type:"button",onClick:e[10]||(e[10]=(...l)=>o.handleCancel&&o.handleCancel(...l)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:u.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},_(u.saving?"Сохранение...":"Сохранить"),9,me)])],32),o.showImageMediaModal?(s(),a("div",be,[t("div",ve,[t("div",ge,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold"},"Выбрать изображение",-1)),t("button",{onClick:e[12]||(e[12]=l=>o.showImageMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",fe,[S(m,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleImageSelected},null,8,["onFileSelected"])])])])):v("",!0),o.showIconMediaModal?(s(),a("div",xe,[t("div",_e,[t("div",he,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold"},"Выбрать иконку",-1)),t("button",{onClick:e[13]||(e[13]=l=>o.showIconMediaModal=!1),class:"text-muted-foreground hover:text-foreground w-8 h-8 flex items-center justify-center rounded hover:bg-muted/10"}," ✕ ")]),t("div",ye,[S(m,{"selection-mode":!0,"count-file":1,onFileSelected:o.handleIconSelected},null,8,["onFileSelected"])])])])):v("",!0)],64)}const pe=B(W,[["render",ke]]),Ie={name:"ProductFormPage",components:{ProductForm:pe},setup(){const n=O(),e=T(),u=c(!1),o=c(!1),g=c(null),b=c(null),m=c({id:null,name:"",slug:"",chapter_id:null,image_id:null,icon_id:null,image:null,icon:null,order:0,is_active:!0}),l=L(()=>!!n.params.id),f=async()=>{if(!l.value){u.value=!1;return}u.value=!0,g.value=null;try{const x=await F(`/products/${n.params.id}`);if(!x.ok)throw new Error("Ошибка загрузки продукта");const i=await x.json();i.data&&(m.value={id:i.data.id,name:i.data.name||"",slug:i.data.slug||"",chapter_id:i.data.chapter_id||null,image_id:i.data.image_id||null,icon_id:i.data.icon_id||null,image:i.data.image||null,icon:i.data.icon||null,order:i.data.order??0,is_active:i.data.is_active!==!1,services:i.data.services||[]})}catch(x){g.value=x.message||"Ошибка загрузки продукта",console.error("Error fetching product:",x)}finally{u.value=!1}},h=async x=>{o.value=!0,b.value=null;try{const i=l.value?`/products/${n.params.id}`:"/products",p=await(l.value?H:J)(i,x);if(!p.ok){const I=await p.json().catch(()=>({}));throw new Error(I.message||`Ошибка ${l.value?"обновления":"создания"} продукта`)}await K.fire({title:l.value?"Продукт обновлен":"Продукт создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e.push({name:"admin.decisions.products"})}catch(i){b.value=i.message||"Ошибка сохранения продукта"}finally{o.value=!1}},d=()=>{e.push({name:"admin.decisions.products"})};return E(()=>{f()}),{loading:u,saving:o,error:g,formError:b,form:m,isEdit:l,saveProduct:h,goBack:d}}},we={class:"product-form-page space-y-6"},Me={class:"flex items-center justify-between"},Se={class:"text-3xl font-semibold text-foreground"},Fe={key:0,class:"flex items-center justify-center py-12"},Ce={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},je={class:"text-destructive"},Pe={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-6"};function Be(n,e,u,o,g,b){const m=V("ProductForm");return s(),a("div",we,[t("div",Me,[t("div",null,[t("h1",Se,_(o.isEdit?"Редактировать продукт":"Создать продукт"),1),e[1]||(e[1]=t("p",{class:"text-muted-foreground mt-1"},"Управление продуктом для блока решений",-1))]),t("button",{onClick:e[0]||(e[0]=(...l)=>o.goBack&&o.goBack(...l)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),o.loading?(s(),a("div",Fe,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):v("",!0),o.error?(s(),a("div",Ce,[t("p",je,_(o.error),1)])):v("",!0),o.loading?v("",!0):(s(),a("div",Pe,[S(m,{"initial-data":o.form,saving:o.saving,error:o.formError,onSubmit:o.saveProduct,onCancel:o.goBack},null,8,["initial-data","saving","error","onSubmit","onCancel"])]))])}const ze=B(Ie,[["render",Be]]);export{ze as default};
