import{_ as H,h as u,i as R,z as P,c as l,b as o,d as S,l as p,f as V,v as y,x as L,t as f,q as z,p as O,A as j,J as M,o as i,a as N,j as q,r as A,C as D,E as I}from"./app-BbVWLAW1.js";import{S as J}from"./sweetalert2.esm.all-C0u8rGqG.js";const G={name:"PageFormContent",props:{page:{type:Object,default:null},saving:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["submit","cancel"],setup(g,{emit:e}){const d=u({}),t=u(!1),c=u(!1),m=u(""),r=u(!1),a=u(null),s=u({title:"",slug:"",content:"",seo_title:"",seo_description:"",seo_keywords:"",is_active:!0,order:0}),_=R(()=>s.value.content&&s.value.content.trim()?s.value.content:'<p class="text-muted-foreground">Нет содержимого</p>');P(()=>g.page,n=>{n&&(s.value={title:n.title||"",slug:n.slug||"",content:n.content||"",seo_title:n.seo_title||"",seo_description:n.seo_description||"",seo_keywords:n.seo_keywords||"",is_active:n.is_active!==void 0?n.is_active:!0,order:n.order||0})},{immediate:!0});const E=()=>{if(!s.value.slug||s.value.slug===g.page?.slug){const n=s.value.title||"";s.value.slug=n.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),c.value=!1,t.value=!1}},b=async()=>{if(s.value.slug){c.value=!1,t.value=!1;try{const n=await M.post("/api/v1/pages/check-slug",{slug:s.value.slug,exclude_id:g.page?.id});n.data.available?(t.value=!1,c.value=!0):(t.value=!0,m.value=n.data.suggested_slug||s.value.slug+"-1")}catch(n){console.error("Error checking slug:",n)}}},k=()=>{s.value.slug=m.value,t.value=!1,c.value=!0},F=n=>{if(!a.value)return;const w=a.value,v=w.selectionStart,h=w.selectionEnd,C=s.value.content.substring(v,h);let x="";n==="bold"?x=`<strong>${C||"текст"}</strong>`:n==="italic"?x=`<em>${C||"текст"}</em>`:n==="underline"&&(x=`<u>${C||"текст"}</u>`),s.value.content=s.value.content.substring(0,v)+x+s.value.content.substring(h),j(()=>{w.focus(),w.setSelectionRange(v+x.length,v+x.length)})},T=(n,w)=>{if(!a.value)return;const v=a.value,h=v.selectionStart,C=v.selectionEnd,x=s.value.content.substring(h,C)||"текст",U=n+x+w;s.value.content=s.value.content.substring(0,h)+U+s.value.content.substring(C),j(()=>{v.focus();const B=h+U.length;v.setSelectionRange(B,B)})};return{localForm:s,errors:d,slugConflict:t,slugChecked:c,suggestedSlug:m,showPreview:r,contentEditor:a,previewContent:_,generateSlug:E,checkSlug:b,useSuggestedSlug:k,formatText:F,insertTag:T,insertLink:()=>{T('<a href="">',"</a>")},handleSubmit:()=>{if(t.value){d.value.slug="Исправьте конфликт URL перед сохранением";return}e("submit",s.value)}}}},K={key:0,class:"mt-1 text-sm text-red-500"},Q={class:"flex items-center gap-2"},W={key:0,class:"mt-1 text-sm text-red-500"},X={key:1,class:"mt-1 text-sm text-yellow-600"},Y={key:2,class:"mt-1 text-sm text-green-600"},Z={key:3,class:"mt-1 text-xs text-muted-foreground"},$={class:"border border-border rounded-lg overflow-hidden"},ee={class:"bg-muted/30 border-b border-border p-2 flex items-center gap-2 flex-wrap"},te={key:0,class:"relative"},oe={key:1,class:"p-4 min-h-[300px] prose prose-sm max-w-none"},re=["innerHTML"],se={class:"border-t border-border pt-6"},ne={class:"space-y-4"},le={class:"mt-1 text-xs text-muted-foreground"},ie={class:"mt-1 text-xs text-muted-foreground"},de={class:"border-t border-border pt-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"flex items-center gap-3 cursor-pointer"},ce={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},ge={class:"text-sm text-red-600"},me={class:"flex justify-end gap-4 pt-4 border-t border-border"},be=["disabled"],fe=["disabled"],ve={key:0},xe={key:1};function pe(g,e,d,t,c,m){return i(),l("form",{onSubmit:e[22]||(e[22]=O((...r)=>t.handleSubmit&&t.handleSubmit(...r),["prevent"])),class:"space-y-6"},[o("div",null,[e[23]||(e[23]=o("label",{for:"title",class:"block text-sm font-medium text-foreground mb-2"},[V(" Название страницы "),o("span",{class:"text-red-500"},"*")],-1)),p(o("input",{id:"title","onUpdate:modelValue":e[0]||(e[0]=r=>t.localForm.title=r),type:"text",required:"",placeholder:"Введите название страницы",class:L(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":t.errors.title}]),onInput:e[1]||(e[1]=(...r)=>t.generateSlug&&t.generateSlug(...r))},null,34),[[y,t.localForm.title]]),t.errors.title?(i(),l("p",K,f(t.errors.title),1)):S("",!0)]),o("div",null,[e[25]||(e[25]=o("label",{for:"slug",class:"block text-sm font-medium text-foreground mb-2"},[V(" URL страницы "),o("span",{class:"text-red-500"},"*")],-1)),o("div",Q,[e[24]||(e[24]=o("span",{class:"text-muted-foreground"},"/",-1)),p(o("input",{id:"slug","onUpdate:modelValue":e[2]||(e[2]=r=>t.localForm.slug=r),type:"text",required:"",placeholder:"url-stranicy",class:L(["flex-1 h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors font-mono text-sm",{"border-red-500":t.errors.slug||t.slugConflict}]),onBlur:e[3]||(e[3]=(...r)=>t.checkSlug&&t.checkSlug(...r))},null,34),[[y,t.localForm.slug]]),t.slugConflict?(i(),l("button",{key:0,type:"button",onClick:e[4]||(e[4]=(...r)=>t.useSuggestedSlug&&t.useSuggestedSlug(...r)),class:"px-4 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"}," Использовать: "+f(t.suggestedSlug),1)):S("",!0)]),t.errors.slug?(i(),l("p",W,f(t.errors.slug),1)):t.slugConflict?(i(),l("p",X," Этот URL уже занят. Предложен альтернативный вариант. ")):t.slugChecked&&!t.slugConflict?(i(),l("p",Y," ✓ URL доступен ")):(i(),l("p",Z," URL будет автоматически сгенерирован из названия, если не указан "))]),o("div",null,[e[31]||(e[31]=o("label",{class:"block text-sm font-medium text-foreground mb-2"}," Содержимое страницы ",-1)),o("div",$,[o("div",ee,[o("button",{type:"button",onClick:e[5]||(e[5]=r=>t.formatText("bold")),class:"p-2 hover:bg-muted rounded transition-colors",title:"Жирный"},[...e[26]||(e[26]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"})],-1)])]),o("button",{type:"button",onClick:e[6]||(e[6]=r=>t.formatText("italic")),class:"p-2 hover:bg-muted rounded transition-colors",title:"Курсив"},[...e[27]||(e[27]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})],-1)])]),o("button",{type:"button",onClick:e[7]||(e[7]=r=>t.formatText("underline")),class:"p-2 hover:bg-muted rounded transition-colors",title:"Подчеркнутый"},[...e[28]||(e[28]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 19h14M5 7h14"})],-1)])]),e[29]||(e[29]=o("div",{class:"w-px h-6 bg-border"},null,-1)),o("button",{type:"button",onClick:e[8]||(e[8]=r=>t.insertTag("<h2>","</h2>")),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Заголовок 2"}," H2 "),o("button",{type:"button",onClick:e[9]||(e[9]=r=>t.insertTag("<h3>","</h3>")),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Заголовок 3"}," H3 "),o("button",{type:"button",onClick:e[10]||(e[10]=r=>t.insertTag("<p>","</p>")),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Параграф"}," P "),o("button",{type:"button",onClick:e[11]||(e[11]=r=>t.insertTag("<ul><li>","</li></ul>")),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Список"}," UL "),o("button",{type:"button",onClick:e[12]||(e[12]=r=>t.insertTag("<ol><li>","</li></ol>")),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Нумерованный список"}," OL "),e[30]||(e[30]=o("div",{class:"w-px h-6 bg-border"},null,-1)),o("button",{type:"button",onClick:e[13]||(e[13]=(...r)=>t.insertLink&&t.insertLink(...r)),class:"px-3 py-1 text-xs hover:bg-muted rounded transition-colors",title:"Ссылка"}," A "),o("button",{type:"button",onClick:e[14]||(e[14]=r=>t.showPreview=!t.showPreview),class:L(["px-3 py-1 text-xs hover:bg-muted rounded transition-colors",{"bg-accent text-accent-foreground":t.showPreview}])},f(t.showPreview?"Редактировать":"Предпросмотр"),3)]),t.showPreview?(i(),l("div",oe,[o("div",{innerHTML:t.previewContent},null,8,re)])):(i(),l("div",te,[p(o("textarea",{ref:"contentEditor","onUpdate:modelValue":e[15]||(e[15]=r=>t.localForm.content=r),rows:"15",placeholder:"Введите содержимое страницы. Используйте HTML разметку или кнопки форматирования выше.",class:"w-full px-4 py-3 border-0 focus:outline-none focus:ring-0 resize-none font-mono text-sm"},null,512),[[y,t.localForm.content]])]))]),e[32]||(e[32]=o("p",{class:"mt-1 text-xs text-muted-foreground"}," Поддерживается HTML разметка. Используйте кнопки форматирования или вводите HTML вручную. ",-1))]),o("div",se,[e[37]||(e[37]=o("h3",{class:"text-lg font-semibold text-foreground mb-4"},"SEO настройки",-1)),o("div",ne,[o("div",null,[e[33]||(e[33]=o("label",{for:"seo_title",class:"block text-sm font-medium text-foreground mb-2"}," SEO заголовок (meta title) ",-1)),p(o("input",{id:"seo_title","onUpdate:modelValue":e[16]||(e[16]=r=>t.localForm.seo_title=r),type:"text",placeholder:"Заголовок для поисковых систем",maxlength:"255",class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},null,512),[[y,t.localForm.seo_title]]),o("p",le," Рекомендуемая длина: 50-60 символов. Осталось: "+f(255-(t.localForm.seo_title?.length||0)),1)]),o("div",null,[e[34]||(e[34]=o("label",{for:"seo_description",class:"block text-sm font-medium text-foreground mb-2"}," SEO описание (meta description) ",-1)),p(o("textarea",{id:"seo_description","onUpdate:modelValue":e[17]||(e[17]=r=>t.localForm.seo_description=r),rows:"3",placeholder:"Краткое описание страницы для поисковых систем",maxlength:"500",class:"w-full px-4 py-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent resize-none"},null,512),[[y,t.localForm.seo_description]]),o("p",ie," Рекомендуемая длина: 150-160 символов. Осталось: "+f(500-(t.localForm.seo_description?.length||0)),1)]),o("div",null,[e[35]||(e[35]=o("label",{for:"seo_keywords",class:"block text-sm font-medium text-foreground mb-2"}," SEO ключевые слова (meta keywords) ",-1)),p(o("input",{id:"seo_keywords","onUpdate:modelValue":e[18]||(e[18]=r=>t.localForm.seo_keywords=r),type:"text",placeholder:"ключевое слово 1, ключевое слово 2, ключевое слово 3",maxlength:"255",class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},null,512),[[y,t.localForm.seo_keywords]]),e[36]||(e[36]=o("p",{class:"mt-1 text-xs text-muted-foreground"}," Укажите ключевые слова через запятую ",-1))])])]),o("div",de,[o("div",ae,[o("div",null,[o("label",ue,[p(o("input",{type:"checkbox","onUpdate:modelValue":e[19]||(e[19]=r=>t.localForm.is_active=r),class:"w-4 h-4 rounded border-border"},null,512),[[z,t.localForm.is_active]]),e[38]||(e[38]=o("span",{class:"text-sm font-medium text-foreground"},"Активна",-1))])]),o("div",null,[e[39]||(e[39]=o("label",{for:"order",class:"block text-sm font-medium text-foreground mb-2"}," Порядок сортировки ",-1)),p(o("input",{id:"order","onUpdate:modelValue":e[20]||(e[20]=r=>t.localForm.order=r),type:"number",min:"0",class:"w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors"},null,512),[[y,t.localForm.order,void 0,{number:!0}]])])])]),d.error?(i(),l("div",ce,[o("p",ge,f(d.error),1)])):S("",!0),o("div",me,[o("button",{type:"button",onClick:e[21]||(e[21]=r=>g.$emit("cancel")),class:"px-6 py-3 border border-border rounded-lg hover:bg-muted transition-colors font-medium",disabled:d.saving}," Отмена ",8,be),o("button",{type:"submit",disabled:d.saving||t.slugConflict,class:"px-6 py-3 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium"},[d.saving?(i(),l("span",ve,"Сохранение...")):(i(),l("span",xe,f(d.page?"Сохранить":"Создать"),1))],8,fe)])],32)}const ke=H(G,[["render",pe],["__scopeId","data-v-4d7462ee"]]),ye={name:"PageEdit",components:{PageFormContent:ke},setup(){const g=D(),e=I(),d=u(!1),t=u(!1),c=u(null),m=u(null),r=u(null),a=R(()=>!!g.params.id),s=async()=>{if(a.value){d.value=!0,c.value=null;try{const b=await M.get(`/api/v1/pages/${g.params.id}`);b.data&&b.data.data&&(r.value=b.data.data)}catch(b){c.value=b.response?.data?.message||"Ошибка загрузки страницы",console.error("Error fetching page:",b)}finally{d.value=!1}}},_=async b=>{t.value=!0,m.value=null;try{const k=a.value?`/api/v1/pages/${g.params.id}`:"/api/v1/pages",F=a.value?"put":"post",T=await M[F](k,b);await J.fire({icon:"success",title:"Успешно!",text:a.value?"Страница успешно обновлена":"Страница успешно создана",timer:2e3,showConfirmButton:!1}),e.push({name:"admin.pages"})}catch(k){k.response?.status===422?m.value=k.response.data.message||"Ошибка валидации":m.value=k.response?.data?.message||"Ошибка сохранения страницы"}finally{t.value=!1}},E=()=>{e.push({name:"admin.pages"})};return q(()=>{s()}),{loading:d,saving:t,error:c,formError:m,page:r,isEdit:a,savePage:_,goBack:E}}},we={class:"page-form-page space-y-6"},he={class:"flex items-center justify-between"},Ce={class:"text-3xl font-semibold text-foreground"},Se={key:0,class:"flex items-center justify-center py-12"},_e={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Ee={class:"text-destructive"},Fe={key:2,class:"bg-card rounded-lg border border-border p-6"};function Te(g,e,d,t,c,m){const r=A("PageFormContent");return i(),l("div",we,[o("div",he,[o("div",null,[o("h1",Ce,f(t.isEdit?"Редактировать страницу":"Создать страницу"),1),e[1]||(e[1]=o("p",{class:"text-muted-foreground mt-1"},"Управление страницей сайта",-1))]),o("button",{onClick:e[0]||(e[0]=(...a)=>t.goBack&&t.goBack(...a)),class:"h-11 px-6 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors"}," Назад ")]),t.loading?(i(),l("div",Se,[...e[2]||(e[2]=[o("p",{class:"text-muted-foreground"},"Загрузка...",-1)])])):S("",!0),t.error?(i(),l("div",_e,[o("p",Ee,f(t.error),1)])):S("",!0),t.loading?S("",!0):(i(),l("div",Fe,[N(r,{page:t.page,saving:t.saving,error:t.formError,onSubmit:t.savePage,onCancel:t.goBack},null,8,["page","saving","error","onSubmit","onCancel"])]))])}const Ve=H(ye,[["render",Te]]);export{Ve as default};
