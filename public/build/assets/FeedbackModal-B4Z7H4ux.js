import{_ as M,h as f,z as v,i as E,c as a,d as i,b as s,p as y,l as g,f as w,v as p,B as x,t as c,o as d}from"./app-B6aL35le.js";import{S}from"./sweetalert2.esm.all-C0u8rGqG.js";const C={name:"FeedbackModal",props:{isOpen:{type:Boolean,default:!1}},emits:["close","success"],setup(h,{emit:o}){const m=f(!1),e=f(null),b=f(!1),u=f({}),r=f({name:"",phone:"",email:"",message:""}),_=l=>{const n=l.replace(/\D/g,"");if(n.startsWith("8")){const t=n.slice(1).match(/^(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})$/);if(t)return"+7 ("+(t[1]?t[1]:"")+(t[2]?") "+t[2]:"")+(t[3]?"-"+t[3]:"")+(t[4]?"-"+t[4]:"")}else if(n.startsWith("7")){const t=n.slice(1).match(/^(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})$/);if(t)return"+7 ("+(t[1]?t[1]:"")+(t[2]?") "+t[2]:"")+(t[3]?"-"+t[3]:"")+(t[4]?"-"+t[4]:"")}return l};v(()=>r.value.phone,l=>{const n=_(l);n!==l&&(r.value.phone=n)}),v(()=>r.value.message,l=>{l.length>5e3&&(r.value.message=l.slice(0,5e3))}),v(()=>h.isOpen,l=>{l||setTimeout(()=>{r.value={name:"",phone:"",email:"",message:""},u.value={},e.value=null,b.value=!1},300)});const k=E(()=>r.value.name.trim()!==""&&r.value.message.trim()!=="");return{form:r,errors:u,error:e,success:b,loading:m,canSubmit:k,closeModal:()=>{o("close")},submitForm:async()=>{if(!(!k.value||m.value)){u.value={},e.value=null,m.value=!0;try{const l=await fetch("/api/public/feedback",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:r.value.name.trim(),phone:r.value.phone.trim()||null,email:r.value.email.trim()||null,message:r.value.message.trim()})}),n=await l.json();if(!l.ok)throw n.errors&&(u.value=n.errors),new Error(n.message||"Ошибка при отправке формы");b.value=!0,r.value={name:"",phone:"",email:"",message:""},await S.fire({icon:"success",title:"Спасибо!",text:"Ваше сообщение успешно отправлено. Мы свяжемся с вами в ближайшее время.",timer:3e3,showConfirmButton:!1}),setTimeout(()=>{o("success"),o("close")},500)}catch(l){e.value=l.message||"Ошибка при отправке формы",console.error("Error submitting feedback:",l)}finally{m.value=!1}}}}}},F={class:"bg-background rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto"},j={class:"flex items-center justify-between p-6 border-b border-border"},B={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},T={key:0,class:"mt-1 text-sm text-red-500"},V={key:0,class:"mt-1 text-sm text-red-500"},O={key:0,class:"mt-1 text-sm text-red-500"},N={key:0,class:"mt-1 text-sm text-red-500"},z={class:"mt-1 text-xs text-muted-foreground"},U={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},q={class:"text-sm text-red-600"},D={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},A={class:"flex justify-end gap-4 pt-4"},L=["disabled"],W=["disabled"],J={key:0},K={key:1};function P(h,o,m,e,b,u){return m.isOpen?(d(),a("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:o[7]||(o[7]=y((...r)=>e.closeModal&&e.closeModal(...r),["self"]))},[s("div",F,[s("div",j,[o[9]||(o[9]=s("h2",{class:"text-2xl font-semibold text-foreground"},"Обратная связь",-1)),s("button",{onClick:o[0]||(o[0]=(...r)=>e.closeModal&&e.closeModal(...r)),class:"text-muted-foreground hover:text-foreground transition-colors",type:"button"},[...o[8]||(o[8]=[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),s("form",{onSubmit:o[6]||(o[6]=y((...r)=>e.submitForm&&e.submitForm(...r),["prevent"])),class:"p-6 space-y-6"},[s("div",B,[s("div",null,[o[10]||(o[10]=s("label",{for:"modal-name",class:"block text-sm font-medium text-foreground mb-2"},[w(" Имя "),s("span",{class:"text-red-500"},"*")],-1)),g(s("input",{id:"modal-name","onUpdate:modelValue":o[1]||(o[1]=r=>e.form.name=r),type:"text",required:"",placeholder:"Ваше имя",class:x(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.name}])},null,2),[[p,e.form.name]]),e.errors.name?(d(),a("p",T,c(e.errors.name),1)):i("",!0)]),s("div",null,[o[11]||(o[11]=s("label",{for:"modal-phone",class:"block text-sm font-medium text-foreground mb-2"}," Телефон ",-1)),g(s("input",{id:"modal-phone","onUpdate:modelValue":o[2]||(o[2]=r=>e.form.phone=r),type:"tel",placeholder:"+7 (___) ___-__-__",class:x(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.phone}])},null,2),[[p,e.form.phone]]),e.errors.phone?(d(),a("p",V,c(e.errors.phone),1)):i("",!0)])]),s("div",null,[o[12]||(o[12]=s("label",{for:"modal-email",class:"block text-sm font-medium text-foreground mb-2"}," Email ",-1)),g(s("input",{id:"modal-email","onUpdate:modelValue":o[3]||(o[3]=r=>e.form.email=r),type:"email",placeholder:"your@email.com",class:x(["w-full h-12 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent transition-colors",{"border-red-500":e.errors.email}])},null,2),[[p,e.form.email]]),e.errors.email?(d(),a("p",O,c(e.errors.email),1)):i("",!0)]),s("div",null,[o[13]||(o[13]=s("label",{for:"modal-message",class:"block text-sm font-medium text-foreground mb-2"},[w(" Сообщение "),s("span",{class:"text-red-500"},"*")],-1)),g(s("textarea",{id:"modal-message","onUpdate:modelValue":o[4]||(o[4]=r=>e.form.message=r),required:"",rows:"6",placeholder:"Введите ваше сообщение...",class:x(["w-full px-4 py-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-[#688E67] focus:border-transparent resize-none transition-colors",{"border-red-500":e.errors.message}])},null,2),[[p,e.form.message]]),e.errors.message?(d(),a("p",N,c(e.errors.message),1)):i("",!0),s("p",z,c(e.form.message.length)+"/5000 символов ",1)]),e.error?(d(),a("div",U,[s("p",q,c(e.error),1)])):i("",!0),e.success?(d(),a("div",D,[...o[14]||(o[14]=[s("p",{class:"text-sm text-green-600"}," Спасибо за ваше обращение! Мы свяжемся с вами в ближайшее время. ",-1)])])):i("",!0),s("div",A,[s("button",{type:"button",onClick:o[5]||(o[5]=(...r)=>e.closeModal&&e.closeModal(...r)),class:"px-6 py-3 border border-border rounded-lg hover:bg-muted transition-colors font-medium",disabled:e.loading}," Отмена ",8,L),s("button",{type:"submit",disabled:e.loading||!e.canSubmit,class:"px-6 py-3 bg-[#688E67] text-white rounded-lg hover:bg-[#5a7a5a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium"},[e.loading?(d(),a("span",J,"Отправка...")):(d(),a("span",K,"Отправить"))],8,W)])],32)])])):i("",!0)}const I=M(C,[["render",P]]);export{I as F};
