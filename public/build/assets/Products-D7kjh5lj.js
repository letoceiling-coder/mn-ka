import{_ as C,c as i,b as t,d as v,a as B,t as l,w as z,F as j,k as P,h as x,j as S,r as T,o as a,f as E}from"./app-DxXiGJgJ.js";import{a as I,d as F}from"./api-V9GPpd21.js";import{S as c}from"./sweetalert2.esm.all-C0u8rGqG.js";const L={name:"DecisionProducts",setup(){const h=x(!1),o=x(!1),b=x(!1),e=x(null),w=x([]),g=async()=>{h.value=!0,e.value=null;try{const r=await I("/products");if(!r.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤");const d=await r.json();w.value=d.data||[]}catch(r){e.value=r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",console.error("Error fetching products:",r)}finally{h.value=!1}},_=async(r="csv")=>{o.value=!0;try{const d=localStorage.getItem("token"),u=await fetch(`/api/v1/products/export${r==="zip"?"?format=zip":""}`,{method:"GET",headers:{Authorization:`Bearer ${d}`,Accept:r==="zip"?"application/zip":"text/csv"}});if(!u.ok)throw new Error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤");const y=await u.blob(),m=window.URL.createObjectURL(y),s=document.createElement("a");s.href=m;const p=r==="zip"?"zip":"csv";s.download=`products_${new Date().toISOString().split("T")[0]}.${p}`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(m),document.body.removeChild(s),await c.fire({title:"–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(d){await c.fire({title:"–û—à–∏–±–∫–∞",text:d.message||"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",icon:"error",confirmButtonText:"–û–ö"})}finally{o.value=!1}},n=async r=>{const d=r.target.files?.[0];if(!d)return;const f=100*1024*1024;if(d.size>f){await c.fire({title:"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π",html:`
                        <p>–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: <strong>${(d.size/1024/1024).toFixed(2)} MB</strong></p>
                        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <strong>100 MB</strong></p>
                        <p class="mt-4 text-sm text-gray-600">–ï—Å–ª–∏ —Ñ–∞–π–ª –º–µ–Ω—å—à–µ 100MB, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:</p>
                        <ul class="mt-2 text-sm text-left list-disc list-inside text-gray-600">
                            <li>PHP: upload_max_filesize, post_max_size</li>
                            <li>–í–µ–±-—Å–µ—Ä–≤–µ—Ä: client_max_body_size (nginx) –∏–ª–∏ LimitRequestBody (apache)</li>
                        </ul>
                    `,icon:"error",confirmButtonText:"–û–ö"}),r.target.value="";return}b.value=!0;try{const u=new FormData;u.append("file",d);const y=localStorage.getItem("token"),m=await fetch("/api/v1/products/import",{method:"POST",headers:{Authorization:`Bearer ${y}`},body:u});if(m.status===413)throw new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100MB. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (upload_max_filesize, post_max_size).");let s;try{s=await m.json()}catch{throw m.status===413?new Error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (413 Content Too Large). –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."):new Error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞")}if(!m.ok){const p=s?.message||s?.errors?.[0]||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤";throw new Error(p)}await c.fire({title:"–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",html:`
                        <p>${s.message}</p>
                        ${s.errors&&s.errors.length>0?`
                            <details class="mt-4 text-left">
                                <summary class="cursor-pointer text-sm">–û—à–∏–±–∫–∏ (${s.errors.length})</summary>
                                <div class="mt-2 max-h-40 overflow-y-auto text-xs">
                                    ${s.errors.map(p=>`<p>–°—Ç—Ä–æ–∫–∞ ${p.row}: ${p.errors.join(", ")}</p>`).join("")}
                                </div>
                            </details>
                        `:""}
                    `,icon:s.success_count>0?"success":"warning",confirmButtonText:"–û–ö"}),r.target.value="",await g()}catch(u){await c.fire({title:"–û—à–∏–±–∫–∞",text:u.message||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",icon:"error",confirmButtonText:"–û–ö"})}finally{b.value=!1}},k=async r=>{if((await c.fire({title:"–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç?",text:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç "${r.name}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626"})).isConfirmed)try{if(!(await F(`/products/${r.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞");await c.fire({title:"–ü—Ä–æ–¥—É–∫—Ç —É–¥–∞–ª–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await g()}catch(f){await c.fire({title:"–û—à–∏–±–∫–∞",text:f.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞",icon:"error",confirmButtonText:"–û–ö"})}};return S(()=>{g()}),{loading:h,exporting:o,importing:b,error:e,products:w,fetchProducts:g,deleteProduct:k,exportProducts:_,handleImportFile:n}}},D={class:"products-page space-y-6"},M={class:"flex items-center justify-between"},V={class:"flex items-center gap-3"},R={class:"relative group"},N=["disabled"],O={key:0},U={key:1},A=["disabled"],G={key:0},Z={key:1},q={class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 cursor-pointer"},H=["disabled"],J={key:0},K={key:1},Q={key:0,class:"flex items-center justify-center py-12"},W={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},X={class:"text-destructive"},Y={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},$={class:"divide-y divide-border"},ee={class:"flex-1"},te={class:"font-medium text-foreground"},oe={class:"text-sm text-muted-foreground"},re={class:"flex items-center gap-2"},se=["onClick"],ne={key:3,class:"text-center py-12 bg-card rounded-lg border border-border"};function ie(h,o,b,e,w,g){const _=T("router-link");return a(),i("div",D,[t("div",M,[o[4]||(o[4]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–ü—Ä–æ–¥—É–∫—Ç—ã"),t("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –¥–ª—è –±–ª–æ–∫–∞ —Ä–µ—à–µ–Ω–∏–π")],-1)),t("div",V,[t("div",R,[t("button",{onClick:o[0]||(o[0]=n=>e.exportProducts("csv")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",U,"...")):(a(),i("span",O,"üì•")),t("span",null,l(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç CSV"),1)],8,N)]),t("button",{onClick:o[1]||(o[1]=n=>e.exportProducts("zip")),disabled:e.loading||e.exporting,class:"h-11 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50"},[e.exporting?(a(),i("span",Z,"...")):(a(),i("span",G,"üì¶")),t("span",null,l(e.exporting?"–≠–∫—Å–ø–æ—Ä—Ç...":"–≠–∫—Å–ø–æ—Ä—Ç ZIP"),1)],8,A),t("label",q,[t("input",{type:"file",accept:".zip,.csv,.txt",onChange:o[2]||(o[2]=(...n)=>e.handleImportFile&&e.handleImportFile(...n)),class:"hidden",disabled:e.loading||e.importing},null,40,H),e.importing?(a(),i("span",K,"...")):(a(),i("span",J,"üì§")),t("span",null,l(e.importing?"–ò–º–ø–æ—Ä—Ç...":"–ò–º–ø–æ—Ä—Ç ZIP/CSV"),1)]),B(_,{to:{name:"admin.decisions.products.create"},class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},{default:z(()=>[...o[3]||(o[3]=[t("span",null,"+",-1),t("span",null,"–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç",-1)])]),_:1})])]),e.loading?(a(),i("div",Q,[...o[5]||(o[5]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤...",-1)])])):v("",!0),e.error?(a(),i("div",W,[t("p",X,l(e.error),1)])):v("",!0),!e.loading&&e.products.length>0?(a(),i("div",Y,[t("div",$,[(a(!0),i(j,null,P(e.products,n=>(a(),i("div",{key:n.id,class:"p-4 hover:bg-muted/10 transition-colors flex items-center justify-between"},[t("div",ee,[t("h3",te,l(n.name),1),t("p",oe," Slug: "+l(n.slug)+" | –ü–æ—Ä—è–¥–æ–∫: "+l(n.order)+" | "+l(n.is_active?"–ê–∫—Ç–∏–≤–µ–Ω":"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω"),1)]),t("div",re,[B(_,{to:{name:"admin.decisions.products.edit",params:{id:n.id}},class:"px-3 py-1.5 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors inline-block"},{default:z(()=>[...o[6]||(o[6]=[E(" –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",-1)])]),_:1},8,["to"]),t("button",{onClick:k=>e.deleteProduct(n),class:"px-3 py-1.5 text-sm bg-destructive/10 text-destructive hover:bg-destructive/20 rounded-lg transition-colors"}," –£–¥–∞–ª–∏—Ç—å ",8,se)])]))),128))])])):v("",!0),!e.loading&&e.products.length===0?(a(),i("div",ne,[...o[7]||(o[7]=[t("p",{class:"text-muted-foreground"},"–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):v("",!0)])}const ce=C(L,[["render",ie]]);export{ce as default};
