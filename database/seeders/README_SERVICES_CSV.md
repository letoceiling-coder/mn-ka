# Инструкция по подготовке и выполнению ServicesFromCsvSeeder

## Подготовка файлов для сервера

### Шаг 1: Подготовка файлов локально

1. Распакуйте архив `111.zip` в папку `C:\Users\dsc-2\Downloads\111_extracted\`
2. Убедитесь, что структура следующая:
   ```
   111_extracted/
   ├── services.csv
   └── images/
       ├── services/
       │   ├── _.png
       │   ├── __1.png
       │   └── ... (другие изображения)
       └── icons/
           ├── _.png
           ├── __1.png
           └── ... (другие иконки)
   ```

### Шаг 2: Загрузка файлов на сервер

#### Вариант 1: Через FTP/SFTP
1. Подключитесь к серверу через FTP/SFTP клиент
2. Загрузите файлы в одну из следующих директорий:
   - `/home/d/dsc23ytp/stroy/public_html/storage/app/` (рекомендуется)
   - `/home/d/dsc23ytp/stroy/public_html/`

Структура на сервере должна быть:
```
/home/d/dsc23ytp/stroy/public_html/storage/app/
├── services.csv
└── images/
    ├── services/
    └── icons/
```

#### Вариант 2: Через SSH (если есть доступ)
```bash
# На локальной машине (Windows PowerShell)
cd C:\Users\dsc-2\Downloads\111_extracted
scp -r services.csv images/ user@server:/home/d/dsc23ytp/stroy/public_html/storage/app/
```

#### Вариант 3: Через веб-интерфейс File Manager
1. Войдите в панель управления хостингом
2. Откройте File Manager
3. Перейдите в `public_html/storage/app/`
4. Загрузите `services.csv` и папку `images/`

### Шаг 3: Настройка .env (опционально)

Если файлы находятся в нестандартном месте, укажите путь в `.env`:
```env
SERVICES_CSV_PATH=/home/d/dsc23ytp/stroy/public_html/storage/app/services.csv
CLEAR_SERVICES_BEFORE_SEED=true
```

### Шаг 4: Выполнение сидера

#### Локально (для тестирования):
```bash
php artisan db:seed --class=ServicesFromCsvSeeder
```

#### На сервере (через deploy):
```bash
php artisan deploy --with-seed --insecure
```

Или напрямую на сервере:
```bash
cd /home/d/dsc23ytp/stroy/public_html
php artisan db:seed --class=ServicesFromCsvSeeder
```

## Что делает сидер

1. **Очистка данных** (если `CLEAR_SERVICES_BEFORE_SEED=true`):
   - Удаляет все существующие услуги
   - Удаляет все разделы
   - Удаляет все случаи
   - Очищает связи между таблицами

2. **Импорт данных**:
   - Читает CSV файл
   - Создает/обновляет разделы
   - Загружает изображения и иконки в медиа-библиотеку
   - Создает/обновляет услуги с привязкой к разделам и изображениям

3. **Предотвращение дубликатов**:
   - Использует `updateOrCreate` по `slug`
   - Обновляет существующие услуги вместо создания дубликатов

## Структура CSV файла

CSV файл должен содержать следующие колонки (разделитель `;`):
- ID
- Название
- Slug
- Описание (может быть JSON)
- HTML контент
- Раздел ID
- Название раздела
- ID изображения
- Путь изображения
- URL изображения
- ID иконки
- Путь иконки
- URL иконки
- Порядок
- Активен

## Проверка результатов

После выполнения сидера проверьте:
1. Количество услуг в админ-панели: `/admin/decisions/services`
2. Наличие изображений в медиа-библиотеке
3. Привязку услуг к разделам
4. Отсутствие дубликатов

## Устранение проблем

### Файл не найден
- Проверьте путь к файлу
- Убедитесь, что файл загружен на сервер
- Проверьте права доступа к файлу

### Изображения не загружаются
- Проверьте наличие папки `images/services/` и `images/icons/`
- Убедитесь, что файлы изображений существуют
- Проверьте права доступа к папкам

### Дубликаты услуг
- Сидер использует `updateOrCreate` по `slug`, дубликаты не должны создаваться
- Если дубликаты есть, проверьте уникальность slug в CSV

