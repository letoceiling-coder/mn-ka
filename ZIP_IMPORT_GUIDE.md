# Руководство по импорту продуктов/услуг с изображениями через ZIP архив

## Описание

Функционал позволяет импортировать продукты или услуги из ZIP архива, который содержит:
- CSV файл с данными о продуктах/услугах
- Папку с изображениями

## Структура ZIP архива

```
import-products.zip
├── products.csv (или services.csv)
└── images/
    ├── products/          (изображения продуктов)
    │   ├── product1.jpg
    │   └── product2.png
    └── icons/             (иконки)
        ├── icon1.svg
        └── icon2.png
```

## Формат CSV файла

### Обязательные колонки:
- **Название** - название продукта/услуги
- **Slug** - URL-фрагмент (может быть пустым, будет сгенерирован автоматически)

### Опциональные колонки:
- **ID** - ID для обновления существующей записи
- **Описание** - описание (может быть JSON)
- **Раздел ID** или **ID раздела** - ID раздела (Chapter)
- **Путь изображения** или **Image Path** - путь к изображению относительно корня ZIP (например, `images/products/product1.jpg`)
- **ID изображения** - ID существующего изображения в Media библиотеке (альтернатива пути)
- **Путь иконки** или **Icon Path** - путь к иконке относительно корня ZIP
- **ID иконки** - ID существующей иконки в Media библиотеке
- **Порядок** - порядок сортировки
- **Активен** - `1` или `да` для активных, `0` или пусто для неактивных

### Пример CSV:

```csv
ID;Название;Slug;Описание;Раздел ID;Путь изображения;Путь иконки;Порядок;Активен
;Light Industrial до 5 га;/light-industrial-5;Описание продукта;1;images/products/light-industrial-5.jpg;images/icons/industry.svg;0;1
;Heavy Industrial 10 га;/heavy-industrial-10;Другое описание;1;images/products/heavy-industrial-10.jpg;images/icons/industry.svg;1;1
```

## Использование

### В админ-панели:

1. Перейдите в раздел **Решения** → **Продукты** (или **Услуги**)
2. Нажмите кнопку **"Импорт ZIP/CSV"**
3. Выберите ZIP архив или CSV файл
4. Дождитесь завершения импорта

### Через API:

```javascript
const formData = new FormData();
formData.append('file', zipFile);

fetch('/api/v1/products/import', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${token}`
    },
    body: formData
});
```

## Поддерживаемые форматы

### ZIP архив:
- Все данные в одном файле
- Изображения автоматически загружаются в Media библиотеку
- Максимальный размер: 50MB

### CSV файл (для обратной совместимости):
- Простой CSV файл без изображений
- Можно указать ID существующих изображений в Media библиотеке
- Максимальный размер: 50MB

## Обработка изображений

### При импорте из ZIP:
1. Система распаковывает архив во временную директорию
2. Находит CSV файл
3. Для каждого пути изображения:
   - Находит файл в распакованном архиве
   - Загружает его в Media библиотеку (папка "Общая")
   - Создает запись в БД
   - Привязывает к продукту/услуге
4. Очищает временную директорию

### Безопасность:
- Проверка типов файлов (только изображения)
- Защита от directory traversal атак
- Валидация путей
- Ограничение размера файлов

## Примеры ошибок

### Неверный формат архива:
```
Ошибка: CSV file not found in ZIP archive
Решение: Убедитесь, что в архиве есть CSV файл
```

### Изображение не найдено:
```
Ошибка: Не удалось загрузить изображение: images/products/nonexistent.jpg
Решение: Проверьте путь к изображению в CSV файле
```

### Неверный формат CSV:
```
Ошибка: Неверный формат файла. Ожидаются определенные заголовки.
Решение: Убедитесь, что CSV содержит колонку "Название"
```

## Обратная совместимость

Система поддерживает оба формата:
- **ZIP архив** - новый формат с изображениями
- **CSV файл** - старый формат (можно использовать ID изображений)

При импорте система автоматически определяет тип файла и выбирает соответствующий метод обработки.

## Рекомендации

1. **Используйте понятные имена файлов** - они будут использованы как `original_name` в Media библиотеке
2. **Структурируйте папки** - разделяйте продукты и иконки по папкам
3. **Проверяйте пути** - убедитесь, что пути в CSV соответствуют структуре архива
4. **Ограничивайте размер** - не загружайте слишком большие изображения (>5MB каждое)
5. **Тестируйте на малых объемах** - сначала протестируйте импорт 2-3 записей

