# Сидер для импорта данных из старого проекта

## Описание

Сидер `ProductsServicesOptionsCasesSeeder` импортирует данные из старого проекта `C:\OSPanel\domains\lagom` в новый проект, включая:
- Разделы (Chapters)
- Опции (Options)
- Деревья опций (OptionTrees)
- Экземпляры (Instances)
- Услуги (Services) с изображениями и связями
- Продукты (Products) с изображениями и связями
- Кейсы (Cases) с изображениями и связями

## Настройка

Перед запуском сидера необходимо настроить переменные окружения в файле `.env`:

```env
# Путь к старому проекту
OLD_PROJECT_PATH=C:\OSPanel\domains\lagom

# Параметры подключения к старой базе данных
OLD_DB_HOST=127.0.0.1
OLD_DB_PORT=3306
OLD_DB_DATABASE=lagom
OLD_DB_USERNAME=root
OLD_DB_PASSWORD=
```

## Запуск

### Запуск только этого сидера:
```bash
php artisan db:seed --class=ProductsServicesOptionsCasesSeeder
```

### Добавление в DatabaseSeeder:
Откройте `database/seeders/DatabaseSeeder.php` и добавьте:

```php
$this->call([
    // ... другие сидеры
    ProductsServicesOptionsCasesSeeder::class,
]);
```

Затем запустите:
```bash
php artisan db:seed
```

## Что импортируется

### 1. Разделы (Chapters)
- Название, slug, описание
- Порядок сортировки
- Статус активности

### 2. Опции (Options)
- Название
- Порядок сортировки

### 3. Деревья опций (OptionTrees)
- Название
- Родительский элемент
- Порядок сортировки

### 4. Экземпляры (Instances)
- Название
- Порядок сортировки

### 5. Услуги (Services)
- Все основные данные
- Изображения (image_id, icon_id)
- Связи с опциями (option_service)
- Связи с деревьями опций (option_tree_service)
- Связи с экземплярами (instance_service)

### 6. Продукты (Products)
- Все основные данные
- Изображения (image_id, icon_id)
- Связи с услугами (product_service)

### 7. Кейсы (Cases)
- Все основные данные
- Изображения (image_id, icon_id)
- Галерея изображений (cases_image)
- Связи с услугами (cases_service)
- Связи с продуктами (cases_product)

## Импорт изображений

Сидер автоматически:
1. Ищет изображения в старом проекте по различным путям
2. Копирует их в новую структуру директорий (`public/upload/{category}/`)
3. Создает записи в таблице `media`
4. Связывает изображения с соответствующими сущностями

### Структура директорий для изображений:
- `public/upload/services/` - изображения услуг
- `public/upload/products/` - изображения продуктов
- `public/upload/cases/` - изображения кейсов
- `public/upload/icons/` - иконки

## Обработка ошибок

Сидер обрабатывает ошибки следующим образом:
- Если файл изображения не найден, создается предупреждение, но импорт продолжается
- Если связь не может быть установлена, она пропускается
- Все ошибки логируются в Laravel log

## Примечания

- Сидер использует `firstOrCreate` для предотвращения дублирования записей
- ID из старой БД сохраняются для совместимости
- Если запись уже существует, она не перезаписывается
- JSON поля автоматически парсятся и конвертируются в массивы


